<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0" version="25.0.3">
  <diagram name="Page-1" id="9GhINJhexpfvpIPdTT9F">
    <mxGraphModel dx="10018" dy="6423" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-1" value="&lt;div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; KMD Interrupt&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" vertex="1" parent="1">
          <mxGeometry x="14030" y="-3020" width="3480" height="5350" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-11" value="&lt;div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; KMD launchKernel&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="2310" y="-3020" width="11580" height="5350" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-89" value="&lt;div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; Context 切换流程&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;align=left;verticalAlign=top;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="9570" y="-2800" width="3100" height="2790" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-88" value="&lt;div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; No Context 流程&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;align=left;verticalAlign=top;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="7200" y="-2310" width="1800" height="2290" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-10" value="&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;&lt;b&gt;&lt;font style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font style=&quot;&quot;&gt;UMD launchKernel&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="-1460" y="-2360" width="3350" height="2820" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-84" value="&lt;span style=&quot;text-align: left;&quot;&gt;Start: &lt;br&gt;55AD 21F6 3900&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7413.99" y="-1630" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="qWvV4iFXAZPfeYybYjg1-6" value="gc_hal_kernel_hardware_waitlink_fe.c&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckWLFE_Link(hardware, Logical, FetchAddress, FetchSize, Bytes, Low, High)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; address = FetchAddress&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //CommandBuffer 算是offset的Device地址&lt;br&gt;&amp;nbsp; &amp;nbsp; High = FetchAddress&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; bytes = align(FetchAddress + FetchSize, 64) - FetchAddress //CommandBuffer 有效的大小&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Hardware-&amp;gt;graphicsLargeVA) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gckOS_WriteMemory(os, logical + 1, 0)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;// OPCODE先清零(配置好 cmd再设置 OPCODE&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gckOS_WriteMemory(os, logical + 2，address)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;// 低32位&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gckOS_WriteMemory(os, logical + 3 , FetchAddress &amp;gt;&amp;gt; 32);&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;// 高32位&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;link = ... //设置link为 LINK64 并且PREFETCH大小为bytes&amp;gt;&amp;gt;3 &lt;font color=&quot;#ff3333&quot;&gt;// 配置link的 opcode&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckOS_WriteMemory(os, logical, link)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;// 设置CMD的 OPCODE, Prefetch&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;Low = link&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=2;align=left;horizontal=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="12950" y="-2510" width="720" height="290" as="geometry" />
        </mxCell>
        <mxCell id="qWvV4iFXAZPfeYybYjg1-8" value="gc_hal_kernel_hardware_waitlink_fe.c&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckWLFE_WaitLink(hardware, Logical, Address, Offset, Bytes, WaitOffset, WaitSize)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; hw-&amp;gt;lastWaitLink = Address //保存 WAIT/LINK的地址&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opLogical = Logical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;//设置WAIT命令&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *opLogical++ = ... // WAIT64 与 hw-&amp;gt;waitCount;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; opLogical++&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;//设置LINK命令, 当前LINK到 WAIT命令, 形成LOOP&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *opLogical++ = ...// LINK64 与 PREFETCH&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *opLogical = Address;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; WaitOffset = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; WaitSize = waitSize;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Bytes = bytes;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=2;align=left;horizontal=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="12950" y="-2110" width="720" height="260" as="geometry" />
        </mxCell>
        <mxCell id="qWvV4iFXAZPfeYybYjg1-10" value="gc_hal_kernel_hardware.c&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckHARDWARE_Fence(hardware, Engine, Logical, FenceAddress, FenceData, Bytes)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; if (Engine == gcvENGINE_RENDER)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; _FenceRender(hw, Logical, FenceAddress, FenceData, Bytes)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; --&amp;gt; dataLow = FenceData&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dataHigh = FenceData &amp;gt;&amp;gt; 32&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (logical) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, LOAD_STATE....)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//设置 E75 gcregFenceAddressHiRegAddrs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, FenceAddress &amp;gt;&amp;gt; 32); //设置Fence State 地址高32bit&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, LOAD_STATE...) //设置 E1A gcregFenceAddressRegAddrs&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, fenceAddress)&amp;nbsp; &amp;nbsp; &amp;nbsp;//设置 fence低32位&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, LOAD_STATE...)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//设置 E26 gcregFenceDataHighRegAddrs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, dataHigh)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, LOAD_STATE...)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//设置 E1B gcregFenceDataRegAddrs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkWRITE_MEMORY(logical, dataLow)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Bytes = gcdRENDER_FENCE_LENGTH+8&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=2;align=left;horizontal=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="12950" y="-1749" width="720" height="360" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-1" value="&lt;span style=&quot;text-align: left;&quot;&gt;drv_api.cpp&lt;/span&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1230" y="-1960" width="630" height="606" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-2" value="&lt;div&gt;&lt;b&gt;drvLaunchKernelEx_common(config, f, kernelParams, extra, ptsz):&lt;br&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; kernelParams: 就是user传入的args,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; extra: ???&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; ptsz: 是否是perThread Stream&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-1" vertex="1">
          <mxGeometry y="26" width="630" height="74" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-3" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//获取CUcontext&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;div&gt;ctx = getCurrentContext()&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;//获取gridDimX/Y/Z, blockDimX/Y/Z, sharedMemBytes等配置信息&lt;br&gt;&lt;/span&gt;gridDimX = config-&amp;gt;gridDimX&lt;br&gt;...&lt;br&gt;sharedMemBytes = config-&amp;gt;sharedMemBytes&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//获取CUStream&lt;/span&gt;&lt;/div&gt;&lt;div&gt;hStream = getCurrentStream(ctx, stream, perThread)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//根据 f-&amp;gt;kernelInfo-&amp;gt;argCount 创建kernelArgData_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;kernelArgData_t* argData = malloc(sizeof(kernelArgData_t)*argCount)&lt;/div&gt;&lt;div&gt;for (;;) {&lt;br&gt;&amp;nbsp; &amp;nbsp; kernelArgData_t data = argData + i;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; kernelArg_t arg = &lt;font color=&quot;#ff3333&quot;&gt;f-&amp;gt;kernelInfo&lt;/font&gt;-&amp;gt;args + i;&lt;br&gt;&amp;nbsp; &amp;nbsp; data-&amp;gt;arg = arg&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ... //&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//准备 halQueue_t 与 halCommand_t&lt;/span&gt;&lt;br&gt;halQueue = getCurrentStream(ctx, hStream, false)-&amp;gt;halQueue &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//此时 hStream是有效指针, 基本是直接返回&lt;/span&gt;&lt;br&gt;command = {&lt;font color=&quot;#ff3333&quot;&gt;COMMAND_KERNEL&lt;/font&gt;} &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//设置command 为KERNEL(type 有COPY, WAIT, FENCE 等)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#ff3333&quot;&gt;executeKrnelInfo_t&lt;/font&gt; *info = command.kernelInfo&lt;br&gt;info-&amp;gt;local[0] = blockDimX...; info-&amp;gt;gridDim[0] = gridDimX ...; info-&amp;gt;global[0]= gridDimX*info-&amp;gt;local[0] ...&lt;br&gt;info-&amp;gt;args = argData;&lt;/div&gt;&lt;div&gt;info-&amp;gt;kInfo= f-&amp;gt;kernelInfo;&lt;br&gt;info-&amp;gt;inst = f-&amp;gt;kernel&lt;/div&gt;&lt;div&gt;prepareExecInfo(info)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//调用&lt;/div&gt;&lt;div&gt;&lt;b style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;launchCommand(halQueue, &amp;amp;command)&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-1" vertex="1">
          <mxGeometry y="100" width="630" height="480" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-32" value="&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-1" vertex="1">
          <mxGeometry y="580" width="630" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-5" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Color Chart&lt;/font&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1450" y="-3020" width="395" height="240" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-7" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-5" vertex="1">
          <mxGeometry y="40" width="395" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-6" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Context&lt;/font&gt;" style="text;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-5" vertex="1">
          <mxGeometry y="48" width="395" height="46" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-8" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Command&lt;/font&gt;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-5" vertex="1">
          <mxGeometry y="94" width="395" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-16" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;Comment&lt;/font&gt;" style="text;strokeColor=#82b366;fillColor=#FFFFCC;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-5" vertex="1">
          <mxGeometry y="144" width="395" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-17" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;???&lt;/font&gt;" style="text;strokeColor=#82b366;fillColor=#FFE599;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-5" vertex="1">
          <mxGeometry y="194" width="395" height="46" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-9" value="&lt;span style=&quot;text-align: left;&quot;&gt;stream.cpp&lt;/span&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="-1660" width="490" height="220" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-10" value="&lt;div&gt;&lt;b&gt;getCurrentStream(CUcontext ctx, CUStream stream, bool perThread):&lt;br&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; stream 用户传入的stream&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-9" vertex="1">
          <mxGeometry y="26" width="490" height="44" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-11" value="&lt;div&gt;istream = (size_t)stream;&lt;/div&gt;switch(istream)&lt;br&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;case 0: return getDefaultStream(ctx, perThread)&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;--&amp;gt; 如果perThread --&amp;gt; getPerThreadStream(ctx)&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;否则 --&amp;gt;getLegacyStream(ctx) --&amp;gt; ctx-&amp;gt;legacy &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;(如何创建???)&lt;/span&gt;&lt;br&gt;case 1: return getLegacyStream(ctx)&lt;br&gt;case 2: return getPerThreadStream(ct)&lt;br&gt;default:&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;... &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//和delayDestroy 相关 ???&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-9" vertex="1">
          <mxGeometry y="70" width="490" height="150" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-19" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;drv_api.cpp&lt;/span&gt;&lt;/div&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="-1950" width="490" height="140" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-20" value="&lt;div&gt;&lt;b&gt;getCurrentContext():&lt;/b&gt;&amp;nbsp;获取当前的context&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-19" vertex="1">
          <mxGeometry y="26" width="490" height="24" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-21" value="&lt;div&gt;tssData_PTR tss = getTssData(); &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//获取线程本地数据&lt;/span&gt;&lt;br&gt;&lt;br&gt;ctx = utilStackTop(tss-&amp;gt;ctxStack); &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//获取最近创建的CUcontext&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return gpgpuPLS.drvDevices[tss-&amp;gt;runtimeDeviceId]-&amp;gt;primaryCtx &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//如何创建???&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-19" vertex="1">
          <mxGeometry y="50" width="490" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-25" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1110" y="-1280" width="390" height="176" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-26" value="&lt;b&gt;launchCommand(halQueue_PTR queue, halCommand_t * cmd)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-25" vertex="1">
          <mxGeometry y="26" width="390" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-27" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-25" vertex="1">
          <mxGeometry y="52" width="390" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-28" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//根据type调用相应的函数&lt;br&gt;&lt;/span&gt;switch(cmd-&amp;gt;type)&lt;br&gt;case &lt;font color=&quot;#ff3333&quot;&gt;COMMAND_KERNEL&lt;/font&gt;: &lt;b&gt;executeKernel(queue, cmd)&lt;/b&gt;&lt;br&gt;...&lt;br&gt;case&amp;nbsp;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-25" vertex="1">
          <mxGeometry y="60" width="390" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-34" value="&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-25" vertex="1">
          <mxGeometry y="150" width="390" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-33" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.501;exitY=1.038;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-32" target="QSAenKkpdjQW8zQk9t1L-25" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-1210" y="-1310" as="sourcePoint" />
            <mxPoint x="-1130" y="-1310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-35" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1192" y="-1000" width="550" height="320" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-36" value="&lt;b&gt;executeKernel(halQueue_PTR queue, halCommand* halCmd)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-35" vertex="1">
          <mxGeometry y="26" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-37" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-35" vertex="1">
          <mxGeometry y="52" width="550" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-38" value="executeKernelInfo_t * execInfo = &amp;amp;halCmd-&amp;gt;kernelInfo&lt;br&gt;&lt;br&gt;execInfo-&amp;gt;halQueue = queue&lt;br&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;cmdBuffer_PTR &lt;font color=&quot;#ff3333&quot;&gt;&lt;b&gt;cmdBuffer &lt;/b&gt;&lt;/font&gt;= &lt;b&gt;createCommandBuffer&lt;/b&gt;(processor, 1024, 1024)&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;clfBeginVIRUniform(&lt;font color=&quot;#ff3333&quot;&gt;&lt;b&gt;cmdBuffer&lt;/b&gt;&lt;/font&gt;, execInfo-&amp;gt;inst, null)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; //添加硬件配置cmd, 并且写入 semaphoreStall 与 Stall 命令&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;__clCmdLoadSingalHWState(states, AQSemaphoreRegAddrs, semaphoreStall)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;__clCmdLoadingFECommand(states, STALL, semaphoreStall)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;allocInternalMemory(execInfo)&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;clfEndVIRUniform(...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;clfInvokeVIRKernel&lt;/b&gt;(cmdBuffer, execInfo-&amp;gt;inst, execInfo-&amp;gt;workDim, ...., &amp;amp;invokeInfo)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//把cmdBuffer挂载到queue的commandQueue上&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;addCmdToQueue&lt;/b&gt;(queue, cmdBuffer)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-35" vertex="1">
          <mxGeometry y="60" width="550" height="260" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-39" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.51;entryY=0.005;entryDx=0;entryDy=0;exitX=0.508;exitY=1.035;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-34" target="QSAenKkpdjQW8zQk9t1L-35" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-904" y="-1343" as="sourcePoint" />
            <mxPoint x="-905" y="-1270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-41" value="chip.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="-1240" width="460" height="300" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-42" value="&lt;b&gt;createCommandBuffer(processor, size)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-41" vertex="1">
          <mxGeometry y="26" width="460" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-43" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-41" vertex="1">
          <mxGeometry y="52" width="460" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-44" value="cmd = malloc(sizeof(cmdBuffer_t))&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//通过cmd-Buffer - cmdBase 可以计算cmd的个数&lt;br&gt;&lt;/span&gt;cmd-&amp;gt;cmdBase = malloc(size)&lt;br&gt;cmd-&amp;gt;cmdBuffer = cmd-&amp;gt;cmdBase&lt;br&gt;cmd-&amp;gt;processor = processor&lt;br&gt;cmd-&amp;gt;helper.index = gCmdIdx++;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//向cmdBuffer中添加init cmds&lt;/span&gt;&lt;/div&gt;&lt;div&gt;clfInitCommandQueue(cmd)&lt;br&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//通过&amp;nbsp;__clCmdLoadSingleHWState 往cmdBuffer添加LoadState 配置&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;28A AQSystemRegAddrs&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;E13 AQModeRegAddrs&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;5580 gcregShaderMiscConfigRegAddrs&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;E44 gcregClusterControlRegAddrs&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;E80 gcregMultiChipControlRegAddrs&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-41" vertex="1">
          <mxGeometry y="60" width="460" height="240" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-45" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=-0.005;entryY=0.053;entryDx=0;entryDy=0;exitX=1.006;exitY=0.166;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-38" target="QSAenKkpdjQW8zQk9t1L-41" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-902" y="-1073" as="sourcePoint" />
            <mxPoint x="-899" y="-999" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-46" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.003;entryY=0.111;entryDx=0;entryDy=0;exitX=1.002;exitY=0.298;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-3" target="QSAenKkpdjQW8zQk9t1L-19" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-590" y="-1574" as="sourcePoint" />
            <mxPoint x="-473" y="-1790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-47" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.001;entryY=0.083;entryDx=0;entryDy=0;exitX=0.997;exitY=0.594;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-3" target="QSAenKkpdjQW8zQk9t1L-9" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-589" y="-1707" as="sourcePoint" />
            <mxPoint x="-429" y="-1884" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-48" value="chip.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="-910" width="530" height="560" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-49" value="&lt;b&gt;clfInvokeVIRKernel(cmdBuffer_PTR cmdBuffer, KernelInst_PTR kernelInst,...)&lt;br&gt;通过将要运行的kernel, 配置cmd buffer&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-48" vertex="1">
          <mxGeometry y="26" width="530" height="44" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-50" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-48" vertex="1">
          <mxGeometry y="70" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-51" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;compilerCmd = *states; //states 就是cmdBuffer-&amp;gt;cmdBuffer&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;compilerCmdCount = hwStates-&amp;gt;stateBufferSize/sizeof(uint32_t)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //22&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;memcpy(*states, hwStates-&amp;gt;pStateBuffer, hwStates-&amp;gt;stateBufferSize)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;*states += compilerCmdCount;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//配置指令地址 0x040A&lt;/span&gt;&lt;div&gt;physical = getDeviceAddr(kernelInst-&amp;gt;instMem, kernelInst-&amp;gt;processor)&lt;br&gt;__clCmdLoadSingleHWState(states, gcregPSInstructionRegAddrs, physical)&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//NN相关&lt;/span&gt;&lt;/div&gt;&lt;div&gt;clfTCBasicConfig(cmdBuffer, kernelInst)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//Load State 配置&lt;/div&gt;&lt;div&gt;AQPixelShaderInputControlRegAddrs&amp;nbsp;&lt;br&gt;AQPixelShaderTemporaryRegisterControlRegAddrs&lt;/div&gt;&lt;div&gt;AQPixelShaderControlRegAddrs&lt;br&gt;gcregVSThrottleRegAddrs ...&lt;br&gt;&lt;/div&gt;&lt;div&gt;gcregVSInstructionPrefetchRegAddrs ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//???&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;_clCmdLoadSingleHWState(states, gcregTWTriggerRegAddrs, 0xBADABEEB)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;AQFlushRegAddrs&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//Semaphare STALL&lt;/span&gt;&lt;/div&gt;&lt;div&gt;__clCmdLoadSingleHWState(states, AQSemaphoreRegAddrs, semaphoreStall);&lt;br&gt;__clCmdLoadSignleFECommand(states, STALL, semaphoreStall);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//通过semaphore同步&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;MultiGPUSync(cmdBuffer)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Invalid ICache&lt;/span&gt;&lt;/div&gt;&lt;div&gt;__clCmdLoadSingleHWState(states, gcregSHIcacheInvalidateRegAddrs, ...)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-48" vertex="1">
          <mxGeometry y="78" width="530" height="482" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-52" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-38" target="QSAenKkpdjQW8zQk9t1L-51" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-629" y="-882" as="sourcePoint" />
            <mxPoint x="-432" y="-1114" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-57" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="-249" width="530" height="190" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-58" value="&lt;b&gt;addCmdToQueue(halQueue_PTR queue, cmdBuffer_PTR cmdBuffer)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-57" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-59" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-57" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-60" value="&lt;b&gt;updateHalqueueFence&lt;/b&gt;(queue, queue-&amp;gt;processor, cmdBuffer)&lt;br&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; queue-&amp;gt;halFence-&amp;gt;expectedVal = cmdBuffer-&amp;gt;helper.index; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;// gCmdIdx++ 初始化&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; addr = getFenceGPULogical(queue-&amp;gt;halFence, processor)&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; --&amp;gt; fence-&amp;gt;node-&amp;gt;gpuLogical + fence-&amp;gt;offsetInBytes&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;clfSendFenceWithEngine&lt;/b&gt;(cmdBuffer, fence-&amp;gt;expectedVal, addr, 0)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//把cmdBuffer 挂载到queue-&amp;gt;commandQueue上面&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;os_queue_append&lt;/b&gt;(queue-&amp;gt;commandQueue, cmdBuffer)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-57" vertex="1">
          <mxGeometry y="60" width="530" height="130" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-61" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=0.997;exitY=0.824;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-38" target="QSAenKkpdjQW8zQk9t1L-57" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="-735" y="-430" as="sourcePoint" />
            <mxPoint x="-573" y="-207" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-62" value="chip.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="-223" width="690" height="450" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-63" value="&lt;b&gt;clfSendFenceWithEngine(cmdBuffer_PTR cmdBuffer, uint64_t data, devAddress_t dstAddress, int32_t engine)&lt;br&gt;&lt;/b&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;// data 就是expectedVal,&amp;nbsp; &lt;br&gt;// dstAddress是GPU看到的halFence_PTR地址&lt;br&gt;// engine ??&lt;/span&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-62" vertex="1">
          <mxGeometry y="26" width="690" height="74" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-64" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-62" vertex="1">
          <mxGeometry y="100" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-65" value="dataL = data &amp;amp; 0xFFFFFFFF&lt;div&gt;dataH = (data&amp;gt;&amp;gt;32) &amp;amp;0xFFFFFFFF&lt;br&gt;&lt;br&gt;dstAddressHigh = devADDRESS_HIGH(dstAddress)&lt;br&gt;dstAddressLow&amp;nbsp; = devADDRESS_LOW(dstAddress)&lt;br&gt;&lt;br&gt;if(engine == gcvENGINE_BLT) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (hasBlt) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //Semaphore 配置???&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; __clCmdLoadSingleHWState(states, gcregBltGeneralControlRegAddrs, LOCK)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;__clCmdLoadSingleHWState(states, AQSemaphoreRegAddrs, semaphoreStall)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; __clCmdLoadSingleFECommand(states, STALL, semaphoreStall)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; __clCmdLoadSingleHWState(states, gcregBltGeneralControlRegAddrs, UNLOCK)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else { ...&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//添加Fence cmd&lt;/span&gt;&lt;/div&gt;&lt;div&gt;__clCmdLoadSingleHWState(states, gcregFenceAddressRegAddrs, dstAddressLow)&lt;br&gt;__clCmdLoadSingleHWState(states, gcregFenceDataHighRegAddrs, dataH)&lt;/div&gt;&lt;div&gt;__clCmdLoadSingleHWState(states, gcregFenceDataRegAddrs, dataL)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-62" vertex="1">
          <mxGeometry y="108" width="690" height="342" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-66" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=-0.003;entryY=0.038;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-58" target="QSAenKkpdjQW8zQk9t1L-62" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="650" y="-175" as="sourcePoint" />
            <mxPoint x="809" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-67" value="queue_sched.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1120" y="-1970" width="340" height="236" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-68" value="&lt;b&gt;simple_round_robin(void* p)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-67" vertex="1">
          <mxGeometry y="26" width="340" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-69" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-67" vertex="1">
          <mxGeometry y="52" width="340" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-70" value="&lt;div&gt;while(1)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; cmd = &lt;b&gt;os_queue_head&lt;/b&gt;(q-&amp;gt;commandQueue)&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;commitCmdBuffer&lt;/b&gt;(cmd, &amp;amp;commitInfo)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;releaseCommandBuffer&lt;/b&gt;(cmd)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;os_queue_pop_head&lt;/b&gt;(q-&amp;gt;commandQueue)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-67" vertex="1">
          <mxGeometry y="60" width="340" height="150" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-76" value="&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-67" vertex="1">
          <mxGeometry y="210" width="340" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-71" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="940" y="-1654" width="690" height="756" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-72" value="commitCmdBuffer(cmdBuffer_PTR cmd, commitInfo_PTR info)" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-71" vertex="1">
          <mxGeometry y="26" width="690" height="24" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-73" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-71" vertex="1">
          <mxGeometry y="50" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-74" value="gcsHAL_INTERFACE iface = { &lt;font color=&quot;#ff3333&quot;&gt;gcvHAL_COMMIT&lt;/font&gt;}&amp;nbsp;&lt;div&gt;gcsHAL_SUBCOMMIT subCommit[gcvCORE_COUNT+1] = {{0}}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;offset = processor-&amp;gt;commandBufferOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;//256&lt;/span&gt;&lt;/div&gt;&lt;div&gt;cmdTailSize = CMD_reservedTailSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//128&amp;nbsp; 8 * CORE_MAX_COUNT&lt;/div&gt;&lt;div&gt;cmdCount = getCommandCount(cmd);&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//162 host 已经准备的cmd&lt;/div&gt;&lt;div&gt;cmdSize&amp;nbsp; &amp;nbsp;= cmdCount*4 + CMD_reservedTailSize + CMD_reservedHeadSize //808&lt;br&gt;cmdSize = ALIGN_NP2(cmdSize, 64)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//832&lt;br&gt;cmdTailSize = cmdSize - cmdCount*4 - CMD_reservedHeadSize&amp;nbsp; &amp;nbsp;//152&lt;br&gt;cmdCount = cmdSize/4&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//208&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//之后还会align cmdSize到64再重新计算cmdTailSize&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//计算当前cmdCount, 再设置 cmdIdx&lt;/span&gt;&lt;/div&gt;&lt;div&gt;commitIdx = processor-&amp;gt;commitCmdIdx&lt;/div&gt;&lt;div&gt;cmdIdx = commitIdx + totalCount&lt;br&gt;processor-&amp;gt;commitCmdIdx = cmdIdx&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//准备拷贝cmdBuffer_PTR中的cmd到 subCommit中&lt;/span&gt;&lt;/div&gt;&lt;div&gt;readIdx = processor-&amp;gt;devReadCmdIdx&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;subCommit[i].commandBuffer.startOffset = offset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//256&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;logical = getCPUAddr(processor-&amp;gt;commandBufferPool, processor) + offset; // cpu_logical&amp;nbsp; 55AD 21F6 3A00&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;dst = logical + CMD_reservedHeadSize;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// dst&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;55AD 21F6 3A20&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//拷贝host准备的cmd数据到 commandBufferPool当中&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;memcpy(dst, cmd-&amp;gt;cmdBase, getCommandCount(cmd)*4)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;offset+= cmdSize&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.u.Commit.shared = !bDuplicate;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;subCommit[i].context = processor-&amp;gt;context[i]&amp;nbsp; //此处的context[i] 就是context db 的id&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.delta =0,&amp;nbsp; .queue = 0,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.address = getDeviceAddr(processor-&amp;gt;commandBufferPool. processor)&amp;nbsp; &lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//FF7F E000&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.logical&amp;nbsp; &amp;nbsp; = getCPUAddr(processor-&amp;gt;commandBufferPool, processor)&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//55AD 21F6 3900&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = cmdSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//832&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.reservedHead = CMD_reservedHeadSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//32&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.reservedTail = cmdTailSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//152&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.videoMemNode = processor-&amp;gt;commandBufferPool-&amp;gt;handle&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.entryPipe = gcvPIPE_3D , exitPipe = gcvPIPE_3D&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.exitIndex = &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;bDuplicate &lt;/span&gt;? 0 : 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.priority = 0,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.commandBuffer.&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;channelId &lt;/span&gt;= 1,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.next = subCommit + i + 1&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;iface.u.Commit.subCommit = subCommit[0]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;iface.u.Commit.broCoreMask = &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;broCoreMask&lt;/span&gt;&lt;br&gt;iface.cmmitMutex = false&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;KmdIoCtl(processor-&amp;gt;kmdHandle, IOCTL_GCHAL_INTERFACE, &amp;amp;iface, sizeof(iface) .....)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//iface.u.Commit.contextSwitched) 可以查询是否有context切换&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-71" vertex="1">
          <mxGeometry y="58" width="690" height="672" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-77" value="&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-71" vertex="1">
          <mxGeometry y="730" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-75" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.49;exitY=1.023;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-76" target="QSAenKkpdjQW8zQk9t1L-71" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="1330" y="-2047" as="sourcePoint" />
            <mxPoint x="1450" y="-2264" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-78" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2480" y="-940" width="750" height="120" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-79" value="gckKERNEL_Dispatch(gckKERNEL kernel, gckDEVICE Device, gcsHAL_INTERFACE *Interface)&amp;nbsp;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-78" vertex="1">
          <mxGeometry y="26" width="750" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-80" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-78" vertex="1">
          <mxGeometry y="52" width="750" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-81" value="switch(Interface-&amp;gt;command)&lt;br&gt;case gcvHAL_COMMIT:&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_Commit&lt;/b&gt;(Device, Kernel-&amp;gt;hardware-&amp;gt;type, Interface-&amp;gt;engine, processID, Interface-&amp;gt;u.Commit.broCoreMask, &amp;amp;Interface-&amp;gt;u.Commit)&amp;nbsp;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-78" vertex="1">
          <mxGeometry y="60" width="750" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-82" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=3;" parent="1" source="QSAenKkpdjQW8zQk9t1L-77" target="QSAenKkpdjQW8zQk9t1L-78" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2390" y="-505" as="sourcePoint" />
            <mxPoint x="2393" y="-416" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-84" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2400" y="-545" width="920" height="372" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-85" value="&lt;b&gt;_Commit(gckDEVICE Device, gceHARDWARE_TYPE HwType, gceENGINE Engine, gctUINT32 ProcessId, gctUNIT32 BroCoreMask, gcsHAL_COMMIT *Commit)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="26" width="920" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-86" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="52" width="920" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QSAenKkpdjQW8zQk9t1L-87" value="&lt;div&gt;gckCOMMAND command;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;gcsHAL_SUBCOMMIT *subCommit = &amp;amp;Commit-&amp;gt;subCommit;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;if (HwType == gcvHARDWARE_3D ...) {&lt;div&gt;&amp;nbsp; &amp;nbsp; kernel = Device-&amp;gt;coreInfoArray[subCommit-&amp;gt;coreId].kernel;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Engine == gcvENGINE_BLT) { ... }&amp;nbsp;&lt;/div&gt;&lt;div&gt;else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;command = kernel-&amp;gt;command;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eventObj&amp;nbsp; &amp;nbsp;= kernel-&amp;gt;eventObj;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=3;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="60" width="920" height="200" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-18" value="&lt;b&gt;gckCOMMAND_Commit&lt;/b&gt;(command, subCommit, ProcessId, Commit-&amp;gt;shared, &amp;amp;Commit-&amp;gt;commitStamp, &amp;amp;Commit-&amp;gt;contextSwitched)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=3;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="260" width="920" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-17" value="&lt;b&gt;gckEVENT_Commit&lt;/b&gt;(eventObj, subCommit-&amp;gt;queue, false, command-&amp;gt;feType != gcvHW_FE_END, Commit-&amp;gt;shared)&lt;br&gt;&lt;br&gt;next = subCommit-&amp;gt;next;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=3;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="286" width="920" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-15" value="&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QSAenKkpdjQW8zQk9t1L-84" vertex="1">
          <mxGeometry y="346" width="920" height="26" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-1" value="gc_hal_kernel_command.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3590" y="-1049" width="830" height="590" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-2" value="&lt;b&gt;gckCOMMAND_Commit(gckCOMMAND Command, gcsHAL_SUBCOMMIT *SubCommit, ProcessId, Shared, CommitStamp, *contextSwitched)&lt;/b&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;CommitStamp //在提交命令后, 得到Command的commitStamp&lt;/span&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="U14mofKTcunZ6X7Fo2zi-1" vertex="1">
          <mxGeometry y="26" width="830" height="44" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="U14mofKTcunZ6X7Fo2zi-1" vertex="1">
          <mxGeometry y="70" width="830" height="8" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-4" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;gcsSTATE_DELTA_PTR delta = SubCommit-&amp;gt;delta&lt;br&gt;gckCONTEXT context = NULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;gcsHAL_COMMAND_LOCATION *cmdLoc = &amp;amp;SubCommit-&amp;gt;commandBuffer;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;gckMMU mmu=NULL&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;if (SubCommit-&amp;gt;context)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;//通过kernel-&amp;gt;db-&amp;gt;pointerDatabase-&amp;gt;table[(UINT32_T)SubCommit-&amp;gt;context -1] 获取&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; context = gckKERNEL_QueryPointerFromName(Command-&amp;gt;kernel, SubCommit-&amp;gt;context)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;do {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; gckKERNEL_GetCurrentMMU(Command-&amp;gt;kernel, true, 0, &amp;amp;mmu) &lt;font color=&quot;#ff3333&quot;&gt;//???如何创建的???&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Command-&amp;gt;kernel-&amp;gt;processPageTable &amp;amp;&amp;amp; &lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;Command-&amp;gt;currContext!=context&lt;/span&gt;)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;gckKERNEL_SwitchMMU(Command-&amp;gt;kernel, Shared, mmu)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff3333&quot;&gt;&amp;nbsp; &amp;nbsp; //获取power/Command 锁, 递增Command-&amp;gt;atomCommit&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; gckCOMMAND_EnterCommit&lt;/b&gt;(Command, false)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; _HandlePatchList(Command, cmdLoc, &amp;amp;pathListVar)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Command-&amp;gt;feType == gcvHW_FE_WAIT_LINK) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;_CommitWaitLinkOnce&lt;/b&gt;(Command, context, cmdLoc, delta, ProcessId, Shared, contextSwitched, NULL, false, ...)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {....}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckCOMMAND_ExitCommit&lt;/b&gt;(Command, false)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; next = cmdLoc-&amp;gt;next&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; userPtr = next&lt;/div&gt;&lt;div&gt;} while(userPtr)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*CommitStamp = Command-&amp;gt;commitStamp&lt;br&gt;Command-&amp;gt;commitStamp++&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="U14mofKTcunZ6X7Fo2zi-1" vertex="1">
          <mxGeometry y="78" width="830" height="512" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-5" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.503;exitY=1.084;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="QSAenKkpdjQW8zQk9t1L-81" target="QSAenKkpdjQW8zQk9t1L-84" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2230" y="134" as="sourcePoint" />
            <mxPoint x="2380" y="-905" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-6" value="gc_hal_kernel_command.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5430" y="-1847" width="1000" height="1544" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-7" value="_CommitWaitLinkOnce(gckCOMMAND Command, gckCONTEXT Context, gcsHAL_COMMAND_LOCATION *CommandBuffer, StateDelta, ProcessID, Shared, ....)" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="26" width="1000" height="26" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-8" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="52" width="1000" height="8" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-5" value="hardware = Command-&amp;gt;kernel-&amp;gt;hardware&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//查询 LINK 的大小(应为有LINK64或者LINK 两种link cmd)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //linkBytes = 16&lt;br&gt;&lt;/span&gt;&lt;b&gt;gckWLFE_Link&lt;/b&gt;(hardware, NULL, 0, 0, &amp;amp;&lt;b&gt;linkBytes&lt;/b&gt;, NULL, NULL)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//logical + CMD_ReservedHeadSize 就是KMD之前的用户cmds&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;commandBufferLogical&amp;nbsp;&lt;/b&gt;= CommandBuffer-&amp;gt;logical + CommandBuffer-&amp;gt;startOffset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 55AD 21F6 3A00&amp;nbsp; &amp;nbsp;=&amp;nbsp; 55AD 21F6 3900&amp;nbsp; + 100 (256)&amp;nbsp; &amp;nbsp;// 556B E14F 7A00&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;commandBufferAddress&amp;nbsp;&lt;/b&gt;= CommandBuffer-&amp;gt;address + CommandBuffer-&amp;gt;startOffset;&amp;nbsp; &amp;nbsp; &amp;nbsp; // FF7F E100&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = FF7F E000 + 100&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // FF7F E100&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//size就是KMD之前的用户cmds + reserved head + tail 对齐64的大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;commandBufferSize = CommandBuffer-&amp;gt;size;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 832&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gckCOMMAND_CheckFlushMMU(Command, hardware) //会根据情况刷MMU&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;if (Command-&amp;gt;kernel-&amp;gt;asyncCommand &amp;amp;&amp;amp; MaxAsyncTimeStamp!=0) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; _WaitForAsyncCommandStamp(Command, MaxAsyncTimeStamp)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//获取当前command queue 的offset&lt;/span&gt;&lt;/div&gt;&lt;div&gt;offset = Command-&amp;gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 144&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//获取当前kernel command queue 剩下的bytes&lt;/span&gt;&lt;/div&gt;&lt;div&gt;bytes = Command-&amp;gt;pageSize - offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 3952 = 4096 - offset&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//查询 WAIT/LINK cmd 序列的大小，这里的offset是计算size时计算对齐地址用的&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckWLFE_WaitLink&lt;/b&gt;(hw, NULL, INVALID_ADDR, offset, &amp;amp;&lt;b&gt;waitLinkBytes&lt;/b&gt;, NULL, NULL)&amp;nbsp; &amp;nbsp; &amp;nbsp;// waitLinkBytes = 32&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//检查kernel command queue 是否有足够的空间&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (bytes &amp;lt; waitLinkBytes) { ... }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//Command Queue 的起始地址&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;waitLinkLogical&amp;nbsp;&lt;/b&gt;= Command-&amp;gt;logical + offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 55AD 21ED 1890&amp;nbsp; = 55AD 21ED 1800 + 144&amp;nbsp; // 556B E146 5890&lt;/div&gt;&lt;div&gt;&lt;b&gt;waitLinkAddress&amp;nbsp;&lt;/b&gt;= Command-&amp;gt;address + offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp; &amp;nbsp;1FF FFFF F090&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 1FF FFFF F090&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="60" width="1000" height="470" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-2" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;//////////////////////////////////////////////////////////////////////////////////////////&amp;nbsp; Context 相关处理 分枝&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (Context == NULL) {&lt;/div&gt;&lt;div&gt;...&amp;nbsp; &amp;nbsp;// 不使用Context&lt;/div&gt;&lt;div&gt;} else if (Command-&amp;gt;currContext != Context) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; // 切换Context&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; ... // 相同的context&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;///////////////////////////////////////////////////////////////////////////////////////////&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="530" width="1000" height="154" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-13" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Command-&amp;gt;newQueue) {...}&lt;br&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//设置之前Context Command Qeue的退出地址, 也就是新的Command的起始地址 一个 WAIT/LINK 序列&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;exitAddress&amp;nbsp;&lt;/b&gt;= waitLinkAddress;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;// 1FF FFFF F090&amp;nbsp; &amp;nbsp; &amp;nbsp;//1FF FFFF F090&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;exitBytes&amp;nbsp;&lt;/b&gt;= waitLinkBytes;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 32&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//在Command queue的头上加入Wait/Link 序列, 暂时LOOP,&amp;nbsp; waitLinkLogical=55AD 21ED 1890&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckWLFE_WaitLink&lt;/b&gt;(hw, waitLinkLogical, waitLinkAddress, offset, &amp;amp;waitLinkBytes, &amp;amp;waitOffset, &amp;amp;waitSize)&amp;nbsp; &amp;nbsp; //会跟新 hw-&amp;gt;lastWaitLink = Address&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="684" width="1000" height="146" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-25" value="&lt;div&gt;&lt;span style=&quot;background-color: initial; color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-wrap-mode: nowrap;&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22Wait%22%20style%3D%22rounded%3D0%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%225880%22%20y%3D%22-1160%22%20width%3D%2290%22%20height%3D%2280%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font face=&quot;monospace&quot; color=&quot;rgba(0, 0, 0, 0)&quot;&gt;&lt;span style=&quot;font-size: 0px; text-wrap-mode: nowrap;&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&amp;nbsp; &amp;nbsp; if (Command-&amp;gt;newQueue) {...}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_CleanCache(.., Command-&amp;gt;videoMem, Command-&amp;gt;offset, waitLinkLogical,&amp;nbsp;&lt;b&gt;exitBytes&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//得到commandBuffer末尾的位置&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;commandBufferTail&lt;/b&gt;&amp;nbsp;= commandBufferLogical + commandBufferSize - CommandBuffer-&amp;gt;reservedTail&amp;nbsp; // 55AD 21F6 3CA8 =&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;55AD 21F6 3A00 +&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;832 - 152&amp;nbsp; //556B E14F 7CA8&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(0, 204, 0);&quot;&gt;&amp;nbsp; &amp;nbsp; //生成写 commit stamp的 Fence cmd&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(0, 204, 0);&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b style=&quot;&quot;&gt;gckHARDWARE_Fence&lt;/b&gt;(hw, gcvENGIN_RENDER, commandBufferTail, Command-&amp;gt;fence-&amp;gt;address, Command-&amp;gt;commitStamp, &amp;amp;fencebytes)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;commandBufferTail&amp;nbsp;&lt;/b&gt;+= fencebytes;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;55AD 21F6 3CC8 =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;55AD 21F6 3CA8 + 32&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="830" width="1000" height="210" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-6" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; if (Shared == false) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckWLFE_Link&lt;/b&gt;(hw,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;commandBufferTail,&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//添加LINK 到command buffer 末尾&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;exitAddress,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//LINK的地址就是 command buffer 的头, 之前在command buffer 头已经加上了WAIT/LINK序列&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;exitBytes, &amp;amp;linkBytes, &amp;amp;exitLinkLow, &amp;amp;exitLinkHight)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else { ...}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_HANDLE_Lookup(); gckVIDMEM_NODE_CleanCache(); //查找commandBufferVideoMem, 并清除cache&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="1040" width="1000" height="150" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-11" value="&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//Link到entryAddress, 此处的LINK会替换之前的WAIT/LINK 序列, 让整个Command 执行起来&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckWLFE_Link&lt;/b&gt;(hw, Command-&amp;gt;waitPos.logical,&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//这个是之前Command Queue的Wait/Link 起始地址&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//55AD 21ED 1870&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryAddress,&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//Link到 context-&amp;gt;buffer(如果有context)&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryBytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;Command-&amp;gt;WaitPos.size,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;entryLinkLow, &amp;amp;entryLinkHigh)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_CleanCache(..., Command-&amp;gt;waitPos.videoMem, Command-&amp;gt;waitPos.offset, Command-&amp;gt;waitPos.logical...)&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="1190" width="1000" height="130" as="geometry" />
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-8" value="&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//更新当前 pipe&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;pipeSelect = CommandBuffer-&amp;gt;exitPipe&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;offset += waitLinkBytes;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 新的offset 就是 176 = 144 + 32,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;newQueue = false;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(0, 204, 0);&quot;&gt;//此处更新Command新的Wait/Link 地址&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;waitPost.videoMem = Command-&amp;gt;videoMem;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;waitPos.offset = Command-&amp;gt;offset - waitLinkBytes + waitOffset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 144 = 176 - 32 + 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;waitPos.logical = waitLinkLogical + waitOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 55AD 21ED 1890&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;waitPos.address = waitLinkAddress + waitOffset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 1FF FFFF F090 + 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;waitPos.size = waitSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp; 16&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckHARDWARE_UpdateQueueTail&lt;/b&gt;(hw, Command-&amp;gt;logical, Command-&amp;gt;offset)&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="U14mofKTcunZ6X7Fo2zi-6" vertex="1">
          <mxGeometry y="1320" width="1000" height="224" as="geometry" />
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-10" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-18" target="U14mofKTcunZ6X7Fo2zi-1" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2797" y="-355" as="sourcePoint" />
            <mxPoint x="2799" y="-285" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="U14mofKTcunZ6X7Fo2zi-11" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.003;entryY=0.186;entryDx=0;entryDy=0;exitX=0.998;exitY=0.636;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;" parent="1" source="U14mofKTcunZ6X7Fo2zi-4" target="U14mofKTcunZ6X7Fo2zi-7" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2881" y="58" as="sourcePoint" />
            <mxPoint x="2880" y="130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-2" value="gc_hal_kernel_event.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3590" y="-230" width="810" height="190" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-3" value="&lt;b&gt;gckEVENT_Commit(gckEVENT Event, gcsQUEUE_PTR Queue, bool Forced, bool Submit, bool Shared)&amp;nbsp;&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="UbzL_sldVN1qwGkXepIT-2" vertex="1">
          <mxGeometry y="26" width="810" height="26" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-4" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="UbzL_sldVN1qwGkXepIT-2" vertex="1">
          <mxGeometry y="52" width="810" height="8" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-5" value="if (Submit) {&lt;div&gt;&amp;nbsp; &amp;nbsp; eventAttr.wait = true&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eventAttr.shared = Shared&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eventAttr.fromPower = false&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; eventAttr.broadcase = true&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckEVENT_Submit(Event, &amp;amp;eventAttr)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="UbzL_sldVN1qwGkXepIT-2" vertex="1">
          <mxGeometry y="60" width="810" height="130" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-7" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-17" target="UbzL_sldVN1qwGkXepIT-2" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="3339" y="-145" as="sourcePoint" />
            <mxPoint x="3570" y="-610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-8" value="gc_hal_kernel_event.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4520" y="-20" width="540" height="1038" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-9" value="&lt;b style=&quot;&quot;&gt;gckEVENT_Submit(gckEVENT Event, gckEVENT_PTR EventAttr)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="26" width="540" height="24" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-11" value="command = Event-&amp;gt;command &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//command 也是 kernel-&amp;gt;command&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;queue &lt;/b&gt;= Event-&amp;gt;queueHead &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//Event-&amp;gt;queues 中的 head(queues 是数组 29个)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="50" width="540" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-4" value="&lt;div&gt;if (queue) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (broadcast) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckCOMMAND_EnterCommit&lt;/b&gt;(command, fromPower)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;&amp;nbsp; &amp;nbsp; //获取当前 commit stamp&amp;nbsp;(已经被加1)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; commitStamp&amp;nbsp;&lt;/b&gt;= command-&amp;gt;commitStamp&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;b&gt;commitStamp&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;commitStamp&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;-= 1&amp;nbsp; //&lt;/span&gt;&lt;b style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;gckCOMMAND_Commit&lt;/b&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;已经被加1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;queue = Event-&amp;gt;queueHead&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//分配event ID, 29个event id 中选择一个&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; gckEVENT_GetEvent&lt;/b&gt;(Event, wait,&amp;nbsp;&lt;b&gt;&amp;amp;id&lt;/b&gt;, queue-&amp;gt;source)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//event ID queue 指向 event list&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Event-&amp;gt;queue[&lt;b&gt;id&lt;/b&gt;].head = queue-&amp;gt;head&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//更新commitStamp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Event-&amp;gt;queue[&lt;b&gt;id&lt;/b&gt;].commitStamp = commitStamp&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//把当前queue 从Event-&amp;gt;queueHead中移除&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//释放queue, 其实是把queue 放到Event-&amp;gt;freeList中&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckEVENT_FreeQueue&lt;/b&gt;(Event, queue)&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="120" width="540" height="360" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-5" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; if (command-&amp;gt;feType == gcvHW_FE_WAIT_LINK || command-&amp;gt;feType == gcvHW_FE_END) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_QueryFlush&lt;/b&gt;(..., &amp;amp;flush)&amp;nbsp;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//获取需要Flush的内容&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//查询 hardware event需要的大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckWLFE_Event&lt;/b&gt;(hw, NULL, id, Event-&amp;gt;queue[id].source, &amp;amp;bytes)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//bytes : 32&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//查询 flush command 需要的大小, 这里应为flush 为0 所以不需要flush, flushBytes :0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckHARDWARE_Flush&lt;/b&gt;(hw, flush, NULL, &amp;amp;flushBytes)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes += flushBytes&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//需要执行的总大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; executeBytes = bytes&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; //Command Qeuue 里面预留空间&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&amp;nbsp; &amp;nbsp; gckCOMMAND_Reserve(command, bytes, &amp;amp;buffer, &amp;amp;bytes) //3920&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="480" width="540" height="220" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-19" value="&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&amp;nbsp; &amp;nbsp; gckOS_AtomIncrement(os, Event-&amp;gt;interruptCount, &amp;amp;oldValue)&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="700" width="540" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-6" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (command-&amp;gt;feType == gcvHW_FE_WAIT_LINK || command-&amp;gt;feType == gcvHW_FE_END) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//添加flush cmd 到command queue&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckHARDWARE_Flush&lt;/b&gt;(hw, flush, buffer, &amp;amp;flushBytes)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//移动Command Queue buffer&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; buffer = buffer + flushBytes;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="726" width="540" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-11" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//添加Event Command&lt;/span&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gckWLFE_Event&lt;/b&gt;(hw, buffer, id, Event-&amp;gt;queues[id].source, &amp;amp;bytes)&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="806" width="540" height="44" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-12" value="&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if(command-&amp;gt;feType == gcvHW_FE_WAIT_LINK) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&lt;b&gt;gckCOMMAND_Execute&lt;/b&gt;(command, executeBytes)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckCOMMAND_ExitCommit&lt;/b&gt;(command, fromPower)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!fromPower)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_TryToIdleGPU&lt;/b&gt;(Event)&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="850" width="540" height="180" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-10" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="UbzL_sldVN1qwGkXepIT-8" vertex="1">
          <mxGeometry y="1030" width="540" height="8" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-12" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-5" target="UbzL_sldVN1qwGkXepIT-8" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="4300" y="1039" as="sourcePoint" />
            <mxPoint x="4602" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-13" value="gc_hal_kernel_hardware_waitlink_fe.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5250" y="646" width="400" height="320" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-14" value="gckWLFE_Event(hw, Logical, uint8 Event, FromWhere, *Bytes)" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="UbzL_sldVN1qwGkXepIT-13" vertex="1">
          <mxGeometry y="26" width="400" height="26" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-15" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="UbzL_sldVN1qwGkXepIT-13" vertex="1">
          <mxGeometry y="52" width="400" height="8" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-16" value="&lt;div&gt;if(blt) {&lt;/div&gt;&amp;nbsp; &amp;nbsp; *logical++ = LOAD_STATE gcregBltGeneralControlRegAddrs&lt;div&gt;&amp;nbsp; &amp;nbsp; *logical++ = LOCK&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (multiCluster) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *logical++ = LOAD_STATE gcregBltClusterControlRegAddrs&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *logical++ = hw-&amp;gt;options.userClusterMask&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*logical++ = LOAD_STATE AQEventRegAddrs&lt;/div&gt;&lt;div&gt;*logical++ = Event (EVENT_ID)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if(blt) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *logical++ = LOAD_STATE gcregBltGeneralControlRegAddrs&lt;br&gt;&amp;nbsp; &amp;nbsp; *logical++ = UNLOCK&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="UbzL_sldVN1qwGkXepIT-13" vertex="1">
          <mxGeometry y="60" width="400" height="260" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-17" value="gc_hal_kernel_command.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5250" y="1090" width="500" height="710" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-18" value="&lt;b&gt;gckCOMMAND_Execute(gckCOMMAND Command, uint32 RequestedBytes)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="UbzL_sldVN1qwGkXepIT-17" vertex="1">
          <mxGeometry y="26" width="500" height="26" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-19" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="UbzL_sldVN1qwGkXepIT-17" vertex="1">
          <mxGeometry y="52" width="500" height="8" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-20" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//计算 WAIT/LINK的offset&lt;/span&gt;&lt;/div&gt;&lt;b&gt;waitLinkOffset &lt;/b&gt;= Command-&amp;gt;offset + RequestedBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//208 = 176 + 32&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//计算Command queue 剩余字节&lt;/span&gt;&lt;/div&gt;&lt;div&gt;waitLinkBytes = Command-&amp;gt;pageSize - waitLinkOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//3888&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//计算 WAIT/LINK 序列的位置&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;waitLinkLogical &lt;/b&gt;= Command-&amp;gt;logical + waitLinkOffset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 55AC 1F9C 08D0&lt;/div&gt;&lt;div&gt;&lt;b&gt;waitLinkAddress &lt;/b&gt;= Command-&amp;gt;address + waitLinkOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 1FF FFFF F0D0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//添加 WAIT/LINK 到command queue&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckWLFE_WaitLink&lt;/b&gt;(hw, waitLinkLogical,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;waitLinkAddress&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;waitLinkOffset,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;waitLinkBytes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;waitOffset, waitBytes)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-17" vertex="1">
          <mxGeometry y="60" width="500" height="230" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-13" value="&lt;div&gt;if (Command-&amp;gt;newQueue) { ...}&lt;/div&gt;&lt;div&gt;else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;execLogical &lt;/b&gt;= Command-&amp;gt;logical + Command-&amp;gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;// 55AC 1F9C 08B0&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;execAddress &lt;/b&gt;= Command-&amp;gt;address + Command-&amp;gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;//&amp;nbsp; &amp;nbsp; 1FF FFFF F0B0&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;execBytes &lt;/b&gt;= RequestedBytes + waitLinkBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 64&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_CleanCache(...)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;//修改之前的Wait为LINK, 指向新添加的CMD&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;gckWLFE_Link(hw, Command-&amp;gt;waitPos.logical,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;55AC 1F9C 0890&lt;/span&gt;&lt;span style=&quot;color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-wrap-mode: nowrap;&quot;&gt;3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%22%20style%3D%22endArrow%3Dclassic%3Bhtml%3D1%3Brounded%3D0%3BexitX%3D0.5%3BexitY%3D1%3BexitDx%3D0%3BexitDy%3D0%3BstrokeWidth%3D5%3BfillColor%3D%2360a917%3BstrokeColor%3D%23000000%3BentryX%3D0%3BentryY%3D0.5%3BentryDx%3D0%3BentryDy%3D0%3B%22%20edge%3D%221%22%20target%3D%223%22%20parent%3D%221%22%3E%3CmxGeometry%20width%3D%2250%22%20height%3D%2250%22%20relative%3D%221%22%20as%3D%22geometry%22%3E%3CmxPoint%20x%3D%226100%22%20y%3D%22920%22%20as%3D%22sourcePoint%22%2F%3E%3CmxPoint%20x%3D%226120%22%20y%3D%22985%22%20as%3D%22targetPoint%22%2F%3E%3CArray%20as%3D%22points%22%3E%3CmxPoint%20x%3D%226100%22%20y%3D%22940%22%2F%3E%3CmxPoint%20x%3D%225980%22%20y%3D%22940%22%2F%3E%3CmxPoint%20x%3D%225980%22%20y%3D%22980%22%2F%3E%3C%2FArray%3E%3C%2FmxGeometry%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%223%22%20value%3D%22Command%2FContext%20Buffer%22%20style%3D%22rounded%3D0%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%226030%22%20y%3D%22966%22%20width%3D%22170%22%20height%3D%2230%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3CmxCell%20id%3D%224%22%20value%3D%22%22%20style%3D%22endArrow%3Dclassic%3Bhtml%3D1%3Brounded%3D0%3BexitX%3D1%3BexitY%3D0.5%3BexitDx%3D0%3BexitDy%3D0%3BstrokeWidth%3D5%3BfillColor%3D%2360a917%3BstrokeColor%3D%23000000%3BentryX%3D0%3BentryY%3D1%3BentryDx%3D0%3BentryDy%3D0%3B%22%20edge%3D%221%22%20source%3D%223%22%20parent%3D%221%22%3E%3CmxGeometry%20width%3D%2250%22%20height%3D%2250%22%20relative%3D%221%22%20as%3D%22geometry%22%3E%3CmxPoint%20x%3D%226405%22%20y%3D%22940%22%20as%3D%22sourcePoint%22%2F%3E%3CmxPoint%20x%3D%226205%22%20y%3D%22920%22%20as%3D%22targetPoint%22%2F%3E%3CArray%20as%3D%22points%22%3E%3CmxPoint%20x%3D%226260%22%20y%3D%22980%22%2F%3E%3CmxPoint%20x%3D%226260%22%20y%3D%22950%22%2F%3E%3CmxPoint%20x%3D%226205%22%20y%3D%22950%22%2F%3E%3C%2FArray%3E%3C%2FmxGeometry%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; execAddress, execBytes,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp; &amp;nbsp; 1FF FFFF F0B0&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;Command-&amp;gt;waitPos.size,&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;linkLow, &amp;amp;linkHight)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckVIDMEM_NODE_CleanCache(...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-17" vertex="1">
          <mxGeometry y="290" width="500" height="230" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-14" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//更新到最后一个WAIT&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;waitPos.videoMem = Command-&amp;gt;videoMem&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;waitPos.offset = waitLinkOffset + waitOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 208&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;waitPos.logical = waitLinkLogical + waitOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 55AC 1F9C 08D0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;waitPos.address = waitLinkAddress + waitOffset&amp;nbsp; &amp;nbsp; &amp;nbsp; // 1FF FFFF F0D0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;waitPos.size = waitBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 16&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//更新command queue&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;offset += RequestedBytes + waitLinkBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 240&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;Command-&amp;gt;newQueue =false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckHARDWARE_UpdateQueueTail(...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;strokeWidth=2;" parent="UbzL_sldVN1qwGkXepIT-17" vertex="1">
          <mxGeometry y="520" width="500" height="190" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-21" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Ix4tDqSeoH92LrqUYnLb-11" target="UbzL_sldVN1qwGkXepIT-13" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5060" y="190" as="sourcePoint" />
            <mxPoint x="4530" y="1" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-22" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Ix4tDqSeoH92LrqUYnLb-12" target="UbzL_sldVN1qwGkXepIT-17" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5185" y="232" as="sourcePoint" />
            <mxPoint x="5370" y="-60" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-25" value="createCommandBufferPool(processor_PTR processor)&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;processor-&amp;gt;commandBufferOffset = 256&lt;/div&gt;" style="html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="520" y="-1605" width="370" height="60" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-26" value="" style="endArrow=classic;html=1;rounded=0;entryX=-0.005;entryY=0.087;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-25" target="QSAenKkpdjQW8zQk9t1L-74" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="-1525" as="sourcePoint" />
            <mxPoint x="840" y="-1575" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-27" value="ENV" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-900" y="-3010" width="270" height="86" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-28" value="VIV_CUDA_DRV_PROFILE" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="UbzL_sldVN1qwGkXepIT-27" vertex="1">
          <mxGeometry y="26" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-29" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="UbzL_sldVN1qwGkXepIT-27" vertex="1">
          <mxGeometry y="52" width="270" height="8" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-30" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="UbzL_sldVN1qwGkXepIT-27" vertex="1">
          <mxGeometry y="60" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-31" value="&lt;div&gt;&lt;b&gt;iniDriver()-&amp;gt;createProcessor()--&amp;gt;attachToKMD&lt;/b&gt;&lt;/div&gt;&lt;div&gt;--&amp;gt; iface = {gcvHAL_ATTACH}&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; for (int i=0; i&amp;lt;processor-&amp;gt;coreCount; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;KmdIoCtrl(...)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;processor-&amp;gt;context[i] = iface.u.Attach.context (一个数字ID)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;...&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;processor-&amp;gt;contextBytes = iface.u.Attach.bytes&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;processor-&amp;gt;contextLogical[2*i + 0] = iface.u.Attach.logicals[0]&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;processor-&amp;gt;contextLogical[2*i + 0] = iface.u.Attach.logicals[1]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;" style="html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="520" y="-1390" width="370" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-32" value="" style="endArrow=classic;html=1;rounded=0;entryX=-0.002;entryY=0.604;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-31" target="QSAenKkpdjQW8zQk9t1L-74" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="-1580" as="sourcePoint" />
            <mxPoint x="947" y="-1528" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-33" value="attachToKMD-&amp;gt;gckKERNEL_Dispatch()-&amp;gt;gckKERNEL_AllocateNameFromPointer()&lt;br&gt;--&amp;gt; gckKERNEL_AllocateIntegerId(...)" style="html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="3050" y="-1070" width="465" height="60" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-34" value="" style="endArrow=classic;html=1;rounded=0;entryX=-0.002;entryY=0.25;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-33" target="U14mofKTcunZ6X7Fo2zi-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2510" y="-1340" as="sourcePoint" />
            <mxPoint x="2562" y="-1331" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-42" value="ResvHead&lt;br&gt;32" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1025" y="-785" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-43" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="915" y="-785" width="110" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-44" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="1125" y="-785" width="410" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UbzL_sldVN1qwGkXepIT-40" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1125" y="-745" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-1" value="ResvTail&lt;br&gt;128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1385" y="-745" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-3" value="&lt;span style=&quot;font-weight: 700;&quot;&gt;Command Buffer&lt;/span&gt;&lt;br style=&quot;font-weight: 700;&quot;&gt;&lt;span style=&quot;font-weight: 700;&quot;&gt;Next&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1535" y="-785" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-4" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="7528.99" y="-1580" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-5" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7413.99" y="-1580" width="115" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-6" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="7888.99" y="-1580" width="710" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-7" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="7888.99" y="-1540" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-8" value="ResvTail&lt;br&gt;128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8148.99" y="-1540" width="430" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-9" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="8598.99" y="-1580" width="210" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-10" value="Context Switch" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9800" y="-2025" width="740" height="570" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-11" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;contextBuffer = Context-&amp;gt;buffer&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//556B E147 ABA0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; //合并delta 数据到context buffer&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;b&gt;gckCONTEXT_Update&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(204, 255, 255);&quot;&gt;(Context, ProcessID, StateDelta)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&amp;nbsp; &amp;nbsp; //得到 context buffer 的 entry offset&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; offset = (Command-&amp;gt;pipeSelect == gcvPIP_3D) ?&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Context-&amp;gt;entryOffset3D + Context-&amp;gt;pipSelectBytes&amp;nbsp;&amp;nbsp;//8 就是跳过 pipe switching sequence&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; : Context-&amp;gt;entryOffset3D&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //0 不跳过 pipe switching sequence&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fillColor=default;" parent="HmzNs-rwB6UDGuZFhDU5-10" vertex="1">
          <mxGeometry y="26" width="740" height="114" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-78" value="&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//得到context buffer 的起始地址与大小&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; entryLogical = contextBuffer-&amp;gt;logical + offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 556B E14E 8A00&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryAddress = contextBuffer-&amp;gt;address + offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 1FF FFFF 90000&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryBytes = Context-&amp;gt;bufferSize - offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 18368&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//检查是否需要添加切换pipe的cmd&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (CommandBuffer-&amp;gt;entryPipe == gcvPIPE_3D) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//跳过切换pipe的预留cmd长度&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset = CommandBuffer-&amp;gt;reservedHead&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //32&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//添加切换pipe的cmd&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;gckHARDWARE_PipeSelect&lt;/b&gt;(...)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fillColor=default;" parent="HmzNs-rwB6UDGuZFhDU5-10" vertex="1">
          <mxGeometry y="140" width="740" height="204" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-76" value="&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;//通过 contextBuffer link3D的位置 LINK 到 commandBuffer + offset(就是command buffer 的起始)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckWLFE_Link&lt;/b&gt;(hw,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contextBuffer-&amp;gt;link3D,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;commandBufferAddress + offset,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;FF7F E100 =&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;FF7F E100 + 32&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;commandBufferSize - offset,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;linkBytes,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 16&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;commandLinkLow,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;B800 0064&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;link cmd 的值&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;commandLinkHigh)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// FF7F E120 fetchAddress 就是 command Buffer Address&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(...., (entryAddress - contextBuffer-&amp;gt;address), entryLogical,&amp;nbsp;&lt;b&gt;entryBytes&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//切换context&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Command-&amp;gt;currContext = Context;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *contextSwitched = true;&lt;/div&gt;" style="text;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fillColor=default;" parent="HmzNs-rwB6UDGuZFhDU5-10" vertex="1">
          <mxGeometry y="344" width="740" height="218" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-12" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="HmzNs-rwB6UDGuZFhDU5-10" vertex="1">
          <mxGeometry y="562" width="740" height="8" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-16" value="No Context" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7418.99" y="-2040" width="740" height="298" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-17" value="if(CommandBuffer-&amp;gt;entryPipe == Command-&amp;gt;pipeSelect {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;offset &lt;/b&gt;= CommandBuffer-&amp;gt;reservedHead;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 32, 此吃offset 就是跳过switch pipe的cmd&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pipeBytes = CommandBuffer-&amp;gt;reservedHead;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 32&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//需要切换Pipe&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckHARDWARE_PipeSelect&lt;/b&gt;(hw,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; commandBufferLogical,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CommandBuffer-&amp;gt;entryPipe, &amp;amp;pipeBytes)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;offset &lt;/b&gt;= 0; //就是指向reservedHead头&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;span style=&quot;background-color: rgb(0, 204, 0);&quot;&gt;//entry 都是command Buffer 的地址&lt;br&gt;&lt;/span&gt;&lt;b&gt;entryLogical &lt;/b&gt;= commandBufferLogical + offset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 55AD 21F6 3A00&amp;nbsp; + 0/32&lt;br&gt;&lt;b&gt;entryAddress &lt;/b&gt;= commandBufferAddress + offset;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // FF7F E100&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; + 0/32&lt;br&gt;&lt;b&gt;entryBytes &lt;/b&gt;= commandBufferSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 832&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; - 0/32&lt;br&gt;Command-&amp;gt;currContext = NULL&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=default;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="HmzNs-rwB6UDGuZFhDU5-16" vertex="1">
          <mxGeometry y="26" width="740" height="264" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-18" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="HmzNs-rwB6UDGuZFhDU5-16" vertex="1">
          <mxGeometry y="290" width="740" height="8" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-20" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="7528.99" y="-1550" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-21" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="7708.99" y="-1550" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-22" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="7798.99" y="-1550" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-23" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="7618.99" y="-1550" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-24" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="7523.99" y="-1049" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-25" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7413.99" y="-1049" width="110" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-26" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="7883.99" y="-1049" width="735" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-27" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="7883.99" y="-1019" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-28" value="ResvTail 128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="8143.99" y="-1019" width="455" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-29" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="8618.99" y="-1049" width="210" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-30" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7523.99" y="-1019" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-31" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7703.99" y="-1019" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-32" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7793.99" y="-1019" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-33" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7613.99" y="-1019" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-34" value="Command Queue" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="7413.99" y="-1270" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-35" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="7340" y="-1270" width="208.99" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-36" value="添加Select Pipe 如果需要" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=0.496;exitY=0.319;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-18" target="HmzNs-rwB6UDGuZFhDU5-5" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6148.99" y="-2017" as="sourcePoint" />
            <mxPoint x="6210.99" y="-2197" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-37" value="添加 Wait Link" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-13" target="HmzNs-rwB6UDGuZFhDU5-35" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6460" y="-1457" as="sourcePoint" />
            <mxPoint x="6570" y="-1139" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-38" value="Wait" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="7548.99" y="-1270" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-39" value="Link" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="7638.99" y="-1270" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-40" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-39" target="HmzNs-rwB6UDGuZFhDU5-38" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="7658.99" y="-1290" as="sourcePoint" />
            <mxPoint x="7708.99" y="-1340" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7683.99" y="-1320" />
              <mxPoint x="7548.99" y="-1320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-51" value="添加 Fence commitStamp" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-25" target="HmzNs-rwB6UDGuZFhDU5-25" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6462.730000000001" y="-1379.7800000000002" as="sourcePoint" />
            <mxPoint x="6555" y="-876" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-52" value="LoadState&lt;br&gt;fenceHiAddr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="8143.99" y="-989" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-53" value="LoadState&lt;br&gt;fenceAddr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="8218.99" y="-989" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-54" value="LoadState&lt;br&gt;fenceDataH" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="8293.99" y="-989" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-55" value="LoadState&lt;br&gt;fenceDataL" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="8368.99" y="-989" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-56" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="7523.99" y="-880" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-57" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7413.99" y="-880" width="110" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-58" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="7883.99" y="-880" width="735" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-59" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="7883.99" y="-850" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-60" value="ResvTail 128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="8143.99" y="-850" width="455" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-61" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="8618.99" y="-880" width="210" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-62" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7523.99" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-63" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7703.99" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-64" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7793.99" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-65" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7613.99" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-66" value="LoadState&lt;br&gt;fenceHiAddr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8143.99" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-67" value="LoadState&lt;br&gt;fenceAddr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8218.99" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-68" value="LoadState&lt;br&gt;fenceDataH" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8293.99" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-69" value="LoadState&lt;br&gt;fenceDataL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8368.99" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-70" value="添加 Link 到 CommandQueue" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-6" target="HmzNs-rwB6UDGuZFhDU5-57" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6461.8200000000015" y="-1328.9600000000003" as="sourcePoint" />
            <mxPoint x="6550" y="-997" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-71" value="LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="8443.99" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-72" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-71" target="HmzNs-rwB6UDGuZFhDU5-38" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8513.99" y="-1097" as="sourcePoint" />
            <mxPoint x="8378.99" y="-1097" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8478.99" y="-1087" />
              <mxPoint x="7548.99" y="-1087" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-73" value="Command Queue" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="7408.99" y="-682" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-74" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="7340" y="-682" width="203.99" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-75" value="Wait" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="7543.99" y="-682" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-76" value="Link" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="7633.99" y="-682" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-77" value="添加Link 到 Command Buffer Start" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-11" target="HmzNs-rwB6UDGuZFhDU5-74" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6458.18" y="-1272.2000000000003" as="sourcePoint" />
            <mxPoint x="6690" y="-807" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-78" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;strokeWidth=5;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-71" target="HmzNs-rwB6UDGuZFhDU5-75" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8486.99" y="-747" as="sourcePoint" />
            <mxPoint x="7558.99" y="-1117" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8481.99" y="-477" />
              <mxPoint x="7543.99" y="-477" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-79" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="7678.99" y="-682" as="sourcePoint" />
            <mxPoint x="7543.99" y="-682" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7678.99" y="-732" />
              <mxPoint x="7543.99" y="-732" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-80" value="LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="7403.99" y="-655" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-81" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeWidth=5;entryX=0;entryY=1;entryDx=0;entryDy=0;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-80" target="HmzNs-rwB6UDGuZFhDU5-62" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="7523.99" y="-297" as="sourcePoint" />
            <mxPoint x="7938.99" y="-277" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7440" y="-700" />
              <mxPoint x="7523.99" y="-700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-82" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;exitX=1.006;exitY=0.383;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-8" target="HmzNs-rwB6UDGuZFhDU5-76" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6462" y="-437" as="sourcePoint" />
            <mxPoint x="6510" y="-567" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7640" y="-440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-83" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;offset&amp;nbsp;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="HmzNs-rwB6UDGuZFhDU5-82" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="723" y="-119" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-85" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;55AD 21ED 1800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7340" y="-1330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-86" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;55AD 21ED 1870&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7438.99" y="-602" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-87" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.001;exitY=0.629;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-8" target="HmzNs-rwB6UDGuZFhDU5-75" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6465.460000000001" y="-1154.7200000000003" as="sourcePoint" />
            <mxPoint x="6810" y="-527" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7210" y="-386" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HmzNs-rwB6UDGuZFhDU5-88" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;waitPos.logical&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=#FFFFFF;" parent="HmzNs-rwB6UDGuZFhDU5-87" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="121" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XHSnjxVOCnQZ8cdE8w61-26" value="没有 Context的情况" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-2" target="HmzNs-rwB6UDGuZFhDU5-16" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="6470" y="-1080" as="sourcePoint" />
            <mxPoint x="6650" y="-1197" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-12" value="_WaitFence(...) 中会等待该command-&amp;gt;commitStamp&lt;br&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; fence = command-&amp;gt;fence&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;" style="html=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="8491.49" y="-1240" width="465" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-13" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=3;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-12" target="HmzNs-rwB6UDGuZFhDU5-55" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8498.99" y="-1240" as="sourcePoint" />
            <mxPoint x="8548.99" y="-1290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-19" value="&lt;span style=&quot;text-align: left;&quot;&gt;Start Address: 556B E14F 7900&lt;br&gt;FF7F E000&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-1800" width="100" height="66" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-20" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10905" y="-1734" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-21" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-1734" width="115" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-22" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="11265" y="-1734" width="410" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-23" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="11265" y="-1694" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-24" value="ResvTail&lt;br&gt;128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11525" y="-1694" width="130" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-25" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="11675" y="-1734" width="130" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-26" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="10905" y="-1704" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-27" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="11085" y="-1704" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-28" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="11175" y="-1704" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-29" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="10995" y="-1704" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-30" value="&lt;b&gt;Context Buffer&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E14E 8A00&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-1457" width="1020" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-31" value="&lt;span style=&quot;text-align: left;&quot;&gt;entryLogical&lt;br&gt;556B E14E 8A00&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-1457" width="115" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-32" value="link3D&lt;br&gt;556B E14E D1B0" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="11175" y="-1420" width="195" height="83" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-33" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-32" target="RsXz8Ytodcc2n_-1sCKY-23" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11190" y="-1270" as="sourcePoint" />
            <mxPoint x="11273" y="-1260" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11273" y="-1260" />
              <mxPoint x="11850" y="-1260" />
              <mxPoint x="11850" y="-1540" />
              <mxPoint x="11265" y="-1540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-34" value="切换Context的情况" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-2" target="HmzNs-rwB6UDGuZFhDU5-10" edge="1">
          <mxGeometry x="0.9192" y="17" width="80" relative="1" as="geometry">
            <mxPoint x="6490" y="-1250" as="sourcePoint" />
            <mxPoint x="8240" y="-1600" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-35" value="&lt;b&gt;Command Queue&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="10750" y="-1060" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-36" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10705" y="-1060" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-37" value="Wait" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="10885" y="-1060" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-38" value="Link" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="10975" y="-1060" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-39" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-38" target="RsXz8Ytodcc2n_-1sCKY-37" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10995" y="-1080" as="sourcePoint" />
            <mxPoint x="11045" y="-1130" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11020" y="-1110" />
              <mxPoint x="10885" y="-1110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-40" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E146 5800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10705" y="-1120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-41" value="添加 Wait Link" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-13" target="RsXz8Ytodcc2n_-1sCKY-40" edge="1">
          <mxGeometry x="0.6947" y="11" width="80" relative="1" as="geometry">
            <mxPoint x="6460" y="-1090" as="sourcePoint" />
            <mxPoint x="8570" y="-1200" as="targetPoint" />
            <Array as="points" />
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-42" value="添加 Fence commitStamp" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-25" target="RsXz8Ytodcc2n_-1sCKY-44" edge="1">
          <mxGeometry x="0.6294" y="11" width="80" relative="1" as="geometry">
            <mxPoint x="6430" y="-850" as="sourcePoint" />
            <mxPoint x="9560" y="-920" as="targetPoint" />
            <Array as="points" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-43" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10900" y="-880" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-44" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-880" width="110" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-45" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="11260" y="-880" width="735" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-46" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="11260" y="-850" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-47" value="ResvTail 128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="11520" y="-850" width="455" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-48" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="11995" y="-880" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-49" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10900" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-50" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11080" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-51" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11170" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-52" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10990" y="-850" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-53" value="LoadState&lt;br&gt;fenceHiAddr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="11520" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-54" value="LoadState&lt;br&gt;fenceAddr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="11595" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-55" value="LoadState&lt;br&gt;fenceDataH" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="11670" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-56" value="LoadState&lt;br&gt;fenceDataL" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="11745" y="-820" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-57" value="ResvHead&amp;nbsp;32" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10900" y="-657" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-58" value="StartOffset&lt;br&gt;256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10790" y="-657" width="110" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-59" value="832" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;align=center;" parent="1" vertex="1">
          <mxGeometry x="11260" y="-657" width="735" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-60" value="User Commands&lt;br&gt;648 (162*4)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="11260" y="-627" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-61" value="ResvTail 128-&amp;gt;152" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="11520" y="-627" width="455" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-62" value="Command Buffer&lt;br&gt;Next" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="11995" y="-657" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-63" value="LoadState&lt;div&gt;flush, Sema&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10900" y="-627" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-64" value="STALL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11080" y="-627" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-65" value="LoadState&lt;br&gt;PipeSel" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11170" y="-627" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-66" value="LoadState&lt;div&gt;Semaphore&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10990" y="-627" width="90" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-67" value="LoadState&lt;br&gt;fenceHiAddr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11520" y="-597" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-68" value="LoadState&lt;br&gt;fenceAddr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11595" y="-597" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-69" value="LoadState&lt;br&gt;fenceDataH" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11670" y="-597" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-70" value="LoadState&lt;br&gt;fenceDataL" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11745" y="-597" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-71" value="LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="11820" y="-597" width="75" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-72" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeWidth=5;entryX=1;entryY=1;entryDx=0;entryDy=0;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-71" target="RsXz8Ytodcc2n_-1sCKY-36" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11813" y="-605" as="sourcePoint" />
            <mxPoint x="10885" y="-980" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11860" y="-935" />
              <mxPoint x="10885" y="-935" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-73" value="添加 Link 到 CommandQueue" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-6" target="RsXz8Ytodcc2n_-1sCKY-58" edge="1">
          <mxGeometry x="0.7317" y="-5" width="80" relative="1" as="geometry">
            <mxPoint x="6440" y="-902" as="sourcePoint" />
            <mxPoint x="9570" y="-910" as="targetPoint" />
            <Array as="points" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-74" value="Command Queue" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="10750" y="-359" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-75" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10630" y="-359" width="255" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-76" value="Wait" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="10885" y="-359" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-77" value="Link" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="10975" y="-359" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-78" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-77" target="RsXz8Ytodcc2n_-1sCKY-76" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10995" y="-379" as="sourcePoint" />
            <mxPoint x="11045" y="-429" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11020" y="-409" />
              <mxPoint x="10885" y="-409" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-79" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E146 5800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10630" y="-419" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-80" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-71" target="RsXz8Ytodcc2n_-1sCKY-75" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11868" y="-587" as="sourcePoint" />
            <mxPoint x="10895" y="-970" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11858" y="-230" />
              <mxPoint x="10885" y="-230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-81" value="添加Link 到 Command Buffer Start" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-11" target="RsXz8Ytodcc2n_-1sCKY-79" edge="1">
          <mxGeometry x="0.7631" y="28" width="80" relative="1" as="geometry">
            <mxPoint x="6440" y="-722" as="sourcePoint" />
            <mxPoint x="9570" y="-687" as="targetPoint" />
            <Array as="points" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-83" value="LINK&lt;br&gt;556B E146 5870" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="10715" y="-329" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-84" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;entryX=0;entryY=1;entryDx=0;entryDy=0;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="RsXz8Ytodcc2n_-1sCKY-83" target="RsXz8Ytodcc2n_-1sCKY-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10400" y="-183" as="sourcePoint" />
            <mxPoint x="10445" y="-303" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10765" y="-210" />
              <mxPoint x="10600" y="-210" />
              <mxPoint x="10600" y="-1260" />
              <mxPoint x="10790" y="-1260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-85" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" target="RsXz8Ytodcc2n_-1sCKY-77" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6430" y="-440" as="sourcePoint" />
            <mxPoint x="8120" y="-330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7640" y="-440" />
              <mxPoint x="8860" y="-200" />
              <mxPoint x="10460" y="-200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-86" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;offset&amp;nbsp;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="RsXz8Ytodcc2n_-1sCKY-85" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="1757" y="39" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-87" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.629;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=1;entryDx=0;entryDy=0;" parent="1" source="XHSnjxVOCnQZ8cdE8w61-8" target="RsXz8Ytodcc2n_-1sCKY-76" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6430" y="-390" as="sourcePoint" />
            <mxPoint x="8260" y="-70" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7210" y="-386" />
              <mxPoint x="8330" y="-120" />
              <mxPoint x="10780" y="-120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-88" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;waitPos.logical&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="RsXz8Ytodcc2n_-1sCKY-87" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="2045" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RsXz8Ytodcc2n_-1sCKY-89" value="跳过 select pipe的示例" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-78" target="RsXz8Ytodcc2n_-1sCKY-21" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="7670" y="-1190" as="sourcePoint" />
            <mxPoint x="10580" y="-1980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-7" value="gc_hal_kernel_hardware.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5250" y="190" width="720" height="360" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-8" value="&lt;b&gt;gckCOMMAND_Reserve(Command, RequestedBytes, *Buffer, *BufferSize)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="Ix4tDqSeoH92LrqUYnLb-7" vertex="1">
          <mxGeometry y="26" width="720" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-9" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="Ix4tDqSeoH92LrqUYnLb-7" vertex="1">
          <mxGeometry y="52" width="720" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-10" value="if (Command-&amp;gt;feType == gcvHW_FE_WAIT_LINK) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//Command-&amp;gt;alignment = 8&lt;/span&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; requestedAligned = ALIGN(RequestedBytes, Command-&amp;gt;alignment)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//requestedAligned = 32&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//在requested area 之后会插入WAIT LINK 序列, 此处查询 WAIT LINK 所需bytes&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckWLFE_WaitLink&lt;/b&gt;(hw, NULL, INVALID_ADDRESS,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Command-&amp;gt;offset+requestedAlign,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 176 + 32&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;requiredBytes,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NULL, NULL)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; requiredBytes += requestedAligned&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 64&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//查询command Queue 剩余大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;bytes = Command-&amp;gt;pageSize - Command-&amp;gt;offset&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;if (bytes &amp;lt;= requiredBytes) { .... _NewQueue(...)}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//设置reserved area 的起始地址 和 大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;*Buffer = Command-&amp;gt;logical + Command-&amp;gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;55AC 1F9C 09B0&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; 55AC 1F9C 0900 + 176&lt;/span&gt;&lt;/div&gt;&lt;div&gt;*BufferSize = bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 3920&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="Ix4tDqSeoH92LrqUYnLb-7" vertex="1">
          <mxGeometry y="60" width="720" height="300" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-14" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="Ix4tDqSeoH92LrqUYnLb-5" target="Ix4tDqSeoH92LrqUYnLb-7" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5070" y="783" as="sourcePoint" />
            <mxPoint x="5260" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-20" value="Command Queue&amp;nbsp; &amp;nbsp;&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;align=right;" parent="1" vertex="1">
          <mxGeometry x="6070" y="840" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-21" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="5950" y="840" width="255" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-22" value="Wait&lt;div&gt;16&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="6205" y="840" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-23" value="Link&lt;div&gt;16&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="6295" y="840" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-24" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;" parent="1" source="Ix4tDqSeoH92LrqUYnLb-23" target="Ix4tDqSeoH92LrqUYnLb-22" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6315" y="820" as="sourcePoint" />
            <mxPoint x="6365" y="770" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6340" y="790" />
              <mxPoint x="6205" y="790" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-25" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E146 5800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5950" y="780" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-26" value="LINK&lt;br&gt;556B E146 5870" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6050" y="870" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-27" value="Event&lt;br&gt;32" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="6385" y="840" width="105" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ix4tDqSeoH92LrqUYnLb-28" value="添加Event" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-16" target="Ix4tDqSeoH92LrqUYnLb-21" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5910" y="838" as="sourcePoint" />
            <mxPoint x="6020" y="1070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-1" value="Command Queue&amp;nbsp; &amp;nbsp;&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;align=right;" parent="1" vertex="1">
          <mxGeometry x="6070" y="1170" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-2" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="5950" y="1170" width="255" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-3" value="Wait&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="6205" y="1170" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-4" value="Link&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="6295" y="1170" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-5" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-4" target="qIvAuGTGZv5WA7IhcWgH-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6315" y="1150" as="sourcePoint" />
            <mxPoint x="6365" y="1100" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6340" y="1120" />
              <mxPoint x="6205" y="1120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-6" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E146 5800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5950" y="1110" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-7" value="LINK&lt;br&gt;556B E146 5870" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6050" y="1200" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-8" value="Event&lt;br&gt;32" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="6385" y="1170" width="105" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-15" value="添加 WAIT LINK" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="UbzL_sldVN1qwGkXepIT-20" target="qIvAuGTGZv5WA7IhcWgH-2" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5660" y="910" as="sourcePoint" />
            <mxPoint x="5960" y="910" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-16" value="WAIT&lt;div&gt;16&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="6490" y="1170" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-17" value="LINK&lt;div&gt;16&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="6590" y="1170" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-18" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-17" target="qIvAuGTGZv5WA7IhcWgH-16" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6625" y="1170" as="sourcePoint" />
            <mxPoint x="6490" y="1170" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6640" y="1120" />
              <mxPoint x="6490" y="1120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-19" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Ix4tDqSeoH92LrqUYnLb-26" target="qIvAuGTGZv5WA7IhcWgH-20" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6350" y="850" as="sourcePoint" />
            <mxPoint x="6120" y="985" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6100" y="940" />
              <mxPoint x="5980" y="940" />
              <mxPoint x="5980" y="980" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-20" value="Command/Context Buffer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6030" y="966" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-24" value="Command Queue&amp;nbsp; &amp;nbsp;&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;align=right;" parent="1" vertex="1">
          <mxGeometry x="6060" y="1530" width="775" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-25" value="offset&amp;nbsp;144" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="5940" y="1530" width="255" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-26" value="LINK&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" parent="1" vertex="1">
          <mxGeometry x="6195" y="1530" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-27" value="Link&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="6285" y="1530" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-28" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-27" target="qIvAuGTGZv5WA7IhcWgH-26" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6305" y="1510" as="sourcePoint" />
            <mxPoint x="6355" y="1460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6330" y="1480" />
              <mxPoint x="6195" y="1480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-29" value="Start&amp;nbsp;&lt;br&gt;&lt;span style=&quot;text-align: left;&quot;&gt;556B E146 5800&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5940" y="1470" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-30" value="LINK&lt;br&gt;556B E146 5870" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6040" y="1560" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-31" value="Event&lt;br&gt;32" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="6375" y="1530" width="105" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-32" value="WAIT&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="6480" y="1530" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-33" value="LINK&lt;br&gt;16" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="6580" y="1530" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-34" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-33" target="qIvAuGTGZv5WA7IhcWgH-32" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6615" y="1530" as="sourcePoint" />
            <mxPoint x="6480" y="1530" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6630" y="1480" />
              <mxPoint x="6480" y="1480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-37" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=1;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-20" target="Ix4tDqSeoH92LrqUYnLb-22" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6405" y="940" as="sourcePoint" />
            <mxPoint x="6510" y="1005" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6260" y="980" />
              <mxPoint x="6260" y="950" />
              <mxPoint x="6205" y="950" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-38" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="qIvAuGTGZv5WA7IhcWgH-39" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6100" y="1250" as="sourcePoint" />
            <mxPoint x="6120" y="1315" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6100" y="1270" />
              <mxPoint x="5980" y="1270" />
              <mxPoint x="5980" y="1310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-39" value="Command/Context Buffer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6030" y="1296" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-40" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=1;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-39" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6405" y="1270" as="sourcePoint" />
            <mxPoint x="6205" y="1250" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6260" y="1310" />
              <mxPoint x="6260" y="1280" />
              <mxPoint x="6205" y="1280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-41" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="qIvAuGTGZv5WA7IhcWgH-42" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6090" y="1610" as="sourcePoint" />
            <mxPoint x="6110" y="1675" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6090" y="1630" />
              <mxPoint x="5970" y="1630" />
              <mxPoint x="5970" y="1670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-42" value="Command/Context Buffer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="6020" y="1656" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-43" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=1;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-42" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6395" y="1630" as="sourcePoint" />
            <mxPoint x="6195" y="1610" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6250" y="1670" />
              <mxPoint x="6250" y="1640" />
              <mxPoint x="6195" y="1640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-44" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.405;entryY=0.002;entryDx=0;entryDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#2D7600;entryPerimeter=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-26" target="qIvAuGTGZv5WA7IhcWgH-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6640" y="1240" as="sourcePoint" />
            <mxPoint x="6490" y="1240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="6240" y="1430" />
              <mxPoint x="6374" y="1430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-45" value="修改Wait 为 LINK" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-13" target="qIvAuGTGZv5WA7IhcWgH-25" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="5760" y="1275" as="sourcePoint" />
            <mxPoint x="5960" y="1180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-61" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.006;exitY=0.277;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=1;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-14" target="qIvAuGTGZv5WA7IhcWgH-32" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="6001" y="1916" as="sourcePoint" />
            <mxPoint x="6110" y="1750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="5930" y="1720" />
              <mxPoint x="6130" y="1720" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-62" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;waitPos.logical&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=#FFFFFF;" parent="qIvAuGTGZv5WA7IhcWgH-61" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="-62" y="17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-64" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.005;exitY=0.715;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-14" target="qIvAuGTGZv5WA7IhcWgH-33" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="5763" y="1743" as="sourcePoint" />
            <mxPoint x="6490" y="1690" as="targetPoint" />
            <Array as="points">
              <mxPoint x="5920" y="1800" />
              <mxPoint x="6140" y="1800" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-65" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;新的 Command-&amp;gt;offset&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=#FFFFFF;" parent="qIvAuGTGZv5WA7IhcWgH-64" vertex="1" connectable="0">
          <mxGeometry x="-0.0742" y="5" relative="1" as="geometry">
            <mxPoint x="-168" y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-66" value="gc_hal_kernel_context.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10890" y="-2460" width="600" height="330" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-67" value="&lt;b&gt;gckCONTEXT_Update(Context, ProcessID, StateDelta)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="qIvAuGTGZv5WA7IhcWgH-66" vertex="1">
          <mxGeometry y="26" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-68" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-66" vertex="1">
          <mxGeometry y="52" width="600" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-69" value="buffer = Context-&amp;gt;buffer&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 55E1 5E39 3BA0&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//等待 context buffer 可用, 并且reset signal 和标记 buffer busy&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;b&gt;gckOS_WaitSignal&lt;/b&gt;(os, &lt;b&gt;buffer-&amp;gt;signal&lt;/b&gt;, false, kernel-&amp;gt;timeOunt)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (buffer-&amp;gt;deltaCount != 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (StateDelta) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //用户定义相关&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//调度Event中断去trigger signal, 此处的eventObj 也是之后EVENT_Commit的 eventobj&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckEVENT_Signal&lt;/b&gt;(buffer-&amp;gt;eventObj, &lt;b&gt;buffer-&amp;gt;signal&lt;/b&gt;, gcvKERNEL_PIXEL)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; gckEVENT_AddList(Event, &amp;amp;iface, FromWhere, false, true)&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//前进到下一个 Context Buffer, Context-&amp;gt;buffer 在调用本函数时, 外部已经获取&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;Context-&amp;gt;buffer = buffer-&amp;gt;next;&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=default;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-66" vertex="1">
          <mxGeometry y="60" width="600" height="270" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-71" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="HmzNs-rwB6UDGuZFhDU5-11" target="qIvAuGTGZv5WA7IhcWgH-66" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="9810" y="-2560" as="sourcePoint" />
            <mxPoint x="10070" y="-3360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-72" value="Context Buffer Link 到 Command Buffer" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-76" target="RsXz8Ytodcc2n_-1sCKY-31" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="10550" y="-1722" as="sourcePoint" />
            <mxPoint x="10800" y="-1724" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-80" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-97" target="qIvAuGTGZv5WA7IhcWgH-99" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="14590" y="-1890" as="sourcePoint" />
            <mxPoint x="10540" y="-1910" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-82" value="gc_hal_kernel_event.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11760" y="-2542.5" width="650" height="660" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-83" value="&lt;b&gt;gckEVENT_AddList(Event, Interface, FromWhere, AllocateAllowed, FromKernel)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="qIvAuGTGZv5WA7IhcWgH-82" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-84" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-82" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-85" value="&lt;div&gt;gckEVENT_AddListEX(Event, Interface, FromWhere, AllocateAllowed, FromKernel, 0)&lt;/div&gt;&lt;div&gt;--&amp;gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//从&lt;b&gt;Event-&amp;gt;freeEventList&lt;/b&gt; 取出一个gcsEVENT_PTR, 这里Allocate是true, 所以freeCount 不够了可以&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckEVENT_AllocateRecord&lt;/b&gt;(Event, AllocateAllowed, &amp;amp;record)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; record-&amp;gt;next = gcvNULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;// 记录committer&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; record-&amp;gt;fromKernel= FromKernel&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Interface.command = gcvHAL_SIGNAL&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Interface.u.Signal.signal = Signal&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Interface.u.Signal.auxSignal = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Interface.u.Signal.process = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_MemCopy&lt;/b&gt;(&amp;amp;record-&amp;gt;info, Interface, record-&amp;gt;info)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (ProcessID)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; record-&amp;gt;processID = ProcessID&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_GetProcessID&lt;/b&gt;(&amp;amp;record-&amp;gt;processID)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Interface-&amp;gt;command == gcvHAL_UNLOCK_VIDEO_MEMORY &amp;amp;&amp;amp; Interface-&amp;gt;u.UnlockVideoMemory.mmu)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; record-&amp;gt;mmu = Interface-&amp;gt;u.UnlockVideoMemory.mmu&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;gckKERNEL_GetCurrentMMU&lt;/b&gt;(Event-&amp;gt;kernel, !FromKernel, record-&amp;gt;processID, &amp;amp;record-&amp;gt;mmu)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (FromKernel == gcvFALSE) { ... }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//如果queue 没有, 创建新的queue, 并连接到Event上&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Event-&amp;gt;queueTail == NULL ......) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//获取&lt;b&gt;Event-&amp;gt;freeList&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckEVENT_AllocateQueue&lt;/b&gt;(Event, &amp;amp;queue)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;queue-&amp;gt;source = FromWhere&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Event-&amp;gt;queueHead = queue&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Event-&amp;gt;queueTail = queue&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//添加record 到queue上面, 链表操作&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (queue-&amp;gt;head == NULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; queue-&amp;gt;head = record&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; queue-&amp;gt;tail = record&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else { ...}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=default;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-82" vertex="1">
          <mxGeometry y="60" width="650" height="600" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-86" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1.004;exitY=0.813;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-69" target="qIvAuGTGZv5WA7IhcWgH-82" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="10550" y="-1932" as="sourcePoint" />
            <mxPoint x="10800" y="-2310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-94" value="&lt;div&gt;gc_hal_kernel_emulator.cpp&lt;/div&gt;&lt;div&gt;&lt;br style=&quot;font-weight: 400; text-align: left;&quot;&gt;&lt;/div&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="14210" y="-2050" width="610" height="180" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-95" value="&lt;b&gt;InterruptThread(void *)&lt;/b&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-94" vertex="1">
          <mxGeometry y="26" width="610" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-96" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-94" vertex="1">
          <mxGeometry y="52" width="610" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-97" value="&lt;div&gt;while(wrapper-&amp;gt;interruptSuspended)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckHARDWARE_Interrupt&lt;/b&gt;(kernel-&amp;gt;hardware)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-94" vertex="1">
          <mxGeometry y="60" width="610" height="80" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-98" value="&lt;b&gt;gckKERNEL_Notify&lt;/b&gt;(kernel, &lt;b&gt;gcvNOTIFY_INTERRUPT&lt;/b&gt;)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-94" vertex="1">
          <mxGeometry y="140" width="610" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-99" value="gc_hal_kernel_hardware.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="15000" y="-2120" width="650" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-100" value="&lt;b&gt;gckHARDWARE_Interrupt(hw)&lt;/b&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-99" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-101" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-99" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-102" value="&lt;b&gt;gckOS_ReadRegisterEx&lt;/b&gt;(AQ_INTR_ACKNOWLEDGE_Address, &amp;amp;data)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_AtomClearMask(hw-&amp;gt;pendingEvent, data)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //data : 1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckEVENT_Interrupt&lt;/b&gt;(hw-&amp;gt;kernel-&amp;gt;eventObj, data)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; --&amp;gt; &lt;b&gt;gckOS_AtomSetMask&lt;/b&gt;(Event-&amp;gt;pending, Data)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//添加event到 pending : 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-99" vertex="1">
          <mxGeometry y="60" width="650" height="100" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-103" value="gc_hal_kernel_kernel.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="15000" y="-1840" width="650" height="120" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-104" value="&lt;b&gt;gckKERNEL_Notify(Kernel, Notification)&lt;/b&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-103" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-105" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-103" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-106" value="switch(Notification)&lt;div&gt;case gcvNOTIFY_INTERRUPT:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckHARDWARE_Notify&lt;/b&gt;(Kernel-&amp;gt;hardware)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-103" vertex="1">
          <mxGeometry y="60" width="650" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-107" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-98" target="qIvAuGTGZv5WA7IhcWgH-103" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="14830" y="-1940" as="sourcePoint" />
            <mxPoint x="15010" y="-2110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-108" value="gc_hal_kernel_kernel.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="15000" y="-1642" width="650" height="150" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-109" value="&lt;b style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;gckHARDWARE_Notify(hw)&lt;/b&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-108" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-110" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-108" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-111" value="&lt;b&gt;gckOS_AtomGet&lt;/b&gt;(os, hw-&amp;gt;kernel-&amp;gt;eventObj-&amp;gt;pending, &amp;amp;pending)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//pending : 1&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckOS_AtomSetMask&lt;/b&gt;(hw-&amp;gt;kernel-&amp;gt;eventObj-&amp;gt;pending, pending)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckEVENT_Notify&lt;/b&gt;(hw-&amp;gt;kernel-&amp;gt;eventObj, 0, &amp;amp;fault)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-108" vertex="1">
          <mxGeometry y="60" width="650" height="90" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-112" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.501;exitY=0.995;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-106" target="qIvAuGTGZv5WA7IhcWgH-108" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="14830" y="-1880" as="sourcePoint" />
            <mxPoint x="15010" y="-1830" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-113" value="gc_hal_kernel_event.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="15770" y="-1540" width="650" height="930" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-114" value="&lt;b&gt;gckEVENT_Notify&lt;/b&gt;(Event, IDs, *Fault)&lt;div&gt;处理所有已经触发的中断&lt;/div&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-113" vertex="1">
          <mxGeometry y="26" width="650" height="44" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-115" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-113" vertex="1">
          <mxGeometry y="70" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-116" value="&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;Event-&amp;gt;notifyState = 0&amp;nbsp; &amp;nbsp; //-1 to 0&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;for (;;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_AtomGet&lt;/b&gt;(os, Event-&amp;gt;pending, &amp;amp;&lt;b&gt;pending&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//处理完成&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (pending == 0) { break }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//29 invalidating pipe&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pending &amp;amp; (1&amp;lt;&amp;lt;29) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;gckHARDWARE_ResumeWLFE&lt;/b&gt;(Event-&amp;gt;kernel-&amp;gt;hardware)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // clear pending gckOS_AtomClearMask(Event-&amp;gt;pending, 1&amp;lt;&amp;lt;29)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;// AXI Bus error&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pending &amp;amp; 0x8000_0000) {&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pending &amp;amp;= 0x7FFF_FFFF&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fault |= gcvEVENT_BUS_ERROR_FAULT&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;// PageFault&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pending &amp;amp; 0x4000_0000)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pending &amp;amp;= 0xBFFF_FFFF&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//遍历29个event 找出最早的mask 和 queue(通过比较stamp, 早的小&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; for (i =0; i&amp;lt; Event-&amp;gt;totalQueueCount++i) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;...&amp;nbsp; mask = 1&amp;lt;&amp;lt;i, queue = Event-&amp;gt;queue[i].stamp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; //再次比较stamp, 看是否有漏掉的 interrupt&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Signal 等待fence的任务, 这个Fence 在&lt;span style=&quot;color: rgb(51, 51, 51);&quot;&gt;_CommitWaitLinkOnce 中会添加到Command Buffer中,&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;span style=&quot;color: rgb(51, 51, 51);&quot;&gt;&amp;nbsp; &amp;nbsp; //此示例没有等待该fence的任务, &lt;b&gt;Fence-&amp;gt;waitingList&lt;/b&gt;为空&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckFENCE_Signal&lt;/b&gt;(os, Event-&amp;gt;kernel-&amp;gt;command-&amp;gt;fence)&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //获取record, 释放queue&lt;br&gt;&amp;nbsp; &amp;nbsp; queue = queue-&amp;gt;head,&amp;nbsp; queue-&amp;gt;head = NULL, Event-&amp;gt;freeQueueCount++&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; while(record != NULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; recordNext = record-&amp;gt;next&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; switch(record-&amp;gt;info.command) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case gcvHAL_SIGNAL:&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; signal = record-&amp;gt;info.u.Signal.signal;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (record-&amp;gt;info.u.Signal.process == NULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_Signal&lt;/b&gt;(os, signal, true)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else { UserSignal() )&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckEVENT_FreeRecord&lt;/b&gt;(Event, record)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; record = recordNext&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;} // for(;;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (IDs == 0) _TryToIdleGPU(Event)&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//结束Event处理&lt;/span&gt;&lt;br&gt;Event-&amp;gt;notifyState = -1&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-113" vertex="1">
          <mxGeometry y="78" width="650" height="852" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-117" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-111" target="qIvAuGTGZv5WA7IhcWgH-113" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="15336" y="-1710" as="sourcePoint" />
            <mxPoint x="15335" y="-1632" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-118" value="gc_hal_kernel_sync.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="16550" y="-730" width="620" height="230" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-119" value="&lt;b&gt;gckOS_Signal(os, Signal, State)&lt;/b&gt;" style="text;strokeColor=#36393d;fillColor=#eeeeee;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-118" vertex="1">
          <mxGeometry y="26" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-120" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qIvAuGTGZv5WA7IhcWgH-118" vertex="1">
          <mxGeometry y="52" width="620" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-121" value="&lt;b&gt;_QuerySignalId&lt;/b&gt;(os, Signal, &amp;amp;signal)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;signal-&amp;gt;value =State&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;//此处就是 解除&amp;nbsp;&lt;span style=&quot;color: rgb(51, 51, 51);&quot;&gt;gckCONTEXT_Update中的&lt;/span&gt;gckOS_WaitSignal&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (State) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//如果是Kernel Driver&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;signal-&amp;gt;done = 1&lt;/b&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//如果是 emulator&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;pthread_cond_signal&lt;/b&gt;(&amp;amp;signal-&amp;gt;cond)&lt;/div&gt;&lt;div&gt;} else { manualReset }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qIvAuGTGZv5WA7IhcWgH-118" vertex="1">
          <mxGeometry y="60" width="620" height="170" as="geometry" />
        </mxCell>
        <mxCell id="qIvAuGTGZv5WA7IhcWgH-122" value="Dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1.005;exitY=0.861;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="qIvAuGTGZv5WA7IhcWgH-116" target="qIvAuGTGZv5WA7IhcWgH-118" edge="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="15660" y="-1527" as="sourcePoint" />
            <mxPoint x="15780" y="-1530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-2" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="RsXz8Ytodcc2n_-1sCKY-32" target="RsXz8Ytodcc2n_-1sCKY-60">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11283" y="-1327" as="sourcePoint" />
            <mxPoint x="12270" y="-830" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11275" y="-1180" />
              <mxPoint x="12240" y="-1180" />
              <mxPoint x="12240" y="-490" />
              <mxPoint x="11260" y="-490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-3" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeWidth=5;fillColor=#60a917;strokeColor=#000000;entryX=0;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="RsXz8Ytodcc2n_-1sCKY-32" target="RsXz8Ytodcc2n_-1sCKY-46">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11283" y="-1327" as="sourcePoint" />
            <mxPoint x="11270" y="-527" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11273" y="-1180" />
              <mxPoint x="12240" y="-1180" />
              <mxPoint x="12240" y="-720" />
              <mxPoint x="11260" y="-710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-6" value="Pre LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="7473.99" y="-655" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-7" value="Pre LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="7478.99" y="-1240" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-8" value="Pre Wait" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="7409.5" y="-1240" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-9" value="Pre LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="10812.5" y="-1030" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-10" value="Pre Wait" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="10742.5" y="-1030" width="70" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2H-CIvwVkbPeOZOdjZ8d-11" value="Pre LINK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="10815" y="-329" width="70" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

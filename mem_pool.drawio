<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0" version="27.0.3">
  <diagram name="Page-1" id="1dB5lCZi5Taqo5wlKjE4">
    <mxGraphModel dx="2214" dy="1413" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-QamLBn5pkz0fhhn8fLs-13" value="&lt;font style=&quot;font-size: 64px;&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;font-size: 64px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Reserved Mem Pool&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;fontSize=48;fontStyle=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="-240" y="-1000" width="4360" height="2670" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-1" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" width="560" height="294" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-2" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Poll, gckVIDMEM *VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-5" value="switch(Pool) {" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="60" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-4" value="case &lt;b&gt;gcvPOOL_LOCAL_INTERNAL&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;internalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="86" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-7" value="case &lt;b&gt;gcvPOOL_LOCAL_EXTERNAL&lt;/b&gt;:&amp;nbsp; vm = device-&amp;gt;externalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="112" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-10" value="case &lt;b&gt;gcvPOOL_LOCAL_EXCLUSIVE&lt;/b&gt;: vm = device-&amp;gt;exclusiveVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="138" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-9" value="case &lt;b&gt;gcvPOOL_SYSTEM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;contiguousVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;memIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="164" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-13" value="case &lt;b&gt;gcvPOOL_SYSTEM_32BIT_VA&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;lowContiguousVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="190" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-11" value="case &lt;b&gt;gcvPOOL_INTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;sRAMVidMem[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Kernel-&amp;gt;sRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="216" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-12" value="case &lt;b&gt;gcvPOOL_EXTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; vm = device-&amp;gt;extSRAMVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;extSRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="242" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-8" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="268" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-14" value="gc_hal_kernel_device.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="880" y="-660" width="560" height="788" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-15" value="&lt;b&gt;gckGALDEVICE_Construct(*Platform, *Args, *Device)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-16" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-17" value="gal_device-&amp;gt;externalSize[i] = Args-&amp;gt;externalSize[i]" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="60" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-65" value="&lt;div&gt;if (gal_device-&amp;gt;externalSize[i] &amp;gt; 0) {&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="90" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-26" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalVidMem[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="120" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-27" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalPhysical[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="190" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-47" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//physical 其实是 PLINUX_MDL&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;externalPhysical[i]-&amp;gt;physical = gal_device-&amp;gt;externalPhysical[i];&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="260" width="560" height="50" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-25" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="310" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-60" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="336" width="560" height="74" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-61" value="if (gal_device-&amp;gt;exclusiveSize[i] &amp;gt; 0) {" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="410" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-62" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusiveVidMem[i]&lt;/span&gt;);&amp;nbsp;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="436" width="560" height="74" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-2" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_RequestReservedMemory&lt;/b&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(os,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusivePhysical[i]&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = ((LINUX_MDL)gal_device-&amp;gt;exclusivePhysical[i])-&amp;gt;allocator;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;physical = gal_device-&amp;gt;exclusivePhysical[i];&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;capability |= allocator-&amp;gt;capability;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="510" width="560" height="130" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-63" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="640" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-66" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="666" width="560" height="44" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-67" value="_SetupContiguousVidMem(gal_device, i , Args);" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="710" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-68" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="736" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-59" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="762" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-28" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-7" target="RKsYsZY5aNLMbsADSlp9-65" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="980" y="180" as="sourcePoint" />
            <mxPoint x="1140" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-29" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2660" y="-780" width="530" height="726" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-30" value="&lt;b&gt;gckVIDMEM_Construct(Os, PhysicalBase, Bytes, Threshold, BankSize, *Memory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-32" value="&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_Allocate&lt;/b&gt;(Os, sizeof(struct _gckVIDMEM), &amp;amp;pointer);&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;memory = pointer&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="60" width="530" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-33" value="&lt;div&gt;memory-&amp;gt;object.type = gcvOBJ_VIDMEM;&lt;/div&gt;&lt;div&gt;...&lt;br&gt;memory-&amp;gt;physicalBase&amp;nbsp; = PhysicalBase;&lt;br&gt;memory-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&amp;nbsp; &amp;nbsp; &amp;nbsp;//Bytes&lt;br&gt;memory-&amp;gt;freeBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&lt;br&gt;memory-&amp;gt;minFreeBytes = heapBytes;&lt;br&gt;memory-&amp;gt;capability&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = ~0u;&lt;br&gt;memory-&amp;gt;threshold&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Threshold;&lt;br&gt;memory-&amp;gt;mutex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="100" width="530" height="140" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-34" value="&lt;div&gt;for (i = 0; i &amp;lt; gcmCOUNTOF(memory-&amp;gt;sentinel); ++i) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;gckOS_Allocate(Os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;node = pointer;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.parent = memory;&lt;/span&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.next = .....prev = .....nextFree = .....prevFree = &amp;amp;memory-&amp;gt;sentinel[i];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextReserved = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.offset = base;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.bytes = bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.aligment = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.pool = gcvPOOL_DEFAULT;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.locked = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.processID = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.logical = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.kvaddr = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.next = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prev = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.nextFree = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prevFree = node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;-&amp;gt;sentinel[i].VidMem.bytes = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;-&amp;gt;sentinel[i].VidMem.nextReserved = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; base += bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; heapBytes -= bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; banks++;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* Assign all the bank mappings */&lt;br&gt;memory-&amp;gt;mapping[xxxxx] = bank xxxx&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="240" width="530" height="460" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-35" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="700" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-36" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-26" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="109" as="sourcePoint" />
            <mxPoint x="750" y="-261" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1480" y="-505" />
              <mxPoint x="2050" y="-740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-37" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2660" y="60" width="530" height="452" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-38" value="&lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;&lt;b&gt;(Os, Start, Size, Name, Requested, MemoryHandle)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-39" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-40" value="gckALLOCATOR allocator;&lt;div&gt;gcsATTACH_DESC desc;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Size = (Size + ~PAGE_MASK) &amp;amp; PAGE_MASK;&lt;/div&gt;&lt;div&gt;mdl = _CreateMdl(Os, gcvNULL);&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="60" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-41" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;desc.reservedMem.start&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;desc.reservedMem.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Size;&lt;/div&gt;&lt;div&gt;desc.reservedMem.name&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Name;&lt;/div&gt;&lt;div&gt;desc.reservedMem.requested = Requested;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;desc.reservedMem.root&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="150" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-49" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = _FindAllocator(Os, gcvALLOC_FLAG_LINUX_RESERVED_MEM);&lt;br&gt;allocator-&amp;gt;ops-&amp;gt;Attach(allocator, &amp;amp;desc, mdl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;allocator&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = allocator;&lt;br&gt;mdl-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Size;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;numPages&amp;nbsp; &amp;nbsp; = Size &amp;gt;&amp;gt; PAGE_SHIFT;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;contiguous&amp;nbsp; &amp;nbsp; = gcvTRUE;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;addr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;br&gt;mdl-&amp;gt;dmaHandle&amp;nbsp; = Start;&lt;br&gt;mdl-&amp;gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="240" width="530" height="160" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-48" value="list_add_tail(&amp;amp;mdl-&amp;gt;link, &amp;amp;Os-&amp;gt;mdlHead);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="400" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-43" value="*MemoryHandle = (void *) mdl;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="426" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-44" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-27" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1310" y="-165" as="sourcePoint" />
            <mxPoint x="1690" y="-1031" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1900" y="-440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-50" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3390" y="340" width="490" height="510" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-51" value="&lt;b&gt;reserved_mem_attach(Allocator, Desc, Mdl)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-52" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-54" value="struct reserved_mem_alloc *alloc = Allocator-&amp;gt;privateData&lt;br&gt;struct reserved_mem *res;&lt;div&gt;struct resource *region;&lt;br&gt;&lt;br&gt;res = kzalloc(sizeof(res), GFP_KERNEL | gcdNOWARN);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="60" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-55" value="res-&amp;gt;start = Desc-&amp;gt;reservedMem.start;&lt;br&gt;res-&amp;gt;size&amp;nbsp; = Desc-&amp;gt;reservedMem.size;&lt;br&gt;res-&amp;gt;offset_in_page = Desc-&amp;gt;reservedMem.start &amp;amp; (PAGE_SIZE - 1);&lt;br&gt;strncpy(res-&amp;gt;name, Desc-&amp;gt;reservedMem.name, sizeof(res-&amp;gt;name) - 1);&lt;div&gt;res-&amp;gt;release = 0;&lt;br&gt;res-&amp;gt;root = Desc-&amp;gt;reservedMem.root;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="140" width="490" height="100" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-56" value="if (Desc-&amp;gt;reservedMem.root) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!Desc-&amp;gt;reservedMem.requested) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; region = request_mem_region(res-&amp;gt;start, res-&amp;gt;size, res-&amp;gt;name);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!resgion) { kfree(res); return OUT_OF_RESOURCES; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; res-&amp;gt;release = 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_add(&amp;amp;res-&amp;gt;link, &amp;amp;alloc-&amp;gt;region);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Mdl-&amp;gt;priv = res;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="240" width="490" height="190" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-57" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_CPUPhysicalToGPUPhysical(os, (res-&amp;gt;start + res-&amp;gt;size - 1), &amp;amp;gpu_end);&lt;br&gt;&lt;br&gt;if (gpu_end &amp;lt;= 0xFFFF_FFFF) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; Allocator-&amp;gt;capability |= gcvALLOC_FLAG_4GB_ADDR;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="430" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-58" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-49" target="RKsYsZY5aNLMbsADSlp9-51" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2610" y="690" as="sourcePoint" />
            <mxPoint x="2030" y="479" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-64" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-10" target="RKsYsZY5aNLMbsADSlp9-61" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="135" as="sourcePoint" />
            <mxPoint x="750" y="-165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-69" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-9" target="RKsYsZY5aNLMbsADSlp9-67" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="750" y="190" as="sourcePoint" />
            <mxPoint x="910" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-1" value="gc_hal_kernel_device.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="20" width="600" height="1446" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-2" value="&lt;span style=&quot;color: rgb(51, 51, 51);&quot;&gt;_SetupContiguousVidMem(gal_device, i , Args);&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="26" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="52" width="600" height="8" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-4" value="device-&amp;gt;contiguousBases[i] = Args-&amp;gt;contiguousBases[i&#39;];&lt;br&gt;device-&amp;gt;contiguousSizes[i]&amp;nbsp; &amp;nbsp;= Args-&amp;gt;contiguousSizes[i];&lt;br&gt;device-&amp;gt;requestedContiguousBaes[i] = 0;&lt;div&gt;device-&amp;gt;requestedContiguousSizes[i] = 0;&lt;br&gt;if (!device-&amp;gt;contiguousBases[i] = 0) return gcvSTATUS_OK;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="60" width="600" height="90" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-5" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;&lt;b&gt;if (device-&amp;gt;os-&amp;gt;iommu) {&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[i] = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousSizes[i] = 0;&lt;br&gt;&lt;b&gt;} else {&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="150" width="600" height="70" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-6" value="&amp;nbsp; &amp;nbsp; if (&lt;b&gt;dev-&amp;gt;reserved32bitVA &lt;/b&gt;&amp;amp;&amp;amp; &lt;b&gt;!device-&amp;gt;lowContiguousSize&lt;/b&gt; &amp;amp;&amp;amp; &lt;b&gt;!Args-&amp;gt;lockLargeVA&lt;/b&gt;) {&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gctPHYS_ADDR_T&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gpuBase;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gctPHYS_ADDR_T lowContiguousBase = congiguousBases;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gctSIZE_T lowContiguousSize&amp;nbsp; &amp;nbsp;=&amp;nbsp; contiguousSIzes;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CPUPhysicalToGPUPhysical&lt;/b&gt;(os, contiguousBases, &amp;amp;gpuBase);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;if (gpuBase &amp;lt; gcd4G_SIZE) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;if (gpuBase + contiguousSizes &amp;gt; gcd4G_SIZE) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_GPUPhysicalToCPUPhysical&lt;/b&gt;(os, gcd4G_SIZE, &amp;amp;contiguousBases);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (gpuBase &amp;lt; gcdVA_RESERVED_SIZE)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases -= gcdVA_RESERVED_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (gpuBase &amp;gt; gcd4G_SIZE - gcd4G_VA_FM_SIZE)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases += gpuBase - (gcd4G_SIZE - gcd4G_VA_FM_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize = contiguousBases - lowContiguousBase;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes&amp;nbsp; &amp;nbsp; &amp;nbsp; = (lowContiguousSize &amp;gt;= gcd4G_VA_FM_SIZE) ?&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (contiguousSizes - lowContiguousSize) : 0;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;if (contiguousSizes &amp;gt; gcd4G_VA_FM_SIZE) {&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize = gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases&amp;nbsp; &amp;nbsp;+= gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes&amp;nbsp; &amp;nbsp; &amp;nbsp;-= gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="220" width="600" height="460" as="geometry" />
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-1" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!Args-&amp;gt;enableMmu) { ... }&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (lowContiguousSize) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousBase,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, Args-&amp;gt;bankSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;lowContiguousVidMem);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="680" width="600" height="130" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-7" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousRequested = Args-&amp;gt;contiguousRequested;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousBase,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&quot;gcLowContMem&quot;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousRequested,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;lowContiguousPhysical);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; allocator = (PLINUX_MDL)device-&amp;gt;lowContiguousPhysical)-&amp;gt;allocator;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;lowContiguousVidMem-&amp;gt;capability = allocator-&amp;gt;capability | gcvALLOC_FLAG_MEM_LIMIT;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;physical&amp;nbsp; &amp;nbsp; = device-&amp;gt;lowContiguousPhysical;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;lowContiguousBase&amp;nbsp; = lowContiguousBase;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize&amp;nbsp; &amp;nbsp; = lowContiguousSize;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="810" width="600" height="210" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-6" value="&amp;nbsp; &amp;nbsp; }" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1020" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-2" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1050" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-7" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousBaese,&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousSizes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, Args-&amp;gt;bankSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;contiguousVidMems[i];&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1100" width="600" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-10" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; contiguousRequested = Args-&amp;gt;contiguousRequested; /* AdjustParam 会设置为True */&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousBases,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousSizes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&quot;gcContMem&quot;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousRequested,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;contiguousPhysicals[i]);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; allocator = ((PLINUX_MDL)device-&amp;gt;contiguousPhysicals[i])-&amp;gt;allocator;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[i]-&amp;gt;capability = allocator-&amp;gt;capability | gcvALLOC_FLAG_MEMLIMIT;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;physical&amp;nbsp; &amp;nbsp;= device-&amp;gt;contiguousPhysicals[i];&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;requestedContiguousBases[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousBases;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;requestedContiguousSizes[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousSizes;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;contiguousBases[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;contiguousBases;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;contiguousSizes[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousSizes;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1180" width="600" height="240" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-8" value="} /* else */" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1420" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-9" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-67" target="1ENbYF7BbkhPWx73IUyd-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1510" y="140" as="sourcePoint" />
            <mxPoint x="1560" y="90" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-3" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-13" target="RKsYsZY5aNLMbsADSlp9-67" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="187" as="sourcePoint" />
            <mxPoint x="890" y="83" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-1" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-62" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1450" y="-495" as="sourcePoint" />
            <mxPoint x="2330" y="-1471" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1720" y="-187" />
              <mxPoint x="2050" y="-740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-3" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-2" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1460" y="-64" as="sourcePoint" />
            <mxPoint x="2320" y="-630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1920" y="-85" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-4" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QsT_bb-GeKoUEtdT82jw-1" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2320" y="390" as="sourcePoint" />
            <mxPoint x="2670" y="-731" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2360" y="610" />
              <mxPoint x="2360" y="-290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-8" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-7" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2330" y="1010" as="sourcePoint" />
            <mxPoint x="2650" y="90" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2470" y="710" />
              <mxPoint x="2470" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-11" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="1ENbYF7BbkhPWx73IUyd-7" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2170" y="775" as="sourcePoint" />
            <mxPoint x="2670" y="-731" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2360" y="1040" />
              <mxPoint x="2360" y="-290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-12" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-10" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2170" y="945" as="sourcePoint" />
            <mxPoint x="2670" y="109" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2470" y="1200" />
              <mxPoint x="2470" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-14" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Allocate Device Mem&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;fontSize=64;fontStyle=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="-240" y="1930" width="6340" height="9190" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-15" value="memory.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-130" y="3080" width="490" height="160" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-16" value="&lt;b&gt;allocDeviceMemory(device, info, node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-17" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-20" value="&lt;div&gt;&lt;b&gt;allocMemory&lt;/b&gt;(device-&amp;gt;processor, node, info);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="60" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-29" value="for (CUdevice i : *(device-&amp;gt;enableP2pDevice)) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;setHalMemAccess&lt;/b&gt;(DEVICE(i)-&amp;gt;processor, *node, HAL_MAP_ATTR_READWRITE)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="100" width="490" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-33" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="470" y="3120" width="670" height="610" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-34" value="&lt;b&gt;allocMemory(processor, node, info)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="26" width="670" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-35" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="52" width="670" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-36" value="&lt;div&gt;iface&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= { &lt;b&gt;gcvHAL_ALLOCATE_LINEAR_VIDEO_MEMORY&lt;/b&gt; }&lt;/div&gt;&lt;div&gt;iface.devCtxt&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;devCtx&lt;/div&gt;&lt;div&gt;iface.hardwareType = processor-&amp;gt;coreTypes[0]&lt;/div&gt;&lt;div&gt;iface.coreIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;coreIndexs[0]&lt;/div&gt;&lt;div&gt;iface.devIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;devIdx&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.u.AllocateLinearVideoMemory.alignment = info-&amp;gt;alignment ? info-&amp;gt;alignment : 256;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = info-&amp;gt;size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = info-&amp;gt;poolType;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvSURF_INDEX;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |= info-&amp;gt;force32Bit ? gcvALLOC_FLAG_32BIT_VA: 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;KmdIoCtl&lt;/b&gt;(processor-&amp;gt;kmdHandle, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IOCTL_GCHAL_INTERFACE, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;iface, sizeof(iface), &amp;amp;iface, sizeof(iface);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;memoryNode_PTR pNode = (memoryNode_PTR)os_calloc(sizeof(memoryNode_t));&lt;br&gt;pNode-&amp;gt;processor = processor;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;handle&amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.node;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.pool;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.bytes;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="60" width="670" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-37" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.command&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= &lt;b&gt;gcvHAL_LOCK_VIDEO_MEMORY&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;iface.u.LockVideoMemory.node&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= pNode-&amp;gt;handle;&lt;/div&gt;&lt;div&gt;iface.u.LockVideoMemory.op&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvLOCK_VIDEO_MEMORY_OP_LOCK | gcvLOCK_VIDEO_MEMORY_OP_MAP;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;iface.u.LockVideoMemory.cacheable = gcvFALSE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;KmdIoCtl&lt;/b&gt;(processor-&amp;gt;kmdHandle, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IOCTL_GCHAL_INTERFACE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;iface, sizeof(iface), &amp;amp;iface, sizeof(iface));&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;cpuLogical = iface.u.LockVideoMemory.memory;&lt;br&gt;pNode-&amp;gt;gpuLogical = iface.u.LockVideoMemory.address;&lt;br&gt;pNode-&amp;gt;physical&amp;nbsp; &amp;nbsp; &amp;nbsp;= iface.u.LockVideoMemory.physicalAddress;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*node = pNode&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="380" width="670" height="230" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-38" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-20" target="-QamLBn5pkz0fhhn8fLs-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="2340" as="sourcePoint" />
            <mxPoint x="550" y="2290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-39" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1310" y="3120" width="570" height="500" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-40" value="&lt;b&gt;_AllocateLinearMemory(Kernel, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-41" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-42" value="pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Interface-&amp;gt;u.AllocateLinearVideoMemory.pool&lt;br&gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes&lt;br&gt;alignment =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .alignment&lt;br&gt;type&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type &amp;amp; 0xFF&lt;br&gt;flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag | gcvALLOC_FLAG_FROM_USER&lt;br&gt;mappingInOne = 1&lt;br&gt;isContiguous;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Interface-&amp;gt;u.AllocateLinearVideoMemory.extSRAMIndex &amp;gt;= 0)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Kernel-&amp;gt;device-&amp;gt;extSRAMIndex = Interface-&amp;gt;u.AllocateLinearVideoMemory.extSRAMIndex&lt;br&gt;&lt;br&gt;&lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOne&quot;, &amp;amp;mappingInOne)&lt;br&gt;if (mappingInOne == 0 ) {&lt;div&gt;&amp;nbsp; &amp;nbsp; alignment = gcmALIGN(alignment, 4096);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="60" width="570" height="230" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-43" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory&lt;/b&gt;(Kernel, alignment, type, flag, 0, &amp;amp;bytes, &amp;amp;pool, &amp;amp;nodeObject)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="290" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-51" value="&lt;b&gt;gckVIDMEM_HANDLE_Allocate&lt;/b&gt;(Kernel, nodeObject, &amp;amp;handle)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="330" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-50" value="Interface-&amp;gt;u.AllocateLinearVideoMemory.node = handle&lt;br&gt;Interface-&amp;gt;u.AllocateLinearVideoMemory.pool&amp;nbsp; = pool&lt;br&gt;Interface-&amp;gt;u.AllocateLinearVideoMemory.bytes = bytes" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="370" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-52" value="dbType = gcvDB_VIDEO_MEMORY | (type&amp;lt;&amp;lt;gcdDB_VIDEO_MEMORY_TYPE_SHIFT) |&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (pool &amp;lt;&amp;lt; gcdDB_VIDEO_MEMORY_POOL_SHIFT);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, dbType, gcmINT2PTR(handle), gcvNULL, bytes);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="430" width="570" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-44" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2120" y="2140" width="760" height="1270" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-45" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory(Kernel, Alignment, Type, Flag, PoolID, *Bytes, *Pool, *NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="26" width="760" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-46" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="52" width="760" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-47" value="&lt;div&gt;contiguous = Flag &amp;amp; gcvALLOC_FLAG_CONTIGUOUS&lt;br&gt;cacheable&amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_CACHEABLE&lt;br&gt;secure&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_SECURITY&lt;br&gt;&lt;br&gt;if (Kernel-&amp;gt;vGPUType == gcvVGPU_MDEV)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; cacheable = gcvFALSE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_NON_CPU_ACCESS)&lt;br&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_FAST_POOLS) {&lt;br&gt;&amp;nbsp; &amp;nbsp; fastPools = gcvTRUE&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_FAST_POOLS;&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT)&lt;br&gt;&amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_VIRTUAL;&lt;/div&gt;&lt;div&gt;....&lt;br&gt;&lt;br&gt;if ((Flag &amp;amp; (gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA))&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;amp;&amp;amp; *Pool != gcvPOOL_EXTERNAL_SRAM) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;reserve32bitVA) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;device-&amp;gt;externalSize)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_LOCAL_EXTERNAL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM_32BIT_VA;&lt;br&gt;&amp;nbsp; &amp;nbsp; } else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~(gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_DMABUF_EXPORTABLE) {&lt;br&gt;&amp;nbsp; &amp;nbsp; gckOS_GetPageSize(os, &amp;amp;pageSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; bytes = gcmALIGN(bytes, pageSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; Alignment = pageSize;&lt;br&gt;}&lt;br&gt;&lt;br&gt;if (Type == gcvVIDMEM_TYPE_COMMAND) {&lt;br&gt;&amp;nbsp; &amp;nbsp;...&lt;br&gt;}&lt;br&gt;&lt;br&gt;/* All kernel used buffer should be contiguous */&lt;br&gt;if (!(Flag &amp;amp; gcvALLOC_FLAG_FROM_USER)) {&lt;br&gt;&amp;nbsp; &amp;nbsp; Flag |= gcvALLOC_FLAG_CONRIGUOUS; Flag |= gcvALLOC_FLAG_32BIT_VA; contiguous = gcvTRUE;&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="60" width="760" height="690" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-55" value="&lt;div&gt;&lt;b&gt;AllocateMemory:&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;vGPUType == gcvVGPU_MDEV)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_LOCAL_EXTERNAL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (*Pool == gcvPOOL_SYSTEM_32BIT_VA &amp;amp;&amp;amp; Kernel-&amp;gt;device-&amp;gt;lockLargeVA == gcvTRUE)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="750" width="760" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-1" value="&lt;div&gt;&lt;b&gt;&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#if gcdNEW_MM&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (*Pool != gcvPOOL_VIRTUAL)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = Kernel-&amp;gt;device-&amp;gt;devMemPoolType;&lt;br&gt;#else&lt;br&gt;&amp;nbsp; &amp;nbsp; #ifdef CMODEL_QEMU&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM&lt;br&gt;#endif&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="850" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-48" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (...)&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (cacheable == gcvFALSE &amp;amp;&amp;amp; secure == gcvFALSE) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="960" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-57" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;br&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1020" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-56" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_GetVideoMemoryPool&lt;/b&gt;(Kernel, pool, &amp;amp;videoMemory);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1100" width="760" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-58" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; specified = (pool == gcvPOOL_SYSTEM || pool == gcvPOOL_INTERNAL_SRAM ||&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pool == gcvPOOL_EXTERNAL_SRAM || pool == gcvPOOL_SYSTEM_32BIT_VA);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; hasFastPools = gcvTRUE;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_AllocateLinear&lt;/b&gt;(Kernel, videoMemory, pool, Type, Flag, Aligment, specified, &amp;amp;bytes, &amp;amp;nodeObject);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1130" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-59" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1210" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-53" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-36" target="-QamLBn5pkz0fhhn8fLs-40" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1480" y="2830" as="sourcePoint" />
            <mxPoint x="1530" y="2780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-54" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-43" target="-QamLBn5pkz0fhhn8fLs-45" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1210" y="2430" as="sourcePoint" />
            <mxPoint x="1380" y="2249" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-60" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3210" y="2090" width="710" height="250" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-61" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-62" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-63" value="galDevice = Kernel-&amp;gt;context&lt;div&gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(Pool) {&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp;galDevice-&amp;gt;internalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXTERNAL:&amp;nbsp; device-&amp;gt;externalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE: device-&amp;gt;exclusiveVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_INTERNAL_SRAM:&amp;nbsp; &amp;nbsp; &amp;nbsp;Kernel-&amp;gt;sRAMVidMem[Kernel-&amp;gt;sRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; device-&amp;gt;extSRAMVidMems[device-&amp;gt;extSRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; galDevice-&amp;gt;lowContiguousVidMem;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="60" width="710" height="190" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-68" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3210" y="2420" width="710" height="530" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-69" value="&lt;b&gt;gckVIDMEM_NODE_AllocateLinear(Kernel, VideoMemory, Pool, Type, Flag, Alignment, Specified, Bytes, NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-70" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-71" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gcuVIDMEM_NODE_PTR &lt;/b&gt;node;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckVIDMEM_NODE &lt;/b&gt;nodeObject;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;switch(Pool) {&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE:&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag |= gcvALLOC_FLAG_NON_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_NON_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="60" width="710" height="170" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-78" value="&lt;b&gt;gckVIDMEM_AllocateLinear&lt;/b&gt;(Kernel, VideoMemory, bytes, Alignment, Type, Flag, Specified, &amp;amp;node);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.pool = Pool;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.type = Type;&lt;/div&gt;&lt;div&gt;bytes = node-&amp;gt;VidMem.bytes;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="230" width="710" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-72" value="&lt;b&gt;gckVIDMEM_NODE_Construct&lt;/b&gt;(Kernel, node, Type, Pool, Flag, &amp;amp;nodeObject);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="310" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-84" value="&lt;b&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; /* Just update the mirror buffer type here */&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Flag &amp;amp; gcvALLOC_FLAG_WITH_MIRROR) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;mirror.type = gcvMIRROR_TYPE_SYSTEM_MEMORY_MIRROR;&lt;br&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; #if gcdSTATIC_VIDEO_MEMORY_MIRROR&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_AllocateVideoMemoryMirror&lt;/b&gt;(Kernel, nodeObject, gcvMIRROR_TYPE_SYSTEM_MEMORY_MIRROR);&lt;br&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; #else&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;mirror.refCount = 0;&lt;br&gt;&lt;b&gt;#endif&lt;/b&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="350" width="710" height="140" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-85" value="*Bytes = bytes;&lt;div&gt;*NodeObject = nodeObject;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="490" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-76" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-56" target="-QamLBn5pkz0fhhn8fLs-61" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2970" y="2990" as="sourcePoint" />
            <mxPoint x="3020" y="2940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-77" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-58" target="-QamLBn5pkz0fhhn8fLs-69" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2890" y="3155" as="sourcePoint" />
            <mxPoint x="3220" y="2139" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-79" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4350" y="2040" width="770" height="870" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-80" value="&lt;b&gt;gckVIDMEM_AllocateLinear&lt;/b&gt;&lt;b&gt;(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="26" width="770" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-81" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="52" width="770" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-82" value="Alignment = gcmALIGN(Alignment, gcd4K_PAGE_SIZE);&lt;div&gt;Bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcmALIGN(Bytes, gcd4K_PAGE_SIZE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if gcdSMALL_BLOCK_SIZE /* for small memory */&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;bank = Memory-&amp;gt;mapping[Type]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node = &lt;b&gt;_FindNode&lt;/b&gt;(Kernel, Memory, bank, Bytes, Type, &amp;amp;alignment);&lt;br&gt;&lt;br&gt;if (node == null) { walk through banks within sentinel }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* 如果有对齐需求, Split 一个对齐大小的node, 并使用 node-&amp;gt;VidMem.next */&lt;/div&gt;&lt;div&gt;if (alignment &amp;gt; 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;b&gt;_Split&lt;/b&gt;(Memory-&amp;gt;os, node, alignment)) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node = node-&amp;gt;VidMem.next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;alignment = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;br&gt;/* Remove the node from the free list. */&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prevFree-&amp;gt;VidMem.nextFree = node-&amp;gt;VidMem.nextFree;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = node-&amp;gt;VidMem.prevFree;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree = gcvNULL;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prevFree = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="60" width="770" height="390" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-90" value="&lt;div&gt;/* Fill in node information */&lt;br&gt;node-&amp;gt;VidMem.aligment = alignment;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.parent&amp;nbsp; &amp;nbsp; = Memory;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.logical&amp;nbsp; &amp;nbsp; = gcvNULL;&lt;br&gt;gckOS_GetProcessID(&amp;amp;node-&amp;gt;VidMem.processID);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* Adjust the number of free bytes */&lt;br&gt;Memory-&amp;gt;freeBytes -= node-&amp;gt;VidMem.bytes;&lt;br&gt;&lt;br&gt;if (Memory-&amp;gt;freeBytes &amp;lt; Memory-&amp;gt;minFreeBytes)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;Memory-&amp;gt;minFreeBytes = Memory-&amp;gt;freeBytes;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.contiguous = gcvTRUE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.fromUser&amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_FROM_USER;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.secure&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_SECURITY;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.onFault&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.uvm&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_UVM;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;.lowVA&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; (gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA)&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.pageCount = (node-&amp;gt;VidMem.bytes + (4096 -1)) &amp;gt;&amp;gt; 12;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckOS_NodeIdAssign&lt;/b&gt;(os, node);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="450" width="770" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-91" value="&lt;div&gt;&lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOne&quot;, &amp;amp;mappingInOne);&lt;/div&gt;&lt;div&gt;if (!mappingInOne) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemoryArea&lt;/b&gt;(os, Memory-&amp;gt;physical, node-&amp;gt;VidMem.offset, node-&amp;gt;VidMem.bytes, &amp;amp;node-&amp;gt;VidMem.physical);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*Node = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="770" width="770" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-83" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-78" target="-QamLBn5pkz0fhhn8fLs-80" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4560" y="3076" as="sourcePoint" />
            <mxPoint x="4890" y="2060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-92" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4350" y="2990" width="690" height="540" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-93" value="&lt;b&gt;gckVIDMEM_NODE_Construct(Kernel, VideoNode, Type, Pool, Flag, NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-94" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-95" value="gckOS_Allocate(os, gcmSIZEOF(gckVIDMEM_NODE), &amp;amp;pointer);&lt;div&gt;gckOS_ZeroMemory(pointer, gcmSIZEOF(gckVIDMEM_NODE));&lt;br&gt;&lt;br&gt;node = pointer;&lt;/div&gt;&lt;div&gt;node-&amp;gt;metadata.magic = VIV_VIDMEM_METADATA_MAGIC;&lt;br&gt;node-&amp;gt;metadata.ts_fd&amp;nbsp; &amp;nbsp;= -1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;node&amp;nbsp; &amp;nbsp;= VideoNode;&lt;/div&gt;&lt;div&gt;node-&amp;gt;kernel = Kernel;&lt;/div&gt;&lt;div&gt;node-&amp;gt;type&amp;nbsp; &amp;nbsp; = Type;&lt;/div&gt;&lt;div&gt;node-&amp;gt;pool&amp;nbsp; &amp;nbsp; = Pool;&lt;/div&gt;&lt;div&gt;node-&amp;gt;flag&amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag;&lt;/div&gt;&lt;div&gt;node-&amp;gt;fd&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = -1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(node-&amp;gt;pool) {&lt;br&gt;case &lt;b&gt;gcvPOOL_SYSTEM/VIRTUAL/USER/SYSTEM_32BIT_VA&lt;/b&gt;: &lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;hostAlloc = gcvTRUE; break;&lt;/div&gt;&lt;div&gt;case &lt;b&gt;gcvPOOL_LOCAL_INTERNAL/LOCAL_EXTERNAL/INTERNAL_SRAM/EXTERNAL_SRAM/LOCAL_EXCLUSIVE&lt;/b&gt;:&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;hostAlloc = gcvFALSE; break;&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;mirror.mirrorNode = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;mirror.type = gcvMIRROR_TYPE_NONE;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b style=&quot;&quot;&gt;_UpdatePIDInfoListNode&lt;/b&gt;(os, node, VideoNode, 0, PIDINFO_LIST_NODE_Const);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gcsLIST_Add&lt;/b&gt;(&amp;amp;node-&amp;gt;link, &amp;amp;Kernel-&amp;gt;db-&amp;gt;videoMemList);&lt;/div&gt;&lt;div&gt;&lt;b&gt;gcsRBTREE_InitNode&lt;/b&gt;(&amp;amp;node-&amp;gt;rblink);&lt;br&gt;&lt;br&gt;*NodeObject = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="60" width="690" height="480" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-96" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-72" target="-QamLBn5pkz0fhhn8fLs-93" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3930" y="2660" as="sourcePoint" />
            <mxPoint x="4360" y="2089" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-97" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1310" y="3740" width="570" height="880" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-98" value="&lt;b&gt;_LockVideoMemory(Kernel, Core, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-99" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-100" value="handle;&lt;div&gt;nodeObject;&lt;/div&gt;&lt;div&gt;address;&lt;br&gt;logical;&lt;/div&gt;&lt;div&gt;physical;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;handle = Interface-&amp;gt;u.LockVideoMemory.node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_HANDLE_Lookup&lt;/b&gt;(Kernel, ProcessID, handle, &amp;amp;nodeObject);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="60" width="570" height="140" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-101" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_Reference(Kernel, nodeObject);&lt;br&gt;}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="200" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-105" value="&lt;b&gt;#if gcdVA_NEW_MM&lt;br&gt;&lt;/b&gt;" style="text;strokeColor=#ae4132;fillColor=#fad9d5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="260" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-102" value="..." style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="290" width="570" height="120" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-106" value="&lt;b&gt;#else&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="410" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-103" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_MAP) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_LockCPU&lt;/b&gt;(Kernel, nodeObject,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Interface-&amp;gt;u.LockVideoMemory.cacheable,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvTRUE, &amp;amp;logical);&lt;br&gt;&amp;nbsp; &amp;nbsp; Interface-&amp;gt;u.LockVideoMemory.memory = gcmPTR_TO_UINT64(logical);&lt;br&gt;}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="440" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-108" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_Lock&lt;/b&gt;(Kernel, nodeObject, &amp;amp;address);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetCPUPhysical&lt;/b&gt;(Kernel, nodeObject, 0, &amp;amp;physical);&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetGid&lt;/b&gt;(Kernel, nodeObject, &amp;amp;gid);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Interface-&amp;gt;u.LockVideoMemory.address = address;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .physicalAddress = physical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .gid = gid;&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="540" width="570" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-107" value="&lt;b&gt;#end&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="690" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-104" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, gcvDB_VIDEO_MEMORY_LOCKED,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmINT2PTR(handle), logical, 0);&lt;div&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_HANDLE_Reference&lt;/b&gt;(Kernel, ProcessID, handle);&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="720" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-109" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdINIT_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;_InitVideoMemoryMirror&lt;/b&gt;(Kernel, nodeObject);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="820" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-110" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2140" y="3580" width="570" height="930" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-111" value="&lt;b&gt;gckVIDMEM_NODE_LockCPU(Kernel, NodeObject, Cacheable, FromUser, Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-112" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-113" value="gcuVIDMEM_NODE_PTR node;&lt;div&gt;gckVIDMEM_BLOCK vidMemBlock;&lt;/div&gt;&lt;div&gt;gckVIDMEM memory;&lt;/div&gt;&lt;div&gt;gctPOINTER logical;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; ...&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#else&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node = NodeObject-&amp;gt;node;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;memory = node-&amp;gt;VidMem.parent;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;vidMemBlock = node-&amp;gt;VirtualChunk.parent;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="60" width="570" height="200" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-26" value="if (memory &amp;amp;&amp;amp; memory-&amp;gt;object.type == gcvOBJ_VIDMEM) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="260" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-27" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (FromUser) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckOS_LockPages&lt;/b&gt;(os,&amp;nbsp;&lt;b style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;node-&amp;gt;VIdMem.devicePool-&amp;gt;poolPhysical&lt;/b&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.devicePool-&amp;gt;poolSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvFALSE,&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;logical&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckKERNEL_MapVideoMemory&lt;/b&gt;(Kernel, gcvTRUE,&amp;nbsp;&lt;b&gt;node-&amp;gt;VidMem.pool&lt;/b&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.physical,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.logical&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="290" width="570" height="200" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-114" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!node-&amp;gt;VidMem.kvaddr)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CreateKernelMapping&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;node-&amp;gt;VidMem.devicePool-&amp;gt;poolPhysical&lt;/b&gt;&lt;/span&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;ode-&amp;gt;VidMem.kvaddr&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CreateKernelMapping&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;node-&amp;gt;VidMem.parent-&amp;gt;physical&lt;/b&gt;&lt;/span&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.kvaddr&lt;/span&gt;);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="490" width="570" height="230" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-25" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="720" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-126" value="else if (vidMemBlock &amp;amp;&amp;amp; vidMemBlock-&amp;gt;object.type == gcvOBJ_VIDMEM_BLOCK) {&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="750" width="570" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-127" value="else {&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="840" width="570" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-123" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-37" target="-QamLBn5pkz0fhhn8fLs-98" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2190" y="4340" as="sourcePoint" />
            <mxPoint x="2240" y="4290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-124" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-103" target="-QamLBn5pkz0fhhn8fLs-111" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1150" y="3625" as="sourcePoint" />
            <mxPoint x="1320" y="3789" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-128" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2940" y="3810" width="570" height="560" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-129" value="&lt;b&gt;gckKERNEL_MapVideoMemory(Kernel, InUserSpace, Pool, Physical, Offset, Bytes, Logical)&amp;nbsp;&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-130" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-131" value="physHandle;&lt;div&gt;logical;&lt;/div&gt;&lt;div&gt;mappingInOne = 1;&lt;br&gt;&lt;br&gt;if (Physical)&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOnce&quot;, &amp;amp;mappingInOne);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="60" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-141" value="&lt;div&gt;if (mappingInOne) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; galDevice = Kernel-&amp;gt;context;&lt;br&gt;&amp;nbsp; &amp;nbsp; device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; switch(Pool) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXTERNAL:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; physHandle = (PLINUX_MDL)device-&amp;gt;externalPhysical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = device-&amp;gt;externalSize;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; physHandle = (PLINUX_MDL)device-&amp;gt;contiguousPhysicals[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes = device-&amp;gt;contiguousSizes[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; physHandle = （PLINUX_MDL)Physical;&lt;br&gt;&amp;nbsp; &amp;nbsp; bytes = Bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; Offset = 0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="160" width="570" height="340" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-140" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_LockPages&lt;/b&gt;(os, physHandle, bytes, gcvFALSE, &amp;amp;logical);&lt;/span&gt;&lt;br&gt;&lt;br&gt;*Logical = (gctUINT8_PTR)logical + Offset;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="500" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-138" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.001;exitY=0.756;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-27" target="-QamLBn5pkz0fhhn8fLs-129" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2830" y="4290" as="sourcePoint" />
            <mxPoint x="2880" y="4240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-142" value="gc_hal_kernel_os.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3720" y="3700" width="570" height="340" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-143" value="&lt;b&gt;gckOS_LockPages(Os, Physical, Bytes, Cacheable, Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-144" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-145" value="PLINUX_MDL mdl;&lt;div&gt;PLINUX_MDL_MAP mdlMap;&lt;/div&gt;&lt;div&gt;gckALLOCATOR allocator;&lt;br&gt;&lt;br&gt;mdl = (PLINUX_MDL)Physical;&lt;/div&gt;&lt;div&gt;allocator = mdl-&amp;gt;allocator;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdlMap = &lt;b&gt;FindMdlMap&lt;/b&gt;(mdl, _GetProcessID());&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (mdlMap == gcvNULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; mdlMap = &lt;b&gt;_CreateMdlMap&lt;/b&gt;(mdl, _GetProcessID());&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (mdlMap-&amp;gt;vmaAddr == gcvNULL)&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;allocator-&amp;gt;ops-&amp;gt;MapUser&lt;/b&gt;(allocator, mdl, mdlMap, Cacheable);&lt;br&gt;&lt;br&gt;mdlMap-&amp;gt;count++;&lt;/div&gt;&lt;div&gt;*Logical = mdlMap-&amp;gt;vmaAddr;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="60" width="570" height="280" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-148" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.999;exitY=0.213;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-27" target="-QamLBn5pkz0fhhn8fLs-143" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2711" y="4173" as="sourcePoint" />
            <mxPoint x="2900" y="4139" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2960" y="3739" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-149" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-140" target="-QamLBn5pkz0fhhn8fLs-143" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2713" y="4095" as="sourcePoint" />
            <mxPoint x="3700" y="3790" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3580" y="4340" />
              <mxPoint x="3650" y="3780" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-150" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4450" y="3860" width="650" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-151" value="&lt;b&gt;reserved_mem_map_user(Allocator, Mdl, MdlMap, Cacheable)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-152" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-153" value="struct reserved_mem *res = (struct reserved_mem *)Mdl-&amp;gt;priv;&lt;div&gt;gctPOINTER userLogical = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;userLogical = &lt;b&gt;vm_mmap&lt;/b&gt;(NULL, 0L, res-&amp;gt;size, PROT_READ| PROT_WRITE, MAP_SHARED|MAP_NORESERVE, 0);&lt;br&gt;&lt;br&gt;&lt;b style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;down_write(&amp;amp;current_mm_mmap_sem);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;do {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct vm_area_struct *vma = &lt;b&gt;find_vma&lt;/b&gt;(current-&amp;gt;mm, (unsigned long)userLogical);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;reserved_mem_mmap&lt;/b&gt;(Allocator, Mdl, gcvFALSE, 0, 0, Mdl-&amp;gt;numPages, vma);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;vmaAddr = userLogical + res-&amp;gt;offset_in_page;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;cacheable = gcvFALSE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;vma = vma;&lt;/div&gt;&lt;div&gt;} while(gcvFALSE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b style=&quot;&quot;&gt;up_write&lt;/b&gt;(&amp;amp;current_mm_mmap_sem);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="60" width="650" height="260" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-154" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-145" target="-QamLBn5pkz0fhhn8fLs-151" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3470" y="4660" as="sourcePoint" />
            <mxPoint x="3610" y="3979" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-155" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5220" y="3860" width="650" height="260" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-156" value="&lt;b&gt;reserved_mem_map(Allocator, Mdl, Cacheable, Offset, skipPages, numPages, struct vm_area_struct *vma)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-157" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-158" value="&lt;div&gt;struct reserved_mem *res = Mdl-&amp;gt;priv;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pfn = (res-&amp;gt;start &amp;gt;&amp;gt; PAGE_SHIFT) + skipPages;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vm_flags_set(vma, gcdVMFLAGS); //(VM_IO| VM_DONTCOPY | VM_DONTEZXPAND | VM_DONTDUMP);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if gcdENABLE_BUFFERABLE_VIDEO_MEMORY&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vma-&amp;gt;vm_page_prot = &lt;b&gt;pgprot_writecombine&lt;/b&gt;(vma-&amp;gt;vm_page_prot);&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vma-&amp;gt;vm_page_prot = &lt;b&gt;pgprot_noncached&lt;/b&gt;(vma-&amp;gt;vm_page_prot);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;remap_pfn_range&lt;/b&gt;(vma, vma-&amp;gt;vm_start + Offset, pfn, numPages &amp;lt;&amp;lt; PAGE_SHIFT, vma-&amp;gt;vm_page_prot);&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="60" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-159" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-153" target="-QamLBn5pkz0fhhn8fLs-156" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4180" y="4140" as="sourcePoint" />
            <mxPoint x="4410" y="4139" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-1" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4460" y="4380" width="570" height="240" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-2" value="&lt;b&gt;gckOS_CreateKernelMapping(Os, Physical, Pool, Offset, Bytes, *Logical)&amp;nbsp;&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-4" value="&lt;div&gt;PLINUX_MDL mdl = Physical;&lt;/div&gt;&lt;div&gt;gckALLOCATOR allocator = mdl-&amp;gt;allocator;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="60" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-5" value="&lt;div&gt;if (mdl-&amp;gt;addr) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *Logical = mdl-&amp;gt;addr + Offset;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;allocator-&amp;gt;ops-&amp;gt;MapKernel&lt;/b&gt;(allocator, mdl, Offset, Bytes, Logical);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Offset == 0 &amp;amp;&amp;amp; Bytes == mdl-&amp;gt;bytes) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* The whole mdl has mapped */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl-&amp;gt;addr = *Logical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="100" width="570" height="140" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-7" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-114" target="qcseRaRLYhIY6nGx_bxc-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2711" y="4173" as="sourcePoint" />
            <mxPoint x="2950" y="3859" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2800" y="4419" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-8" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5220" y="4330" width="650" height="230" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-9" value="&lt;b&gt;reserved_mem_map_kernel(Allocator, Mdl, Offset, Bytes, *Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-10" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-11" value="struct reserved_mem *res = (struct reserved_mem *)Mdl-&amp;gt;priv;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;void* vaddr;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#if &lt;b&gt;gcdENABLE_BUFFERABLE_VIDEO_MEMORY&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr =&amp;nbsp;&lt;b&gt;ioremap_wc&lt;/b&gt;(res-&amp;gt;start + Offset, Bytes);&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr = &lt;b&gt;ioremap&lt;/b&gt;(res-&amp;gt;start + Offset, Bytes);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*Logical = vaddr;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="60" width="650" height="170" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-12" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="qcseRaRLYhIY6nGx_bxc-5" target="qcseRaRLYhIY6nGx_bxc-9" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4300" y="3910" as="sourcePoint" />
            <mxPoint x="4460" y="3909" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-13" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5320" y="2080" width="710" height="460" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-14" value="&lt;b&gt;_FindNode(Kernel, gckVIDMEM Memory, Bank, Bytes, Type, gctUINT32_PTR Alignment)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-15" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-16" value="&lt;div&gt;gcuVIDMEM_NODE_PTR node;&lt;/div&gt;&lt;div&gt;gctUINT32 alignment;&lt;/div&gt;&lt;div&gt;gctUINT32 bankAlignment;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if (Memory-&amp;gt;sentinel[Bank].VidMem.nextFree == gcvNULL) { return gcvNULL; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;//遍历freenode, 找到够大的node&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;for (node = Memory-&amp;gt;sentinel[Bank].VidMem.nextFree; node-&amp;gt;VidMem.bytes != 0; node = node-&amp;gt;VidMem.nextFree) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; offset = node-&amp;gt;VidMem.parent-&amp;gt;physicalBase + node-&amp;gt;VidMem.offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.bytes &amp;lt; Bytes) continue;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#if &lt;b&gt;gcdENABLE_BANK_ALIGNMENT&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#else&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; bankAlignment = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* 根据offset 计算所需要的 alignment */&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;alignment = (*Alignment == 0) ?&amp;nbsp;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;0 :&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(*Alignment - (offset + bankAlignment) &amp;amp; (*Alignment - 1));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (alignment == *Alignment) { alignment = 0; } //表示node 已经是对齐的&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.bytes &amp;gt;= Bytes + alignment + bankAlignment) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Alignment = alignment + bankAlignment;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;return node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="60" width="710" height="400" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-17" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5320" y="2595" width="710" height="540" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-18" value="&lt;b&gt;_Split(Os, gcuVIDMEM_NODE_PTR Node, Bytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-19" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-20" value="&lt;div&gt;gcuVIDMEM_NODE_PTR node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_Allocate(Os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/div&gt;&lt;div&gt;gckOS_ZeroMemory(pointer, sizeof(gcuVIDMEM_NODE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node = pointer;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="60" width="710" height="100" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-22" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 初始化 gcuVIDMEM_NODE */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.offset + Bytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.bytes - Bytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .alignment&amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .locked&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .parent&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.parent;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.pool;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .processID = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .logical&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .kvaddr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="160" width="710" height="160" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-23" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 插入新创建的 node 到 Node之后&amp;nbsp; */&lt;br&gt;&lt;/span&gt;node-&amp;gt;VidMem.next = &lt;b&gt;Node&lt;/b&gt;-&amp;gt;VidMem.next;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prev = Node;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Node&lt;/b&gt;-&amp;gt;VidMem.next = node;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.next-&amp;gt;VidMem.prev = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="320" width="710" height="90" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-21" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 插入Free node 到 Node之后&amp;nbsp; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree = Node-&amp;gt;VidMem.nextFree;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prevFree = &lt;b&gt;Node&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Node&lt;/b&gt;-&amp;gt;VidMem.nextFree = node;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = node;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="410" width="710" height="90" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-24" value="/* 修改Node的大小 */&lt;br&gt;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Node-&amp;gt;VidMem.bytes = Bytes;&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="500" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-21" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.001;exitY=0.282;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-82" target="qcseRaRLYhIY6nGx_bxc-14" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="5160" y="2460" as="sourcePoint" />
            <mxPoint x="4360" y="3039" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-22" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.004;exitY=0.779;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-82" target="qcseRaRLYhIY6nGx_bxc-18" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="5131" y="2220" as="sourcePoint" />
            <mxPoint x="5340" y="2189" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-1" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2140" y="4560" width="650" height="620" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-2" value="&lt;b&gt;gckVIDMEM_NODE_Lock(Kernel, NodeObject, *Address)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-4" value="gcuVIDMEM_NODE_PTR node;&lt;div&gt;gckVIDMEM_BLOCK vidMemBlock;&lt;/div&gt;&lt;div&gt;gckVIDMEM memory;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="60" width="650" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-5" value="&lt;div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; if (NodeObject-&amp;gt;mirror.type == gcvMIRROR_TYPE_LOCAL_MEMORY_MIRROR) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#if !gcdSTATIC_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (NodeObject-&amp;gt;mirror.refCount == 0) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_AllocateVideoMemoryMirror&lt;/b&gt;(Kernel, NodeObject, gcvMIRROR_TYPE_MEMORY_MIRROR);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; NodeObject-&amp;gt;mirror.refCount++;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = NodeObject-&amp;gt;mirror.mirrorNode-&amp;gt;node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = NodeObject-&amp;gt;node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;#else&lt;br&gt;&amp;nbsp; &amp;nbsp; node = NodeObject-&amp;gt;node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="120" width="650" height="230" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-6" value="memory = node-&amp;gt;VidMem.parent;&lt;div&gt;vidMemBlock = node-&amp;gt;VirtualChunk.parent;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="350" width="650" height="40" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-7" value="if (memory &amp;amp;&amp;amp; memory-&amp;gt;object.type == gcvOBJ_VIDMEM &amp;amp;&amp;amp; Kernel-&amp;gt;flatMapping) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;node-&amp;gt;VidMem.lowVA == gcvTRUE &lt;/b&gt;&lt;/span&gt;&amp;amp;&amp;amp; Kernel-&amp;gt;device-&amp;gt;lockLargeVA) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_LockVirtual&lt;/b&gt;(Kernel, node, Address);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_LOCK&lt;/b&gt;(Kernel, node, Address);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;} else if (vidMemBlock &amp;amp;&amp;amp; vidMemBlock-&amp;gt;object.type == gcvOBJ_VIDMEM_BlOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_LockVirtualChunk&lt;/b&gt;(Kernel, node, Address);&lt;br&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_LockVirtual&lt;/b&gt;(Kernel, node, Address);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="390" width="650" height="170" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-8" value="if (&lt;b&gt;gcsRBRREE_NodeLocked&lt;/b&gt;(&amp;amp;NodeObject-&amp;gt;rblink) &amp;amp;&amp;amp; !&lt;b&gt;gcsRBTREE_NodeInTree&lt;/b&gt;(&amp;amp;NodeObject-&amp;gt;rblink))&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gcsRBTREE_Add&lt;/b&gt;(&amp;amp;NodeObject-&amp;gt;rblink, &amp;amp;NodeObject-&amp;gt;kernel-&amp;gt;db-&amp;gt;videoMemRBTree);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-1" vertex="1">
          <mxGeometry y="560" width="650" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-9" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-108" target="5UoCWkmYeCmagEpiS34q-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1890" y="4240" as="sourcePoint" />
            <mxPoint x="2150" y="3629" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-10" value="" style="curved=1;endArrow=classic;html=1;rounded=0;entryX=-0.002;entryY=0.824;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0;exitY=0.115;exitDx=0;exitDy=0;exitPerimeter=0;dashed=1;" parent="1" source="5UoCWkmYeCmagEpiS34q-7" target="-QamLBn5pkz0fhhn8fLs-90" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2090" y="4970" as="sourcePoint" />
            <mxPoint x="4440" y="2750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1650" y="4740" />
              <mxPoint x="2110" y="3890" />
              <mxPoint x="2860" y="3150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-12" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2940" y="4560" width="740" height="330" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-13" value="&lt;b&gt;gckVIDMEM_Lock(Kernel, gcuVIDMEM_NODE_PTR Node, *Address)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="5UoCWkmYeCmagEpiS34q-12" vertex="1">
          <mxGeometry y="26" width="740" height="26" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-14" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="5UoCWkmYeCmagEpiS34q-12" vertex="1">
          <mxGeometry y="52" width="740" height="8" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-16" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (Node-&amp;gt;VidMem.locked++ ==0) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; address;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; offset = Node-&amp;gt;VidMem.offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; switch(Node-&amp;gt;VidMem.pool) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXCLUSIVE: address = Kernel-&amp;gt;exclusiveBaseAddress + offset; ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXTERNAL :&amp;nbsp; address = Kernel-&amp;gt;externalBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp; address&amp;nbsp; = Kernel-&amp;gt;internalBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; address = Kernel-&amp;gt;extSRAMBaseAddresses[Kernel-&amp;gt;device-&amp;gt;extSRAMIndex] + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; address = Kernel-&amp;gt;lowContiguousBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; default:&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.pool == gcvPOOL_SYSTEM; FALLTHRU;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM: address = Kernel-&amp;gt;contiguousBaseAddress[Kernel-&amp;gt;device-&amp;gt;memIndex] + offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Node-&amp;gt;VidMem.address = address;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-12" vertex="1">
          <mxGeometry y="60" width="740" height="240" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-19" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;*Address = Node-&amp;gt;VidMem.address;&lt;/b&gt;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-12" vertex="1">
          <mxGeometry y="300" width="740" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-20" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.007;exitY=0.251;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-7" target="5UoCWkmYeCmagEpiS34q-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1890" y="4365" as="sourcePoint" />
            <mxPoint x="2150" y="4609" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-28" value="&lt;b&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Dev Mem Pool&lt;/b&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;align=left;verticalAlign=top;fontSize=64;" parent="1" vertex="1">
          <mxGeometry x="7470" y="-990" width="3210" height="1800" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-29" value="gc_hal_kernel_platform_default.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7550" y="-450" width="490" height="180" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-30" value="&lt;b&gt;_AdjustParam(Platform, Args)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="5UoCWkmYeCmagEpiS34q-29" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="5UoCWkmYeCmagEpiS34q-29" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-32" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdNEW_MM&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Args-&amp;gt;devMemCPUPhys[dev_index] = Args-&amp;gt;contiguousBases[dev_index];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Args-&amp;gt;devMemSizes[dev_index][0]&amp;nbsp; &amp;nbsp; = Args-&amp;gt;contiguousSizes[dev_index];&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Args-&amp;gt;devMemGPUPhys[dev_index][0] = Args-&amp;gt;devMemCPUPhys[dev_index];&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;Args-&amp;gt;contiguousSizes[dev_index] = 0;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-29" vertex="1">
          <mxGeometry y="60" width="490" height="120" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-36" value="gc_hal_kernel_platform_default.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8250" y="-730" width="490" height="580" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-37" value="&lt;b&gt;gckGALDEVICE_Construct(Platform, Args, gckGALDEVICE *Device)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="5UoCWkmYeCmagEpiS34q-36" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-38" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="5UoCWkmYeCmagEpiS34q-36" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-39" value="&lt;span&gt;for (devIndex = 0; devIndex &amp;lt; gal_device-&amp;gt;args.devCount; devIndex++) {&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-36" vertex="1">
          <mxGeometry y="60" width="490" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-41" value="if (Args-&amp;gt;devMemSizes[devIndex][0] &amp;gt; 0) {&lt;div&gt;&amp;nbsp; &amp;nbsp; deviceMemoryGPUPhys[gcdMAX_POOL_LIST_LENGTH] = {0};&lt;br&gt;&amp;nbsp; &amp;nbsp; deviceMemorySizes[gcdMAX_POOL_LIST_LENGTH]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = {0};&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; id[gcdMAX_POOL_LIST_LENGTH]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = {0};&lt;br&gt;&amp;nbsp; &amp;nbsp; listSet[gcdMAX_POOL_LIST_COUNT][gcdMAX_POOL_LIST_LENGTH] = {{0}};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;devMemPoolType = gcvPOOL_LOCAL_EXTERNAL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;devMemCPUPhys = Args-&amp;gt;devMemCPUPhys[devIndex];&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckOS_MemCopy(deviceMemoryGPUPhys, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Args-&amp;gt;devMemGPUPhys[devIndex],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; sizeof(gctPHYS_ADDR_T) * gcdMAX_POOL_LIST_LENGTH);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; gckOS_MemCopy(deviceMemorySizes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Args-&amp;gt;devMemSizes[devIndex],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; sizeof(gctSIZE_T) * gcdMAX_POOL_LIST_LENGTH);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; id[0] = 01;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; id[1] = 10;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; listSet[0][0] = 01;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; listSet[0][1] = 10;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; listSet[1][0] = 10;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; listSet[1][1] = 01;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_SetPoolList&lt;/b&gt;(device,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;deviceMemoryGPUPhys,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;deviceMemorySizes,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;id, listSet);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-36" vertex="1">
          <mxGeometry y="90" width="490" height="460" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-40" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-36" vertex="1">
          <mxGeometry y="550" width="490" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-42" value="gc_hal_kernel_platform_default.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8970" y="-460" width="590" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-43" value="&lt;b&gt;gckVIDMEM_SetPoolList(Device, *DevMemGPUPhys, *DevMemSize, *Id, *ListSet)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="26" width="590" height="26" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-44" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="52" width="590" height="8" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-45" value="gctPHYS_ADDR_T devMemCPUPhys = 0;&lt;div&gt;gctSIZE_T offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;gctUINT32 index&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;gcsPOOL_RESV *pool;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;devMemCPUPhys = Device-&amp;gt;devMemCPUPhys;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckOS_MemCopy&lt;/b&gt;(Device-&amp;gt;devMemPoolLists, ListSet, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcdMAX_POOL_LIST_COUNT * gcdMAX_POOL_LIST_LENGTH);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="60" width="590" height="130" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-49" value="for (index = 0; index &amp;lt; gcdMAX_POOL_LIST_LENGTH; index++) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="190" width="590" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-46" value="&amp;nbsp; &amp;nbsp; if (!DevMemSize[index]) continue;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pool = &amp;amp;Device-&amp;gt;devMemPools[index];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;devMemCPUPhys + offset, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;DevMemSize[index], &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;pool-&amp;gt;poolVidMem&lt;/span&gt;);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; /* 其实就是设置 上面 construct 创建的node 的devicePool. &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;sentinel.VedMem.next 就是allocate的 gcuVIDMEM_NODE;&lt;br&gt;&amp;nbsp; &amp;nbsp; */&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pool-&amp;gt;poolVidMem-&amp;gt;sentinel[0].VidMem.next-&amp;gt;VidMem.devicePool = pool;&lt;/span&gt;&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* 设置pool Type, 此处为gcdPOOL_TPYE_LOCAL_EXTERNAL, construct默认创建的是 default */&lt;br&gt;&amp;nbsp; &amp;nbsp; pool-&amp;gt;poolVidMem-&amp;gt;sentinel[0].VidMem.next-&amp;gt;VidMem.pool = Device-&amp;gt;devMemPoolType;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_NodeIdAssign&lt;/b&gt;(os, &amp;amp;pool-&amp;gt;poolVidMem-&amp;gt;sentinel[0]);&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_NodeIdAssign&lt;/b&gt;(os, pool-&amp;gt;poolVidMem-&amp;gt;sentinel[0].VidMem.next);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; pool-&amp;gt;poolVidMem-&amp;gt;capability = gcvALLOC_FLAG_LINUX_RESERVED_MEM |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_CONTIGUOUS |&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_MEMLIMIT |&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_CPU_ACCESS |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_DMABUF_EXPORTABLE |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_NON_CPU_ACCESS |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_FROM_USER |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_32BIT_VA |&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvALLOC_FLAG_PRIOR_32BIT_VA;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="220" width="590" height="460" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-50" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; devMemCPUPhys + offset,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; DevMemSize[index],&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; _SetDevicePoolName(os, &lt;b&gt;Id[index]&lt;/b&gt;),&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;&amp;amp;pool-&amp;gt;poolPhysical&lt;/b&gt;);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="680" width="590" height="100" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-53" value="&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;#if gcdENABLE_HMM&lt;br&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckDEVICE_MemRemapPages&lt;/b&gt;(Device, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;devMemCPUPhys + offset, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;DevMemSize[index], &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;index);&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;#endif&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="780" width="590" height="100" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-54" value="&amp;nbsp; &amp;nbsp; pool-&amp;gt;poolVidMem-&amp;gt;physical = pool-&amp;gt;poolPhysical;&amp;nbsp; &amp;nbsp;/* 记录 mdl */" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="880" width="590" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-2" value="&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;/* 设置基本信息 */&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pool-&amp;gt;poolEnabled&amp;nbsp; &amp;nbsp; = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pool-&amp;gt;poolVidMem-&amp;gt;sentinel-&amp;gt;VidMem.devicePool = pool;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;-&amp;gt;poolBase&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= devMemCPUPhys + offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;-&amp;gt;poolGPUPhys&amp;nbsp; = DevMemGPUPhys[index];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;poolSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = DevMemSize[index];&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;poolId&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Id[index];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;poolFreeBytes = pool-&amp;gt;poolSize;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;/* 为下一个pool 更新 offset */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;offset += DevMemSize[index];&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="910" width="590" height="180" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-47" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="5UoCWkmYeCmagEpiS34q-42" vertex="1">
          <mxGeometry y="1090" width="590" height="30" as="geometry" />
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-48" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.998;exitY=0.832;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-41" target="5UoCWkmYeCmagEpiS34q-43" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8790" y="-190" as="sourcePoint" />
            <mxPoint x="8840" y="-240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-51" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-41" target="5UoCWkmYeCmagEpiS34q-30" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8749" y="-247" as="sourcePoint" />
            <mxPoint x="8980" y="-411" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5UoCWkmYeCmagEpiS34q-52" value="" style="curved=1;endArrow=classic;html=1;rounded=0;entryX=-0.004;entryY=0.473;entryDx=0;entryDy=0;exitX=0.996;exitY=0.239;exitDx=0;exitDy=0;exitPerimeter=0;dashed=1;entryPerimeter=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-41" target="5UoCWkmYeCmagEpiS34q-46" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8830" y="-10" as="sourcePoint" />
            <mxPoint x="8880" y="-60" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8850" y="-540" />
              <mxPoint x="8870" y="-20" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-3" value="gc_hal_kernel_platform_default.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9900" y="-70" width="560" height="290" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-4" value="&lt;b&gt;gckDEVICE_MemRemapPages(Os, Start, Size, Index)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="pEW-uXL8UO9qdR9KQa9T-3" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-5" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="pEW-uXL8UO9qdR9KQa9T-3" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-6" value="&lt;span&gt;struct &lt;b&gt;dev_pagemap &lt;/b&gt;*pgmap = &amp;amp;Device-&amp;gt;devMemPools[Index].pgmap;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="pEW-uXL8UO9qdR9KQa9T-3" vertex="1">
          <mxGeometry y="60" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-10" value="&lt;span&gt;gckOS_ZeroMemory(pgmap, sizeof(struct dev_pagemap));&lt;/span&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;pgmap-&amp;gt;type = MEMORY_DEVICE_PRIVATE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;pgmap-&amp;gt;nr_range = 1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="pEW-uXL8UO9qdR9KQa9T-3" vertex="1">
          <mxGeometry y="90" width="560" height="170" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-8" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="pEW-uXL8UO9qdR9KQa9T-3" vertex="1">
          <mxGeometry y="260" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pEW-uXL8UO9qdR9KQa9T-9" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-53" target="pEW-uXL8UO9qdR9KQa9T-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8749" y="-247" as="sourcePoint" />
            <mxPoint x="8980" y="-411" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-2" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Allocate with Dev mem pool&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;fontSize=64;fontStyle=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="7470" y="1930" width="6140" height="11020" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-3" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7590" y="3050" width="760" height="450" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-4" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory(Kernel, Alignment, Type, Flag, PoolID, *Bytes, *Pool, *NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="26" width="760" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-5" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="52" width="760" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-6" value="&lt;div&gt;...&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="60" width="760" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-7" value="&lt;div&gt;&lt;b&gt;AllocateMemory:&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;vGPUType == gcvVGPU_MDEV)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_LOCAL_EXTERNAL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (*Pool == gcvPOOL_SYSTEM_32BIT_VA &amp;amp;&amp;amp; Kernel-&amp;gt;device-&amp;gt;lockLargeVA == gcvTRUE)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="90" width="760" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-8" value="&lt;div&gt;&lt;b&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;span&gt;#if gcdNEW_MM&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&amp;nbsp; &amp;nbsp; if (*Pool != gcvPOOL_VIRTUAL)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Pool = Kernel-&amp;gt;device-&amp;gt;devMemPoolType;&lt;/span&gt;&lt;br&gt;#else&lt;br&gt;&amp;nbsp; &amp;nbsp; ...&lt;br&gt;#endif&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="190" width="760" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-9" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (...)&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (cacheable == gcvFALSE &amp;amp;&amp;amp; secure == gcvFALSE) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="290" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-10" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckVIDMEM_NODE_DeviceMemoryAllocate&lt;/b&gt;(Kernel, Type, Flag, Alignment, &amp;amp;bytes, 1, &amp;amp;nodeObject);&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="350" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-13" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-3" vertex="1">
          <mxGeometry y="410" width="760" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-15" value="Defines" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1040" y="-170" width="450" height="216" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-16" value="&lt;b&gt;Important defines&lt;/b&gt;" style="text;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="26" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-17" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="52" width="450" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-19" value="gcdENABLE_VIRTUAL_POOL" style="text;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="60" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-20" value="gcdENABLE_VIDEO_MEMORY_MIRROR" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="86" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-21" value="gcdENABLE_NONCACHE_COMMANDBUF&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (debug)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="112" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-22" value="gcdALLOC_CMD_FROM_RESERVE" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="138" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-23" value="gcdDYNAMIC_ALLOC_LOCAL_MEMORY" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="164" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-27" value="gcdCONTIGUOUS_SIZE_LIMIT&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (0)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-15" vertex="1">
          <mxGeometry y="190" width="450" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-28" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8560" y="3050" width="680" height="470" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-29" value="&lt;b&gt;gckVIDMEM_NODE_DeviceMemoryAllocate(Kernel, Type, Alignment, *Bytes, Id, *NodeObject)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="26" width="680" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-30" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="52" width="680" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-31" value="gcuVIDMEM_NODE_PTR node&amp;nbsp; = gcvNULL;&lt;div&gt;gckVIDMEM_NODE nodeObject = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gckGATHER_MEMORY gather&amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;gctUINT32 align&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcmALIGN(Alignment, 0x1000);&lt;/div&gt;&lt;div&gt;gctSIZE_T bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcmALIGN(*Bytes, align);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="60" width="680" height="90" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-32" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过遍历 poolList 找到freeNode 分配memory */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_DeviceMemoryReserve&lt;/b&gt;&lt;span&gt;(Kernel-&amp;gt;device, bytes, Id,&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Flag &amp;amp; gcvALLOC_FLAG_CONTIGUOUS,&amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;/*如果是 debug, 最好使用 contiguous */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gather&lt;/span&gt;);&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="150" width="680" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-33" value="&lt;div&gt;&lt;b&gt;/*&amp;nbsp; */&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_DeviceMemoryConstruct&lt;/b&gt;(Kernel-&amp;gt;device, bytes, gather, &amp;amp;node);&lt;br&gt;&lt;br&gt;node-&amp;gt;VidMem.fromUser = (Flag &amp;amp; gcvALLOC_FLAG_FROM_USER);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .secure&amp;nbsp; &amp;nbsp; &amp;nbsp;=&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(Flag &amp;amp; gcvALLOC_FLAG_SECURITY);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .onFault&amp;nbsp; &amp;nbsp; = (Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .uvm&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= (Flag &amp;amp; gcvALLOC_FLAG_UVM);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .lowVA&amp;nbsp; &amp;nbsp; &amp;nbsp; = (Flag &amp;amp; (gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA));&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="230" width="680" height="160" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-34" value="&lt;b&gt;gckVIDMEM_NODE_Construct&lt;/b&gt;(Kernel, node, Type, Kernel-&amp;gt;device-&amp;gt;devMemPoolType, Flag, &amp;amp;nodeObject);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="390" width="680" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-37" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Bytes = bytes;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*NodeObject = nodeObject;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-28" vertex="1">
          <mxGeometry y="430" width="680" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-39" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-10" target="2cfCXFZoOlLPJyDhJhEe-29" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8540" y="3730" as="sourcePoint" />
            <mxPoint x="8590" y="3680" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8400" y="3430" />
              <mxPoint x="8490" y="3089" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-40" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9480" y="2710" width="590" height="510" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-41" value="&lt;b&gt;gckVIDMEM_DeviceMemoryReserve(Device, Bytes, Id, Contiguous, &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Gather&lt;/span&gt;)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="26" width="590" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-42" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="52" width="590" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-43" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置需要reserve的meomry大小 */&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;needBytes = Bytes;&lt;/span&gt;&lt;div&gt;index = 0;&lt;/div&gt;&lt;div&gt;*poolList;&lt;br&gt;gcsPOOL_RESV *pool;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="60" width="590" height="90" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-169" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 根据Id 获取 poolList */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;for (index = 0; index &amp;lt; gcsMAX_POOL_LIST_COUNT; index++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Device-&amp;gt;devMemPoolLists[index][0] == Id) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;poolList = Device-&amp;gt;devMemPoolLists[index];&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="150" width="590" height="110" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-45" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 遍历poolList, 直到needBytes 可以被poolList放下, 并创建Gather */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;for (index = 0; index &amp;lt; gcdMAX_POOL_LIST_LENGTH; index++) {&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="260" width="590" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-46" value="&amp;nbsp; &amp;nbsp; getBytes = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; pool = &lt;b&gt;_GetPoolById&lt;/b&gt;(Device, poolList[index]);&lt;br&gt;&amp;nbsp; &amp;nbsp; if (pool &amp;amp;&amp;amp; pool-&amp;gt;poolEnabled) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过_QueryBytes 试图通过当前pool分配 */&lt;/span&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;getBytes = &lt;b style=&quot;&quot;&gt;_QueryBytes&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;&amp;amp;pool-&amp;gt;poolVidMem-&amp;gt;sentinel[0]&lt;/b&gt;&lt;/span&gt;, needBytes, Contiguous, &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Gather&lt;/b&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; needBytes -= getBytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 分配完毕, 退出循环 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if (needBytes == 0) break;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="300" width="590" height="140" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-47" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="440" width="590" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-49" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果needBytes 无法被poolList装下, out of mem */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (needBytes &amp;gt; 0) gcmkONEEROR(gcvSTATUS_OUT_OF_MEMORY);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-40" vertex="1">
          <mxGeometry y="470" width="590" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-48" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-32" target="2cfCXFZoOlLPJyDhJhEe-41" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8360" y="3440" as="sourcePoint" />
            <mxPoint x="8570" y="3099" as="targetPoint" />
            <Array as="points">
              <mxPoint x="9270" y="3240" />
              <mxPoint x="9410" y="2750" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-50" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9480" y="3400" width="620" height="990" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-51" value="&lt;b&gt;gckVIDMEM_DeviceMemoryConstruct(Device, Bytes, Gather, *Node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="26" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-52" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="52" width="620" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-53" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;/* 只有最后一个node 可以是 partial reserved */&lt;/span&gt;&lt;/div&gt;gcuVIDMEM_NODE_PTR node = *Node, preNode = gcvNULL, headNode = gcvNULL;&lt;br&gt;bytes = Bytes;&lt;div&gt;inSamePool = gcvFALSE;&lt;/div&gt;&lt;div&gt;gckGATHER_MEMORY gather = Gather;&lt;/div&gt;&lt;div&gt;gcsPOOL_RESV *pool = gcvNULL;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="60" width="620" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-60" value="while (gather) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="160" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-54" value="&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node = gather-&amp;gt;node;&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pool&amp;nbsp; = node-&amp;gt;VidMem.devicePool&lt;/span&gt;;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="190" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-59" value="&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果当前node包含gather 所需分配的memory大小,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;1) 把node从free链表中取出, 2) 更新bytes 3) 更新node对应devPool的freeBytes */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.bytes == gather-&amp;gt;reserveBytes) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 1) 把node 从free 链表中取出 */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.prevFree-&amp;gt;VidMem.nextFree = node-&amp;gt;VidMem.nextFree;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = node-&amp;gt;VidMem.prevFree;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 2) 更新bytes 和 devicePool */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes-= node-&amp;gt;VidMem.reservedBytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.devicePool-&amp;gt;poolFreeBytes -= node-&amp;gt;VidMem.bytes;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 3) 清除node链接&amp;nbsp; */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.prevFree = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextFree = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="230" width="620" height="230" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-55" value="&amp;nbsp; &amp;nbsp; else {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="460" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-61" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/*如果当前节点是patial reserved, slip reserved的部分*/&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_SplitTail&lt;/b&gt;(os, &amp;amp;node, gather-&amp;gt;reserveBytes)&lt;/span&gt;) gcmkONERROR(gcvSTATUS_INVALID_ARGUMENT)&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 把node 从free 链表中取出 */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.prevFree-&amp;gt;VidMem.nextFree = node-&amp;gt;VidMem.nextFree;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = node-&amp;gt;VidMem.prevFree;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 更新bytes 和 devicePool *&lt;/span&gt;/&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.devicePool-&amp;gt;poolFreeBytes -= node-&amp;gt;VidMem.bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes -= gather-&amp;gt;reserveBytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="490" width="620" height="170" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-62" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 记录头节点 */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (!headNode) headNode = node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果node 不是第一个节点, 构建reserved 链表 */&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;if (preNode) preNode-&amp;gt;VidMem.&lt;b&gt;nextReserved = node&lt;/b&gt;;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; preNode = node;&lt;div&gt;&amp;nbsp; &amp;nbsp; inSamePool = (gather &amp;amp;&amp;amp; gather-&amp;gt;next != Gather &amp;amp;&amp;amp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gather-&amp;gt;next-&amp;gt;node-&amp;gt;VidMem.devicePool == pool);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果gather 遍历完成, 退出*/&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;if (Gather == gather-&amp;gt;next) break;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 否则&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;接着&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;next继续遍历 */&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;else gather = gather-&amp;gt;next;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="660" width="620" height="210" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-56" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="870" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-57" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/*销毁gather, 以及其next对应的整个链表 */&lt;/span&gt;&lt;/div&gt;&lt;span&gt;&lt;b&gt;_GatherMemoryDestroy&lt;/b&gt;(os, Gather);&lt;/span&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;&lt;b style=&quot;&quot;&gt;headNode-&amp;gt;VidMem.bufferBytes = Bytes;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Node = headNode;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-50" vertex="1">
          <mxGeometry y="900" width="620" height="90" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-58" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-33" target="2cfCXFZoOlLPJyDhJhEe-51" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9250" y="3240" as="sourcePoint" />
            <mxPoint x="9490" y="2829" as="targetPoint" />
            <Array as="points">
              <mxPoint x="9270" y="3360" />
              <mxPoint x="9390" y="3440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-63" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10200" y="2710" width="700" height="1360" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-64" value="&lt;b&gt;_QueryBytes(os, gcuVIDMEM_NODE_PTR HeadNode, RequestBytes, Contiguous, gckGATHER_MEMORY *Gather)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-65" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-66" value="gcuVIDMEM_NODE_PTR tmpNode;&lt;div&gt;needBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; = RequestBytes;&lt;/div&gt;&lt;div&gt;enough&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvFALSE;&lt;/div&gt;&lt;div&gt;gckGATHER_MEMORY gather;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* _QueryBytes可能是一个while过程, 如果是第一次该Gather 可能是NULL, 或者是接传入的Gather&amp;nbsp; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if(*Gather) gather = *Gather;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="60" width="700" height="120" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-170" value="&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 从头节点开始遍历, 列如VIDMEM的sentinel */&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;tmpNode = HeadNode;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="180" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-67" value="&lt;div&gt;do {&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="220" width="700" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-68" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 获取节点剩余Bytes */&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; avaliableBytes = tmpNode-&amp;gt;VidMem.bytes - tmpNode-&amp;gt;VidMem.reservedBytes;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (avaliableBytes &amp;gt; 0) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; enough = gcvFALSE;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="250" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-1" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果 needBytes 被reserved完成 */&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if ( avaliableBytes &amp;gt;= needBytes) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Contiguous) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果是contig, 直接SplitTail, 并设置节点的reservedBytes */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;tmpNode-&amp;gt;VidMem.reservedBytes += needBytes;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="320" width="700" height="80" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-2" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过SplitTail, tmpNode将是Split出来的新节点 */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;_SplitTail&lt;/b&gt;(Os, &amp;amp;tmpNode, needBytes);&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tmpNode-&amp;gt;VidMem.reservedBytes = needBytes;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="400" width="700" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-3" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;_GatherMemoryInit&lt;/b&gt;(Os, &amp;amp;gather, tmpNode, needBytes);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="460" width="700" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-73" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* 其他 allocate 请求将增加该节点的reservedBytes, 如果avaliableBytes 足够大 */&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tmpNode-&amp;gt;VidMem.reservedBytes += needBytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (gather) &lt;b&gt;_GatherMemoryAddTail&lt;/b&gt;(Os, gather, tmpNode, needBytes);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_GatherMemoryInit&lt;/b&gt;(Os, &amp;amp;gather, tmpNode, needBytes);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; needBytes = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; enough = gcvTRUE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="490" width="700" height="150" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-4" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 当前节点容量小于neededBytes */&lt;/span&gt;&amp;nbsp;&lt;div&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Contiguous) {&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="640" width="700" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-5" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* 尝试查询下一个freeNode 是否满足contiguous(通过offset) 并且bytes+当前nodeBytes &amp;gt;= needBytes */&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_QueryContiguousFreeNode&lt;/b&gt;(tmpNode, needBytes)&lt;/span&gt;) {&lt;br&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* 成功找到满足要求的freeNode, 就merge当前node与下一个freeNode, continue从获取avaliableBytes 重新开始 */&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; while(gcmIS_SUCCESS(&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_Merge&lt;/b&gt;(Os, tmpNode)&lt;/span&gt;));&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; continue;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="700" width="700" height="100" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-26" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tmpNode = tmpNode-&amp;gt;VidMem.nextFree;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (HeadNode == tmpNode) break;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; continue;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="800" width="700" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-75" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; needBytes -= avaliableBytes;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tmpNode-&amp;gt;VidMem.reservedBytes += avaliableBytes;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* 确认node 有足够的memroy 去reserve */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkASSERT(tmpNode-&amp;gt;VidMem.bytes &amp;gt;= tmpNode-&amp;gt;VidMem.reservedBytes);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if(gather) &lt;b&gt;_GatherMemoryAddTail&lt;/b&gt;(Os, gather, tmpNode, avaliableBytes);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;_GatherMemoryInit&lt;/b&gt;(Os, &amp;amp;gather, tmpNode, avaliableBytes);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="850" width="700" height="200" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-74" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 所有的 reserved memory 信息将会保存在 gather list */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if (enough) break;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="1050" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-72" value="&amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置tmpNode为下一个Free Node */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; tmpNode = tmpNode-&amp;gt;VidMem.nextFree;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="1090" width="700" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-69" value="} while(HeadNode != tmpNode);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="1140" width="700" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-70" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果分配完毕, 返回gather */&lt;/span&gt;&lt;/div&gt;&lt;span&gt;if (!needBytes) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!(*Gather)) *Gather = gather;&lt;/div&gt;&lt;div&gt;&lt;span&gt;}&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* 如果非连续并且没分配完, 返回gather 和此次分配的大小 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!enough &amp;amp;&amp;amp; !Contiguous) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!(*Gather)) *Gather = gather;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return RequestBytes - needBytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 其他情况 返回0, 此次无分配*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; return 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-63" vertex="1">
          <mxGeometry y="1170" width="700" height="190" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-71" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-46" target="2cfCXFZoOlLPJyDhJhEe-64" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10130" y="2990" as="sourcePoint" />
            <mxPoint x="9490" y="3259" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10110" y="3080" />
              <mxPoint x="10160" y="2749" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-76" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11200" y="2020" width="460" height="870" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-77" value="&lt;b&gt;_SplitTail(Os, gcuVIDMEM_NODE_PTR *Node, Bytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="26" width="460" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-78" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="52" width="460" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-79" value="gcuVIDMEM_NODE_PTR node, origNode;&lt;div&gt;gctPOINTER pointer;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* 设置origNode 为原node*/&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;origNode = *Node;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="60" width="460" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-80" value="if (Bytes == origNode-&amp;gt;VidMem.bytes) return gcvTRUE;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="140" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-84" value="if (Bytes &amp;lt;= 0 || Bytes &amp;gt; origNode-&amp;gt;VidMem.bytes) return gcvFALSE;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="170" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-85" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 创建新的节点 */&lt;/span&gt;&lt;/div&gt;gckOS_Allocate(Os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;br&gt;gckOS_ZeroMemory(pointer, sizeof(gcuVIDMEM_NODE));&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node = pointer;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="200" width="460" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-86" value="&lt;div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 创建新的节点并添加到原node之前, 通过offset, prev, next 操作*/&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/*&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;设置其offset为原node的offset&lt;/span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;&amp;nbsp;*/&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = origNode-&amp;gt;VidMem.offset;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置原node 的offset 向后移动Bytes*/&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;origNode-&amp;gt;VidMem.offset&amp;nbsp; &amp;nbsp;+= Bytes;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 初始化node 并设置其bytes 为所需Bytes */&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Bytes;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .alignment&amp;nbsp; &amp;nbsp; = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .locked&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .parent&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= origNode-&amp;gt;VidMem.parent;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = origNode-&amp;gt;VidMem.pool;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .processID&amp;nbsp; &amp;nbsp;= 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .logical&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .kvaddr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;.devicePool = origNode-&amp;gt;VidMem.devicePool;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/*&amp;nbsp; 设置新node的reservedBytes, 并更新原node的reservedByte, 注意Assert检查 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (&lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;origNode-&amp;gt;VidMem.reservedBytes&lt;/span&gt; &amp;gt; 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.reservedBytes = Bytes;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;gcmkASSERT(origNode-&amp;gt;VidMem.reservedBytes &amp;gt;= Bytes);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;origNode-&amp;gt;VidMem.reservedBytes -= Bytes;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="270" width="460" height="330" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-88" value="&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 在原节点前插入新节点 */&lt;/span&gt;&lt;div&gt;node-&amp;gt;VidMem.next = origNode;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prev = origNode-&amp;gt;VidMem.prev;&lt;/div&gt;&lt;div&gt;origNode-&amp;gt;VidMem.prev-&amp;gt;VidMem.next = node;&lt;/div&gt;&lt;div&gt;origNode-&amp;gt;VidMem.prev = node;&lt;br&gt;&lt;b&gt;gckOS_NodeIdAssign&lt;/b&gt;(Os, node);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="600" width="460" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-89" value="&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 在原node前插入新的Free Node ???? */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;node-&amp;gt;VidMem.nextFree = origNode;&lt;div&gt;node-&amp;gt;VidMem.prevFree = origNode-&amp;gt;VidMem.prevFree;&lt;/div&gt;&lt;div&gt;origNode-&amp;gt;VidMem.prevFree-&amp;gt;VidMem.nextFree = node;&lt;/div&gt;&lt;div&gt;origNode-&amp;gt;VidMem.prevFree = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="700" width="460" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-87" value="&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 调整节点大小 */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;origNode-&amp;gt;VidMem.bytes -= Bytes;&lt;div&gt;*Node = node;&amp;nbsp;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="780" width="460" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-82" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-76" vertex="1">
          <mxGeometry y="840" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-90" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="3ZKCpSd9Htbg4jpo1CF4-1" target="2cfCXFZoOlLPJyDhJhEe-77" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10970" y="3170" as="sourcePoint" />
            <mxPoint x="11100" y="2884" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10920" y="3068" />
              <mxPoint x="11130" y="2059" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-91" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11200" y="3590" width="620" height="380" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-92" value="&lt;b&gt;_Merge(Os, gcuVIDMEM_NODE_PTR Node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="26" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-93" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="52" width="620" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-94" value="gcuVIDMEM_NODE_PTR node;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 保存当前node 的next, merge是merge next node到当前node, 最后free next node */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;node = Node-&amp;gt;VidMem.next;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="60" width="620" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-96" value="&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 此处检查 heap是否corrupted&amp;nbsp; */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;if (Node-&amp;gt;VidMem.offset + Node-&amp;gt;VidMem.bytes != node-&amp;gt;VidMem.offset || node-&amp;gt;VidMem.reservedBytes) {&lt;div&gt;&amp;nbsp; &amp;nbsp; return gcvSTATUS_HEAP_CORRUPTED;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="130" width="620" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-97" value="&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 调整Node大小 */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;Node-&amp;gt;VidMem.bytes += node-&amp;gt;VidMem.bytes;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="200" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-100" value="&lt;span&gt;&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 将 next node 从node链表和 free node 链表取出 */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;Node-&amp;gt;VidMem.next&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = node-&amp;gt;VidMem.next;&lt;/span&gt;&lt;div&gt;&lt;span&gt;Node-&amp;gt;VidMem.nextFree = node-&amp;gt;VidMem.nextFree;&lt;br&gt;&lt;br&gt;Node-&amp;gt;VidMem.next-&amp;gt;VidMem.prev = Node;&lt;br&gt;Node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = Node;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="240" width="620" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-101" value="&lt;span&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Free next node */&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;gcmkOS_SAFE_FREE(Os, node);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-91" vertex="1">
          <mxGeometry y="340" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-103" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.002;exitY=0.748;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="3ZKCpSd9Htbg4jpo1CF4-5" target="2cfCXFZoOlLPJyDhJhEe-92" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10909" y="3064" as="sourcePoint" />
            <mxPoint x="11250" y="2209" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10940" y="3485" />
              <mxPoint x="11160" y="3630" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-104" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12070" y="2250" width="640" height="240" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-105" value="&lt;b&gt;_GatherMemoryInit(Os, gckGATHER_MEMORY *Gather, gcuVIDMEM_NODE_PTR Node, ReservedBytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-104" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-106" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-104" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-107" value="gckGATHER_MEMORY gather = gcvNULL;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_Allocate(Os, sizeof(struct _gcsGATHER_MEMORY), &amp;amp;pointer);&lt;br&gt;gckOS_ZeroMemory(pointer, sizeof(struct _gcsGATHER_MEMORY));&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-104" vertex="1">
          <mxGeometry y="60" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-110" value="&lt;span&gt;gather = pointer;&lt;br&gt;&lt;br&gt;gather-&amp;gt;node = Node;&lt;/span&gt;&lt;div&gt;&lt;span&gt;gather-&amp;gt;reserveBytes = ReservedBytes;&lt;br&gt;gather-&amp;gt;next = gather;&lt;br&gt;gather-&amp;gt;prev = gather;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;*Gather = gather;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-104" vertex="1">
          <mxGeometry y="130" width="640" height="110" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-112" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="3ZKCpSd9Htbg4jpo1CF4-3" target="2cfCXFZoOlLPJyDhJhEe-105" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10910" y="3078" as="sourcePoint" />
            <mxPoint x="11210" y="2069" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10920" y="3185" />
              <mxPoint x="11070" y="2910" />
              <mxPoint x="11840" y="2910" />
              <mxPoint x="11950" y="2289" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-113" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12070" y="2560" width="640" height="290" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-114" value="&lt;b&gt;_GatherMemoryAddTail(Os, gckGATHER_MEMORY *Gather, gcuVIDMEM_NODE_PTR Node, ReservedBytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-113" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-115" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-113" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-116" value="gckGATHER_MEMORY gather = gcvNULL;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_Allocate(Os, sizeof(struct _gcsGATHER_MEMORY), &amp;amp;pointer);&lt;br&gt;gckOS_ZeroMemory(pointer, sizeof(struct _gcsGATHER_MEMORY));&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-113" vertex="1">
          <mxGeometry y="60" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-117" value="&lt;span&gt;gather = pointer;&lt;br&gt;&lt;br&gt;gather-&amp;gt;node = Node;&lt;/span&gt;&lt;div&gt;&lt;span&gt;gather-&amp;gt;reserveBytes = ReservedBytes;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 在当前节点前面 插入新创建的节点 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;Gather-&amp;gt;prev-&amp;gt;next = gather;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;gather-&amp;gt;next = Gather;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;gather-&amp;gt;prev = Gather-&amp;gt;prev;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;Gather-&amp;gt;prev = gather;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-113" vertex="1">
          <mxGeometry y="130" width="640" height="160" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-118" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.999;exitY=0.676;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-73" target="2cfCXFZoOlLPJyDhJhEe-114" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10912" y="3113" as="sourcePoint" />
            <mxPoint x="12080" y="2299" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10930" y="3300" />
              <mxPoint x="11080" y="2960" />
              <mxPoint x="11910" y="2960" />
              <mxPoint x="11980" y="2599" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-119" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-57" target="2cfCXFZoOlLPJyDhJhEe-121" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10909" y="3182" as="sourcePoint" />
            <mxPoint x="12070" y="3570" as="targetPoint" />
            <Array as="points">
              <mxPoint x="11110" y="4345" />
              <mxPoint x="12030" y="3919" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-120" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12090" y="3880" width="640" height="260" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-121" value="&lt;b&gt;_GatherMemoryDestroy(Os, gckGATHER_MEMORY Gather)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-120" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-122" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-120" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-123" value="gckGATHER_MEMORY gather = Gather;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-120" vertex="1">
          <mxGeometry y="60" width="640" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-125" value="&lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;/* 删除当前gather 以及 next 链表 */&lt;br&gt;&lt;/span&gt;while (gather) {&lt;div&gt;&amp;nbsp; &amp;nbsp; gckGATHER_MEMORY tmpGather = gather-&amp;gt;next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Gather == tmpGather) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkOS_SAFE_FREE(Os, gather);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkOS_SAFE_FREE(Os, gather);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gather = tmpGather;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-120" vertex="1">
          <mxGeometry y="90" width="640" height="170" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-126" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="7560" y="5370" width="670" height="910" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-127" value="&lt;b&gt;_LockVideoMemory(Kernel, Core, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="26" width="670" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-128" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="52" width="670" height="8" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-2" value="&lt;b&gt;#if gcdVA_NEW_MM&lt;br&gt;&lt;/b&gt;" style="text;strokeColor=#ae4132;fillColor=#fad9d5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="60" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-3" value="gckVM vm;&lt;div&gt;gcsDATABASE_PTR database;&lt;/div&gt;&lt;div&gt;gcsVARangeArgs args = {0};&lt;br&gt;gckVARANGE range;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="90" width="670" height="70" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-1" value="&lt;b&gt;#endif&lt;/b&gt;" style="text;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="160" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-129" value="..." style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="190" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-131" value="&lt;b&gt;#if gcdVA_NEW_MM&lt;br&gt;&lt;/b&gt;" style="text;strokeColor=#ae4132;fillColor=#fad9d5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="230" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-139" value="&lt;b&gt;gckKERNEL_FindDatabase&lt;/b&gt;(Kernel, ProcessID, gcvFALSE, &amp;amp;database);&lt;br&gt;vm = (gckVM)database-&amp;gt;vm;&lt;br&gt;&lt;br&gt;if (nodeObject-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_32BIT_VA || nodeObject-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_PRIOR_32BIT_VA)&lt;br&gt;&amp;nbsp; &amp;nbsp; args.flags |= gcvMAP_FLAG_32BIT_VA;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;args.createRange = gcvTRUE;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;args.migrateable&amp;nbsp; &amp;nbsp;= gcvFALSE;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="260" width="670" height="130" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-140" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过node的bufferBytes 获取大小 */&lt;/span&gt;&lt;/div&gt;&lt;b&gt;gckVIDMEM_NODE_GetSize&lt;/b&gt;(Kernel, nodeObject, &amp;amp;args.size));" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="390" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-141" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过vm_mmap得到虚拟地址并记录到range, 最后添加range信息到VM中 */&lt;/span&gt;&lt;/div&gt;&lt;b&gt;gckVM_VARangeAlloc&lt;/b&gt;(Kernel, vm, &amp;amp;args, &amp;amp;range);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="430" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-142" value="&lt;b&gt;gckVM_VARangeMap&lt;/b&gt;(Kernel, range, nodeObject, 0, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvMAP_FLAG_MAP_CPU | gcvMAP_FLAG_MAP_GPU | gcvMAP_FLAG_READWRITE));" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="470" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-143" value="&lt;b&gt;gckVIDMEM_NODE_GetCPUPhysical&lt;/b&gt;(Kernel, nodeObject, 0, &amp;amp;physical);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="510" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-132" value="&lt;div&gt;&lt;b&gt;gckVIDMEM_NODE_GetGid&lt;/b&gt;(Kernel, nodeObject, &amp;amp;gid);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="550" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-144" value="&lt;b&gt;Interface-&amp;gt;u.LockVideoMemory.&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;address = range-&amp;gt;start;&lt;/span&gt;&lt;/b&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;.memory = range-&amp;gt;start;&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.physicalAddress = physical;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.gid&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gid;&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="580" width="670" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-133" value="&lt;b&gt;#else&lt;/b&gt;" style="text;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="650" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-134" value="......" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="680" width="670" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-136" value="&lt;b&gt;#end&lt;/b&gt;" style="text;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="720" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-137" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, gcvDB_VIDEO_MEMORY_LOCKED,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmINT2PTR(handle), logical, 0);&lt;div&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_HANDLE_Reference&lt;/b&gt;(Kernel, ProcessID, handle);&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="750" width="670" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-138" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdINIT_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;_InitVideoMemoryMirror&lt;/b&gt;(Kernel, nodeObject);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-126" vertex="1">
          <mxGeometry y="850" width="670" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-145" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8520" y="5090" width="510" height="260" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-146" value="&lt;b&gt;gckVIDMEM_NODE_GetSize(Kernel, gckVIDMEM_NODE NodeObject, *Size)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="2cfCXFZoOlLPJyDhJhEe-145" vertex="1">
          <mxGeometry y="26" width="510" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-147" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-145" vertex="1">
          <mxGeometry y="52" width="510" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-148" value="gcuVIDMEM_NODE_PTR node;&lt;div&gt;gckVIDMEM_BLOCK vidMemBlock;&lt;br&gt;&lt;br&gt;node = NodeObject-&amp;gt;node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-145" vertex="1">
          <mxGeometry y="60" width="510" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-149" value="if (vidMemBlock &amp;amp;&amp;amp; vidMemBlock-&amp;gt;object.type == gcvOBJ_VIDMEM_BLOCK) {&lt;div&gt;&amp;nbsp; &amp;nbsp; *Size = node-&amp;gt;VirtualChunk.bytes;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if (NodeObject-&amp;gt;pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType)&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;*Size = node-&amp;gt;VidMem.bufferBytes;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Size = node-&amp;gt;VidMem.bytes;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-145" vertex="1">
          <mxGeometry y="130" width="510" height="130" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-150" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-140" target="2cfCXFZoOlLPJyDhJhEe-146" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8450" y="5710" as="sourcePoint" />
            <mxPoint x="8690" y="6139" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8260" y="5780" />
              <mxPoint x="8430" y="5130" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-151" value="gc_hal_kernel_vm.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9245" y="5420" width="640" height="800" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-152" value="&lt;b&gt;gckVM_VARangeAlloc(Kernel, Vm, Args, gckVRANGE * Range)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-153" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-154" value="alignedSize;&lt;div&gt;address;&lt;/div&gt;&lt;div&gt;range;&lt;/div&gt;&lt;div&gt;mmu;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gckVASPACE space = Vm-&amp;gt;vaSpace[Kernel-&amp;gt;devID];&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;gctUVA start =0, end =0;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="60" width="640" height="100" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-4" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过args 得到页对齐的start, end 地址 */&lt;/span&gt;&lt;/div&gt;start&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcmALIGN_BASE(Args-&amp;gt;start, gcd4K_PAGE_SIZE);&lt;div&gt;end&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcmALIGN(Args-&amp;gt;start + Args.size,&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gcd4K_PAGE_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;alignedSize&amp;nbsp; = end - start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_Allocate(os, sizeof(struct _gcsVRANGE), &amp;amp;pointer);&lt;br&gt;gckOS_ZeroMemory(pointer,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;sizeof(struct _gcsVRANGE));&lt;br&gt;range&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= pointer;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="160" width="640" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-5" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;range-&amp;gt;parent&amp;nbsp; &amp;nbsp; &amp;nbsp;= space;&lt;/span&gt;&lt;div&gt;range-&amp;gt;flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Args-&amp;gt;flag;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;range-&amp;gt;migratable = gcvTRUE;&amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 默认设置migratable为true, gckOS_VARangeAlloc可能会重新设置该值 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;range-&amp;gt;start&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过系统vm_mmap获取VA, 最后记录在range中 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (Args-&amp;gt;createRange)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_VARangeAlloc&lt;/b&gt;(os, range,&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;alignedSize, &amp;amp;address&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; address = start;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;range-&amp;gt;start = address;&lt;/div&gt;&lt;div&gt;range-&amp;gt;size&amp;nbsp; = alignedSize;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="300" width="640" height="200" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-6" value="&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#if gcdENABLE_HMM&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; range-&amp;gt;preferLocation&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= PREFER_NOT_SET;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; range-&amp;gt;cpuAccessControl |= gcvMAP_FLAG_FIRST_TOUCH;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; range-&amp;gt;readMostly&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvFALSE;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // range-&amp;gt;migratable&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;= Args-&amp;gt;migratable;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="500" width="640" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-155" value="&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#if gcdENABLE_HMM&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 添加range 到vm中 */&lt;/span&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp; &lt;b&gt;_VARange_Add&lt;/b&gt;(Vm, range);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#else&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gcsLIST_Add&lt;/b&gt;(&amp;amp;range-&amp;gt;rbLink, &amp;amp;Vm-&amp;gt;rangeRoot);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="600" width="640" height="110" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-7" value="&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#if gcdENABLE_HMM&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_HmmNotifierInsert&lt;/b&gt;(os, range);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(248, 206, 204);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="710" width="640" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-8" value="*Range = range;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-151" vertex="1">
          <mxGeometry y="770" width="640" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-156" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-141" target="2cfCXFZoOlLPJyDhJhEe-152" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8240" y="5655" as="sourcePoint" />
            <mxPoint x="8530" y="5359" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8280" y="5820" />
              <mxPoint x="8440" y="5460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-157" value="gc_hal_kernel_vm.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9245" y="6320" width="640" height="600" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-158" value="&lt;b&gt;gckVM_VARangeMap(Kernel, Range, NodeObject, Offset, PageCount, MapFlag)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-159" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-19" value="&lt;div&gt;&lt;b&gt;gckKERNEL_GetCurrentMMU&lt;/b&gt;(Kernel, gcvTRUE, vm-ProcessID, &amp;amp;mmu);&lt;br&gt;&lt;b&gt;gckVIDMEM_NODE_GetSize&lt;/b&gt;(Kernel, NodeObject, &amp;amp;size)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if(Page Count) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; size = Page Count&amp;lt;&amp;lt;12;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="60" width="640" height="100" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-160" value="&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;if(MapFlag &amp;amp; gcvMAP_FLAG_MAP_CPU) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过allocator 的mmap 分配物理页 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_VARangeMmap&lt;/b&gt;(Os, Range, NodeObject, Offset);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="160" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-20" value="&lt;span style=&quot;background-color: rgb(151, 208, 119);&quot;&gt;if(MapFlag &amp;amp; gcvMAP_FLAG_MAP_GPU) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcsMMU_ENTRY_FLAG entryFlag = {0};&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryFlag.exception&amp;nbsp; = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryFlag.lowVA&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= NodeObject-&amp;gt;node-&amp;gt;VidMem.lowVA;&lt;br&gt;&amp;nbsp; &amp;nbsp; entryFlag.pageFault = MapFlag &amp;amp; gcvMAP_FLAG_ACESS_NONE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryFlag.writable&amp;nbsp; &amp;nbsp; &amp;nbsp;= MapFlag &amp;amp; gcvMAP_FLAG_READWRITE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entryFlag.pageType&amp;nbsp; = gcvPAGE_TYPE_4K;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckMMU_WritePageTableEntry&lt;/b&gt;(mmu, NodeObject, 0, size, Range-&amp;gt;start + Offset, &amp;amp;entryFlag);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="230" width="640" height="150" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-21" value="Range-&amp;gt;devAccessControl[Kernel-&amp;gt;devID] = MapFlag;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b&gt;gcsLIST_Add&lt;/b&gt;(&amp;amp;NodeObject-&amp;gt;nodeList, &amp;amp;Range-&amp;gt;nodeListHead);&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="380" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-161" value="&lt;b&gt;gckOS_Allocate&lt;/b&gt;(os, sizeof(struct _gcsMAPINFO), &amp;amp;pointer);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mapInfo = pointer;&lt;/div&gt;&lt;div&gt;mapInfo.address&amp;nbsp; = Range-&amp;gt;start + Offset;&lt;/div&gt;&lt;div&gt;mapInfo.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = size;&lt;/div&gt;&lt;div&gt;mapInfo.vaRange = Range;&lt;/div&gt;&lt;div&gt;mapInfo.devID&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Kernel-&amp;gt;devID;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b&gt;gcsLIST_Add&lt;/b&gt;(&amp;amp;mapInfo-&amp;gt;mapList, &amp;amp;NodeList-&amp;gt;mapInfoHead);&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-157" vertex="1">
          <mxGeometry y="450" width="640" height="150" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-162" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-142" target="2cfCXFZoOlLPJyDhJhEe-158" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8240" y="5685" as="sourcePoint" />
            <mxPoint x="8530" y="5679" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8270" y="5860" />
              <mxPoint x="8480" y="6359" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-163" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8510" y="6950" width="640" height="400" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-164" value="&lt;b&gt;gckVIDMEM_NODE_GetCPUPhysical(Kernel, NodeObject, Offset, *PhysicalAddress)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="2cfCXFZoOlLPJyDhJhEe-163" vertex="1">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-165" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="2cfCXFZoOlLPJyDhJhEe-163" vertex="1">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-166" value="node = NodeObject-&amp;gt;node;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;memory = node-&amp;gt;VidMem.parent;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-163" vertex="1">
          <mxGeometry y="60" width="640" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-167" value="if (memory &amp;amp;&amp;amp; memory-&amp;gt;object.type == gcvOBJ_VIDMEM) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if(node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Offset &amp;gt;= node-&amp;gt;VidMem.bufferBytes) gcmkONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; while(node) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (offset + node-&amp;gt;VidMem.reservedBytes &amp;gt;= Offset) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += node-&amp;gt;VidMem.reservedBytes;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node&amp;nbsp; &amp;nbsp; = node-&amp;gt;VidMem.nextReserved;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;*PhysicalAddress = node-&amp;gt;VidMem.devicePool-&amp;gt;poolBase + node-&amp;gt;VidMem.offset + Offset - offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* contiguousPool */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="2cfCXFZoOlLPJyDhJhEe-163" vertex="1">
          <mxGeometry y="120" width="640" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2cfCXFZoOlLPJyDhJhEe-168" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-143" target="2cfCXFZoOlLPJyDhJhEe-164" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="8240" y="5720" as="sourcePoint" />
            <mxPoint x="8530" y="5819" as="targetPoint" />
            <Array as="points">
              <mxPoint x="8250" y="5900" />
              <mxPoint x="8470" y="6990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-14" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11200" y="3030" width="620" height="310" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-15" value="&lt;b&gt;_QueryContiguousFreeNode&lt;/b&gt;&lt;b&gt;(gcuVIDMEM_NODE_PTR Node, RequestedBytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="26" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-16" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="52" width="620" height="8" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-17" value="getBytes = Node-&amp;gt;VidMem.bytes;&lt;div&gt;gcuVIDMEM_NODE node = Node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="60" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-23" value="while(&amp;nbsp;getBytes&amp;nbsp;&amp;lt; RequestedBytes) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="100" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-24" value="&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 由于是查找Contiguous, 所以当前节点的offset + bytes 需要等于下一个FreeNode的offset &lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;并且node 不能是partial reserved的节点*/&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.offset&amp;nbsp; + node-&amp;gt;VidMem.bytes != node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.offset ||&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;node-&amp;gt;VidMem.reservedBytes&lt;/span&gt;)&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return gcvFALSE;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="130" width="620" height="80" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-25" value="&amp;nbsp; &amp;nbsp; node = node-&amp;gt;VidMem.nextFree;&lt;br&gt;&amp;nbsp; &amp;nbsp; getBytes += node-&amp;gt;VidMem.bytes;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="210" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-18" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="250" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-20" value="&lt;span&gt;return gcvTRUE;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="3ZKCpSd9Htbg4jpo1CF4-14" vertex="1">
          <mxGeometry y="280" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3ZKCpSd9Htbg4jpo1CF4-22" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.999;exitY=0.378;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="3ZKCpSd9Htbg4jpo1CF4-5" target="3ZKCpSd9Htbg4jpo1CF4-15" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10911" y="3472" as="sourcePoint" />
            <mxPoint x="11210" y="3639" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10950" y="3436" />
              <mxPoint x="11160" y="3069" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-9" value="gc_hal_kernel_os.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10770" y="5420" width="510" height="420" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-10" value="&lt;b&gt;gckOS_VARangeAlloc(Os, gckVRANGE Range, Bytes, *Logical)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="26" width="510" height="26" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-11" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="52" width="510" height="8" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-12" value="struct file *filp = (struct file *)Range-&amp;gt;parent-&amp;gt;filp;&lt;div&gt;gctADDRESS logical;&lt;/div&gt;&lt;div&gt;flags = MAP_SHARED | MAP_NORESERVE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="60" width="510" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-16" value="&lt;div&gt;if (Range-&amp;gt;flags &amp;amp; gcvMAP_FLAG_32BIT_VA) flags |= gcdMAP_32BIT;&lt;/div&gt;&lt;div&gt;if (Range-&amp;gt;flags &amp;amp; gcvMAP_FLAG_MAP_CONTROL)&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;flags |= gcdMAP_POOL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (Range-&amp;gt;flags &amp;amp; gcvMAP_FLAG_MAP_2M_PAGE)&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;flags |= gcdMAP_2M_PAGE;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="120" width="510" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-15" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 通过系统mmap 获得VA */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;logical = &lt;b style=&quot;&quot;&gt;vm_mmap&lt;/b&gt;(filp, Range-&amp;gt;start, Bytes, PROT_READ| PROT_WRITE, flags, 0);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (logical &amp;lt; 0 &amp;amp;&amp;amp; logical &amp;gt; -30) gcmkONERROR(gcvSTATUS_INVALID_ADDRESS;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="180" width="510" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-13" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 找到VA对应的vma, 记录到Range */&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;vma&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= &lt;b&gt;find_vma&lt;/b&gt;(current-&amp;gt;mm, logical);&lt;/span&gt;&lt;div&gt;Range-&amp;gt;vma = (gctPOINTER)vma;&lt;/div&gt;&lt;div&gt;vma-&amp;gt;vm_private_data =&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(gctPOINTER)Range;&lt;br&gt;if (vma-&amp;gt;vm_flags &amp;amp; (VM_PFNMAP | VM_MIXEDMAP))&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;Range-&amp;gt;migrateable = gcvFALSE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;Range-&amp;gt;migrateable = gcvTRUE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="240" width="510" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-18" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 返回VA */&lt;/span&gt;&lt;/div&gt;*Logical = logical;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="JtXYeRphJ5WXioU-IupR-9" vertex="1">
          <mxGeometry y="380" width="510" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JtXYeRphJ5WXioU-IupR-14" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="JtXYeRphJ5WXioU-IupR-5" target="JtXYeRphJ5WXioU-IupR-10" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9260" y="6086" as="sourcePoint" />
            <mxPoint x="9550" y="5740" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10000" y="5820" />
              <mxPoint x="10080" y="5460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-1" value="gc_hal_kernel_vm.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10115" y="5870" width="510" height="320" as="geometry" />
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-2" value="&lt;b&gt;_VARange_Add(Os, gckVRANGE Range, Bytes, *Logical)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="xt16O4ISyjv4oT31lnue-1" vertex="1">
          <mxGeometry y="26" width="510" height="26" as="geometry" />
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="xt16O4ISyjv4oT31lnue-1" vertex="1">
          <mxGeometry y="52" width="510" height="8" as="geometry" />
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-4" value="struct rb_root *root = &amp;amp;Vm-&amp;gt;rangeRoot;&lt;div&gt;struct rb_node **new = &amp;amp;(root-&amp;gt;rb_node), *parent = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="xt16O4ISyjv4oT31lnue-1" vertex="1">
          <mxGeometry y="60" width="510" height="40" as="geometry" />
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-6" value="&lt;div&gt;while(*new) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckVARANGE temp_range = gcmCONTAINEROF(*new, struct _gcsVARANGE, rbLink);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; parent = *new;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Range-&amp;gt;start + Range-&amp;gt;size &amp;lt;= temp_range-&amp;gt;start) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new = &amp;amp;((*new)-&amp;gt;rb_left);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (Range-&amp;gt;start &amp;gt;= temp_range-&amp;gt;start + temp_range-&amp;gt;size) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new = &amp;amp;((*new)-&amp;gt;rb_right);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkONERROR(gcvSTATUS_INVALID_ADDRESS);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;rb_link_node&lt;/b&gt;(&amp;amp;Range-&amp;gt;rbLink, parent, new);&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;rb_insert_color&lt;/b&gt;(&amp;amp;Range-&amp;gt;rbLink, root);&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="xt16O4ISyjv4oT31lnue-1" vertex="1">
          <mxGeometry y="100" width="510" height="220" as="geometry" />
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-10" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-155" target="xt16O4ISyjv4oT31lnue-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9895" y="5795" as="sourcePoint" />
            <mxPoint x="10125" y="5469" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10000" y="5910" />
              <mxPoint x="10050" y="5910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xt16O4ISyjv4oT31lnue-12" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Allocate user&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;fontSize=64;fontStyle=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="14860" y="1930" width="7450" height="5880" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-2" value="gc_hal_kernel_os.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10770" y="6330" width="580" height="590" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-3" value="&lt;b&gt;gckOS_VARangeMmap(Os, gckVRANGE Range, NodeObject, Offset)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="VqAhi49Ukww8_snOarwK-2" vertex="1">
          <mxGeometry y="26" width="580" height="26" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-4" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="VqAhi49Ukww8_snOarwK-2" vertex="1">
          <mxGeometry y="52" width="580" height="8" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-5" value="&lt;div&gt;struct vm_area_struct *vma;&lt;/div&gt;&lt;div&gt;PLINUX_MDL mdl;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="VqAhi49Ukww8_snOarwK-2" vertex="1">
          <mxGeometry y="60" width="580" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-6" value="&lt;div&gt;vma = &lt;b&gt;find_vma&lt;/b&gt;(current-&amp;gt;mm, Range-&amp;gt;start);&lt;/div&gt;&lt;div&gt;if (NodeObject-&amp;gt;pool == Os-&amp;gt;device-devices[0]-&amp;gt;devMemPoolType || NodeObject-&amp;gt;node-VidMem.parent) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcuVIDMEM_NODE_PTR node = NodeObject-&amp;gt;node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; while(node) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl = (PLINUX_MDL)node-&amp;gt;VidMem.parent-&amp;gt;physical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; allocator = mdl-&amp;gt;allocator;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;allocator-&amp;gt;ops-&amp;gt;Mmap&lt;/b&gt;(allocator, mdl,&lt;/span&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;NodeObject-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_CACHEABLE,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;offset,&lt;/span&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;node-&amp;gt;VidMem.offset &amp;gt;&amp;gt; PAGE_SHIFT,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;node-&amp;gt;VidMem.bytes&amp;gt;&amp;gt;PAGE_SHIFT,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;vma);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="VqAhi49Ukww8_snOarwK-2" vertex="1">
          <mxGeometry y="100" width="580" height="230" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-9" value="&lt;span&gt;else {&lt;/span&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; gcuVIDMEM_NODE_PTR node = NodeObject-&amp;gt;node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_GetSize(Os-&amp;gt;device-&amp;gt;devices[0]-&amp;gt;kernels[0], NodeObject, &amp;amp;size);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.parent)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl = (PLINUX_MDL)node-&amp;gt;VidMem.parent-&amp;gt;physical;&lt;br&gt;&amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl = (PLINUX_MDL)node-&amp;gt;VidMem.physical;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; allocator = mdl-&amp;gt;allocator;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b&gt;allocator-&amp;gt;ops-&amp;gt;Mmap&lt;/b&gt;(allocator, mdl,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;NodeObject-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_CACHEABLE,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;Offset,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;0,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;size &amp;gt;&amp;gt; PAGE_SHIFT,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt; vma);&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="VqAhi49Ukww8_snOarwK-2" vertex="1">
          <mxGeometry y="330" width="580" height="260" as="geometry" />
        </mxCell>
        <mxCell id="VqAhi49Ukww8_snOarwK-11" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="2cfCXFZoOlLPJyDhJhEe-160" target="VqAhi49Ukww8_snOarwK-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9885" y="6576" as="sourcePoint" />
            <mxPoint x="10115" y="6460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10020" y="6370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-1" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11400" y="7100" width="660" height="920" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-2" value="&lt;b&gt;gckMMU_WritePageTableEntry(Mmu, NodeObj, Offset, Size, Address, EntryFlag)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="26" width="660" height="26" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="52" width="660" height="8" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-4" value="&lt;div&gt;gctPOINTER&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageTable;&lt;/div&gt;&lt;div&gt;gcuVIDMEM_NODE_PTR&amp;nbsp; &amp;nbsp;node = gcvNULL;&lt;/div&gt;&lt;div&gt;gctPOINTER&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; memoryHandle;&lt;/div&gt;&lt;div&gt;gctSIZE_T&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; handleOffset;&lt;br&gt;gctSIZE_T&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageCount;&lt;/div&gt;&lt;div&gt;gcsADDRESS_AREA_PTR area = gcvNULL;&lt;/div&gt;&lt;div&gt;gctADDRESS&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;area = gcvNULL;&lt;/div&gt;&lt;div&gt;gctPHYS_ADDR_T&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gpuPhysicalAddress = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pageCount = Size &amp;gt;&amp;gt; 12;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="60" width="660" height="160" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-10" value="if (EntryFlag-&amp;gt;attrChangeOnly) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_MapDeviceMemory&lt;/b&gt;(os, kernel, Mmu, node, Address, pageCount, EntryFlag);&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node = NodeObj-&amp;gt;node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;if (node-&amp;gt;VidMem.pool == kernel-&amp;gt;devMemPoolType)&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;EntryFlag-&amp;gt;node = node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="220" width="660" height="120" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-5" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 其实就是获取 mdl */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckVIDMEM_NODE_GetMemoryHandle&lt;/b&gt;(kernel, NodeObj, &amp;amp;memoryHandle);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 获取node的 VidMem.offset */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckVIDMEM_NODE_GetOffset&lt;/b&gt;(kernel, NodeObj, &amp;amp;handleOffset);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="340" width="660" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-18" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;if (node-&amp;gt;VidMem.pool == kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;gckOS_MapDeviceMemory&lt;/b&gt;(os, kernel, Mmu, node, Address, pageCount, EntryFlag);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="410" width="660" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-11" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; pageCount; i ++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!i || address &amp;gt;= area-&amp;gt;baseAddress + area-&amp;gt;vaSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (i) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(kernel, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;area-&amp;gt;pteVideoMem,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;0,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;area-&amp;gt;pteLogical,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;area-&amp;gt;pteSize);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_GetVirtualAddressInfo&lt;/b&gt;(Mmu, address, 1, gcvPAGE_TYPE_4K, &amp;amp;area, &amp;amp;pageTable);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetGPUPhysical&lt;/b&gt;(kernel,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;NodeObj,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;i*gcd4K_PAGE_SIZE,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;gpuPhysicalAddress);&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_SetPage&lt;/b&gt;(Mmu,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gpuPhysicalAddress, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (gctADDRESS *)(area-&amp;gt;pteLogical)&amp;nbsp; + (address - area-&amp;gt;baseAddress) / gcd4K_PAGE_SIZE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; EntryFlag);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; address += gcd4K_PAGE_SIZE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(kernel, area-&amp;gt;pteVidioMem, 0, area-&amp;gt;pteLogical, area-&amp;gt;pteSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_Flush&lt;/b&gt;(Mmu, gcvVIDMEM_TYPE_GENERIC);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="470" width="660" height="420" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-12" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckMMU_Flush&lt;/b&gt;(Mmu, gcvVIDMEM_TYPE_GENERIC);&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="0Et7W-5WGeGeLLH6OweF-1" vertex="1">
          <mxGeometry y="890" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-7" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="JtXYeRphJ5WXioU-IupR-20" target="0Et7W-5WGeGeLLH6OweF-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9895" y="6520" as="sourcePoint" />
            <mxPoint x="10780" y="6379" as="targetPoint" />
            <Array as="points">
              <mxPoint x="10760" y="7139" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-8" value="" style="curved=1;endArrow=classic;html=1;rounded=0;dashed=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="VqAhi49Ukww8_snOarwK-6" target="-QamLBn5pkz0fhhn8fLs-156" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="12470" y="7280" as="sourcePoint" />
            <mxPoint x="6370" y="3930" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12140" y="6590" />
              <mxPoint x="12290" y="4950" />
              <mxPoint x="9400" y="4760" />
              <mxPoint x="6890" y="3880" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-13" value="gc_hal_kernel_os.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12780" y="7700" width="690" height="560" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-14" value="&lt;b&gt;gckOS_MapDeviceMemory(Os, Kernel, Mmu, gcuVIDMEM_NODE_PTR Node, Address, PageCount, EntryFlag)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-15" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-20" value="gcsADDRESS_AREA *area;&lt;div&gt;address = Address;&lt;/div&gt;&lt;div&gt;gctUINT64 *entry;&lt;/div&gt;&lt;div&gt;bytes = 0;&lt;/div&gt;&lt;div&gt;gcuVIDMEM_NODE_PTR node = Node;&lt;/div&gt;&lt;div&gt;gctPHYS_ADDR_T phys = ~0ULL;&lt;/div&gt;&lt;div&gt;gcsMMU_ENTRY_FLAG *enryFlag = EntryFlag;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="60" width="690" height="110" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-28" value="&lt;div&gt;while(node || (entryFlag-&amp;gt;attrChangeOnly &amp;amp;&amp;amp; i&amp;lt;PageCount)) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (node)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; phys = node-&amp;gt;VidMem.devicePool-&amp;gt;poolGPUPhys + node-&amp;gt;VidMem.offset;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; phys = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; bytes = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for (; i &amp;lt; PageCount &amp;amp;&amp;amp; (!node || bytes &amp;lt; node-&amp;gt;VidMem.reservedBytes); i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!i || address &amp;gt;= area-&amp;gt;baseAddress + area-&amp;gt;vaSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 清Cache */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (i)&amp;nbsp;&lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(Kernel, area-&amp;gt;pteVideoMem, 0, area-&amp;gt;pteLogical, area-&amp;gt;pteSize);&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="170" width="690" height="190" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-29" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 填充area 信息 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckMMU_GetVirtualAddressInfo&lt;/b&gt;(Mmu, address, PageCount, gcvPAGE_TYPE_4K, &amp;amp;area, (gctPOINTER*)&amp;amp;entry);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="360" width="690" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-16" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_SetPage&lt;/b&gt;(Mmu, phys + bytes, entry++, EntryFlag);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; address += gcd4K_PAGE_SIZE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes&amp;nbsp; &amp;nbsp; &amp;nbsp;+= gcd4K_PAGE_SIZE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(Kernel, area-&amp;gt;pteVideoMem, 0, area-&amp;gt;pteLogical, area-&amp;gt;pteSize);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 204, 255);&quot;&gt;if(node) node = node-&amp;gt;VidMem.&lt;b&gt;nextReserved&lt;/b&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-13" vertex="1">
          <mxGeometry y="400" width="690" height="160" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-17" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-18" target="0Et7W-5WGeGeLLH6OweF-14" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="12200" y="7390" as="sourcePoint" />
            <mxPoint x="13405" y="6740" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12150" y="7540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-22" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11385" y="8180" width="690" height="310" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-23" value="&lt;b&gt;gckMMU_GetVirtualAddressInfo(Mmu, Address, PageCount, PageType, *Area, *PageTable)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="0Et7W-5WGeGeLLH6OweF-22" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-24" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="0Et7W-5WGeGeLLH6OweF-22" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-25" value="&lt;div&gt;status = &lt;b&gt;_GetVirtualAddressInfo&lt;/b&gt;(Mmu, Address, PageType, Area, PageTable);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-22" vertex="1">
          <mxGeometry y="60" width="690" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-26" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果没有通过VA找到Entry, 那么构造一个包含 VA的Area 并返回对应的entry */&lt;/span&gt;&lt;/div&gt;if (status == gdvSTATUS_NOT_FOUND &amp;amp;&amp;amp; PageCount != 0) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_ConstructSpecificAddressArea&lt;/b&gt;(Mmu, PageCount, gcvAREA_TYPE_4K, Address, &amp;amp;newArea, gcvNULL);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Mmu-&amp;gt;dynamicAreaList == gcvNULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Mmu-&amp;gt;dynamicAreaList = newArea;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; newArea-&amp;gt;next = Mmu-&amp;gt;dynamicAreaList;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Mmu-&amp;gt;dynamicAreaList = newArea;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 重新查找一次 entry */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_GetVirtualAddressInfo&lt;/b&gt;(Mmu, Address, PageType, Area, PageTable);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-22" vertex="1">
          <mxGeometry y="90" width="690" height="220" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-27" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-29" target="0Et7W-5WGeGeLLH6OweF-23" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="13080" y="7820" as="sourcePoint" />
            <mxPoint x="12210" y="7599" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12700" y="8080" />
              <mxPoint x="11250" y="8140" />
              <mxPoint x="11250" y="8219" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-30" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11780" y="8620" width="690" height="810" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-31" value="&lt;b&gt;_GetVirtualAddressInfo(Mmu, Address, PageType, *Area, *PageTable)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-32" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-33" value="&lt;div&gt;dynamicLow4K = &amp;amp;Mmu-&amp;gt;dynamicLowArea4K;&lt;/div&gt;&lt;div&gt;dynamicArea&amp;nbsp; &amp;nbsp; = Mmu-&amp;gt;dynamicAreaList;&lt;/div&gt;&lt;div&gt;found = gcvFALSE;&lt;/div&gt;&lt;div&gt;pageTable = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="60" width="690" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-37" value="&lt;div&gt;if (Address &amp;gt;= dynamicLow4K-&amp;gt;baseAddress &amp;amp;&amp;amp;&lt;br&gt;&amp;nbsp; &amp;nbsp; Address &amp;lt; dynamicLow4K-&amp;gt;baseAddress + dynamicLow4K-&amp;gt;vaSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; found = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; dynamicArea = dynamicLow4K;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="130" width="690" height="90" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-36" value="&lt;div&gt;if (!found &amp;amp;&amp;amp; dynamicArea) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; while( dynamicArea) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Address &amp;gt;= dynamicArea-&amp;gt;baseAddress &amp;amp;&amp;amp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Address &amp;lt; dynamicArea-&amp;gt;baseAddress + dynamicArea-&amp;gt;vaSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; found = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; dynamicArea = dynamicArea-&amp;gt;next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="220" width="690" height="160" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-34" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (found) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; gctUINT64 pgd = 0, pud = 0, pmd = 0, pte = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gctUINT64 index = 0;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; switch(dynamicArea-&amp;gt;areaType) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvAREA_TYPE_4K:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvAREA_TYPE_LOW_4K:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pgd&amp;nbsp; = &lt;b style=&quot;&quot;&gt;gcmkMMU_GET_PGD&lt;/b&gt;(Address);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pud&amp;nbsp; = &lt;b style=&quot;&quot;&gt;gcmkMMU_GET_PUD&lt;/b&gt;(Address);&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pmd = &lt;b style=&quot;&quot;&gt;gcmkMMU_GET_PMD&lt;/b&gt;(Address);&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pte&amp;nbsp; &amp;nbsp;= &lt;b style=&quot;&quot;&gt;gcmkMMU_GET_PTE_4K&lt;/b&gt;(Address);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (PageType == gcvPAGE_TYPE_4K) &quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index = (((pgd * gcdMMU_PUD_ENTRY_NUM + pud) - dynamicArea-&amp;gt;pudStart)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;* gcdMMU_PMD_ENTRY_NUM + pmd)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;* gcdMMU_PTE_4K_ENTRY_NUM + pte;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pageTable = dynamicArea-&amp;gt;pteLogical + index;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else if (PageType == gcvPAGE_TYPE_2M) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; default:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; if (Area) *Area = dynamicArea;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; if (PageTable) *PageTable = pageTable;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; status = gcvSTATUS_NOT_FOUND;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-30" vertex="1">
          <mxGeometry y="380" width="690" height="430" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-35" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-25" target="0Et7W-5WGeGeLLH6OweF-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="12790" y="8090" as="sourcePoint" />
            <mxPoint x="11395" y="8229" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12130" y="8255" />
              <mxPoint x="12130" y="8530" />
              <mxPoint x="11660" y="8530" />
              <mxPoint x="11660" y="8659" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-38" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="9570" y="9560" width="570" height="930" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-39" value="&lt;b&gt;_ConstructSpecificAddressArea(Mmu, PageCount, gceAREA_TYPE Type, Address, *Area, *Index)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-40" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-41" value="&lt;div&gt;/*&amp;nbsp; */&lt;/div&gt;&lt;div&gt;startAddr = gcmkALIGN_BASE(Address, 0x4000_0000);&lt;br&gt;totalSize&amp;nbsp; = PageCount &amp;lt;&amp;lt; gcmkMMU_GET_PTE_SHIFT(Type);&lt;br&gt;endAddr&amp;nbsp; = gcmALIGN(Address + totalSize, 0x4000_0000);&lt;br&gt;totalSize&amp;nbsp; = gcmALIGN(endAddr - startAddr, 0x4000_0000);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pudEntries = totalSize &amp;gt;&amp;gt; gcdMMU_PUD_SHIFT);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="60" width="570" height="120" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-42" value="if(!startAddr) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_GetPudFreeSpace&lt;/b&gt;(Mmu, pudEntries, &amp;amp;pudStart, &amp;amp;pudEnd);&lt;/div&gt;&lt;div&gt;}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="180" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-8" value="&lt;div&gt;else {&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="240" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-11" value="&lt;b&gt;gckOS_Allocate&lt;/b&gt;(os, gcmSIZEOF(gcsADDRESS_AREA), &amp;amp;area);&lt;br&gt;&lt;b&gt;gckOS_ZeroMemory&lt;/b&gt;(area, gcmSIZEOF(gcsADDRESS_AREA);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="300" width="570" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-10" value="area-&amp;gt;pgdStart&amp;nbsp; &amp;nbsp; &amp;nbsp;= pudStart &amp;gt;&amp;gt; gcdMMU_PUD_BITS;&lt;br&gt;area-&amp;gt;pgdEnd&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= pudEnd&amp;nbsp; &amp;gt;&amp;gt; gcdMMU_PUD_BITS;&lt;br&gt;area-&amp;gt;pudStart&amp;nbsp; &amp;nbsp; &amp;nbsp;= pudStart;&lt;div&gt;area-&amp;gt;pudEnd&amp;nbsp; &amp;nbsp; &amp;nbsp; = pudEnd;&lt;/div&gt;&lt;div&gt;area-&amp;gt;pudEntries = pudEntries;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="350" width="570" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-9" value="if (Type != gcvAREA_TYPE_2M) {&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pmdEntries = area-&amp;gt;pudEntries * gcdMMU_PMD_ENTRY_NUM;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pmdSize&amp;nbsp; &amp;nbsp; &amp;nbsp;= area-&amp;gt;pmdEntries &amp;lt;&amp;lt; 3;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pteEntries&amp;nbsp; &amp;nbsp;= area-&amp;gt;pmdEntries * gcmkMMU_GET_ENTRY_NUM(Type);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pteSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= area-&amp;gt;pteEntries &amp;lt;&amp;lt; 3;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pmdEntries = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pmdSize&amp;nbsp; &amp;nbsp; &amp;nbsp;= 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pteEntries&amp;nbsp; &amp;nbsp;= area-&amp;gt;pudEntries * gcmkMMU_GET_ENTRY_NUM(Type);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area-&amp;gt;pteSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= area-&amp;gt;pteEntries &amp;lt;&amp;lt; 3;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;area-&amp;gt;mapSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 2 * area-&amp;gt;pteSize;&lt;/div&gt;&lt;div&gt;area-&amp;gt;baseAddress = (area-&amp;gt;pgdStart &amp;lt;&amp;lt; gcdMMU_PGD_SHIFT)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; | (area-&amp;gt;pudStart % gcdMMU_PUD_ENTRY_NUM) &amp;lt;&amp;lt; gcdMMU_PUD_SHIFT);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;area-&amp;gt;vaSize&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= pudEntries * (1 &amp;lt;&amp;lt; gcdMMU_PUD_SHIFT);&lt;/div&gt;&lt;div&gt;area-&amp;gt;areaType&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Type;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="440" width="570" height="260" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-34" value="&lt;b&gt;gckOS_Allocate&lt;/b&gt;(os, area-&amp;gt;mapSize, &amp;amp;area-&amp;gt;mapLogical);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="700" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-35" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_ConstructDynamicPmdPte&lt;/b&gt;(Mmu, area);&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="730" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-36" value="/* 初始化 */&lt;div&gt;map = area-&amp;gt;mapLogical;&lt;/div&gt;&lt;div&gt;map[0] = (area-&amp;gt;pteEntries &amp;lt;&amp;lt; 8) | gcvMMU_FREE;&lt;/div&gt;&lt;div&gt;map[1] = ~0ULL;&lt;/div&gt;&lt;div&gt;area-&amp;gt;heapList = 0;&lt;/div&gt;&lt;div&gt;area-&amp;gt;freeNodes = gcvFALSE;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="760" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-59" value="&lt;b&gt;_SearchAvailableMapArea&lt;/b&gt;(area, PageCount, Index);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="860" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-43" value="if (Area)&lt;div&gt;&amp;nbsp; &amp;nbsp; *Area = area;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="0Et7W-5WGeGeLLH6OweF-38" vertex="1">
          <mxGeometry y="890" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0Et7W-5WGeGeLLH6OweF-45" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.128;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-26" target="0Et7W-5WGeGeLLH6OweF-39" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="12085" y="8265" as="sourcePoint" />
            <mxPoint x="12100" y="8619" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12090" y="8300" />
              <mxPoint x="12090" y="8510" />
              <mxPoint x="9610" y="8510" />
              <mxPoint x="9520" y="9599" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-1" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12650" y="8620" width="690" height="1040" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-2" value="&lt;b style=&quot;color: rgb(0, 0, 0);&quot;&gt;gckMMU_SetPage&lt;/b&gt;&lt;b&gt;(Mmu, PageAddress,&amp;nbsp; PageEntry,&amp;nbsp; EntryFlag)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-4" value="&lt;div&gt;gcsMMU_ENTRY_FLAG *entryFlag = EntryFlag;&lt;br&gt;&lt;br&gt;entry = _ReadPageEntry(PageEntry);&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* *(gctUINT64_PTR)(pageEntry) */&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="60" width="690" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-8" value="&lt;div&gt;if (!entryFlag-&amp;gt;attrChangeOnly) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; tileResource = entry &amp;amp; (1 &amp;lt;&amp;lt; gcdMMU_PTFLAG_TILEDRESOURCE);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; entry = 0; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* empty entry */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* For tile resource init, skip check offset. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!(PageAddress &amp;amp; (1 &amp;lt;&amp;lt; gcdMMU_PTFLAG_TILEDRESOURCE))) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (entryFlag-&amp;gt;pageType == gcvPAGE_TYPE_2M)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; VERIFY(!(PageAddress &amp;amp; 0x1FFFFF));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; VERIFY(!(PageAddress &amp;amp; 0xFFF));&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; entry = PageAddress;&lt;/div&gt;&lt;div&gt;}&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;if (!(entry &amp;gt;&amp;gt; 7) { return gcvSTATUS_INVALID_ARGUMENT; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="120" width="690" height="230" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-1" value="&lt;div&gt;if (entryFlag-&amp;gt;writable) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_WRITEABLE, 1);&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_WRITEABLE, 0);&lt;/div&gt;&lt;div&gt;#if gcdUSE_MMU_EXCEPTION&lt;br&gt;&amp;nbsp; &amp;nbsp; /* 如果当前page是只读, 设置exception 可以让write该page时产生exception */&lt;br&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_EXCEPTION, 1);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="350" width="690" height="150" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-7" value="&lt;div&gt;if (entryFlag-&amp;gt;pageFault) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_PAGEFAULT, 1);&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_EXCEPTION, 1);&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_PRESENT, 1);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="500" width="690" height="100" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-2" value="&lt;div&gt;#if gcdENABLE_HMM&lt;/div&gt;&lt;div&gt;if (entryFlag-&amp;gt;writable) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 204, 255); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_FROMHOST, 1)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_FROMHOST, 0);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="600" width="690" height="110" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-4" value="&lt;div&gt;if (PageAddress &amp;gt;&amp;gt; 7) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* If PageAddress is a real physical address */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (tileResource)&amp;nbsp; {&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_UNMAPPED, 0);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* If PageAddress only has tile resource flag */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_PRESENT, 0);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="710" width="690" height="140" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-3" value="&lt;div&gt;if (entryFlag-&amp;gt;pageType == gcvPAGE_TYPE_2M) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置2M Flag */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_PAGESIZE, 2);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="850" width="690" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-6" value="&lt;div&gt;if (entryFlag-&amp;gt;invalid) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_PRESENT, 0);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkMMU_SET_ENTRY(entry, gcdMMU_PTFLAG_EXCEPTION, 1);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="940" width="690" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-5" value="&lt;b&gt;_WritePageEntry&lt;/b&gt;(PageEntry, entry);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="yIgph9W-r4GcEzQpdnRG-1" vertex="1">
          <mxGeometry y="1010" width="690" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yIgph9W-r4GcEzQpdnRG-6" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-16" target="yIgph9W-r4GcEzQpdnRG-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="13520" y="8270" as="sourcePoint" />
            <mxPoint x="12790" y="7749" as="targetPoint" />
            <Array as="points">
              <mxPoint x="12610" y="8180" />
              <mxPoint x="12610" y="8659" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-12" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10450" y="8980" width="490" height="440" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-13" value="&lt;b&gt;_GetPudFreeSpace(Mmu, NumEntries, *PudStart，*PudEnd)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-14" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-15" value="&lt;div&gt;gcsFreeSpaceNode_PTR nodeArray = gcvNULL;&lt;/div&gt;&lt;div&gt;numEntries = gcdMMU_PUD_ENTRY_NUM * gcdMMU_PGD_ENTRY_NUM;&lt;/div&gt;&lt;div&gt;pudGlobalStart = -1;&lt;/div&gt;&lt;div&gt;pudGlobalEnd&amp;nbsp; = -1;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="60" width="490" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-16" value="&lt;div&gt;&lt;b&gt;_CollectFreeSpace&lt;/b&gt;(Mmu, Mmu-&amp;gt;pudLogical, &amp;amp;nodeArray, &amp;amp;nodeArraySize);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="130" width="490" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-17" value="&lt;div&gt;for (i = 0; i &amp;lt; nodeArraySize; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if(nodeArray[i].entries &amp;lt;= numEntries &amp;amp;&amp;amp; NumEntries &amp;lt;= nodeArray[i].entries) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; numEntries = nodeArray[i].entries;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pudGlobalEnd&amp;nbsp; = nodeArrary[i].start + nodeArrary[i].entries - 1;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pudGlobalStart = pudGlobalEnd - NumEntries + 1;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="160" width="490" height="130" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-18" value="if (pudGlobalStart == -1 &amp;amp;&amp;amp; pudGlobalEnd == -1)&lt;div&gt;&amp;nbsp; &amp;nbsp; gcmkONERROR(gcvSTATUS_OUT_OF_MEMORY);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="290" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-19" value="*PudStart = pudGlobalStart;&lt;div&gt;*PudEnd&amp;nbsp; = pudGlobalEnd;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="330" width="490" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-20" value="if (nodeArrary)&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_Free&lt;/b&gt;(os, nodeArrary);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-12" vertex="1">
          <mxGeometry y="390" width="490" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-22" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="0Et7W-5WGeGeLLH6OweF-42" target="QNYcLvJolFkXC-7qqJEz-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10450" y="9650" as="sourcePoint" />
            <mxPoint x="10370" y="9520" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-23" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11120" y="8820" width="570" height="590" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-24" value="&lt;b&gt;_CollectFreeSpace(Mmu, gctUINT64 *Logical, gcsFreeSpaceNode_PTR *Array, gctINT *Size)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-25" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-26" value="&lt;div&gt;gcsFreeSpaceNode_PTR arrary = gcvNULL;&lt;/div&gt;&lt;div&gt;gcsFreeSpaceNode_PTR node&amp;nbsp; = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="60" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-27" value="for (i = 0; i &amp;lt; gcdMMU_PUD_ENTRY_NUM * gcsMMU_PGD_ENTRY_NUM; i ++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Logical[i]&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;== 0x2) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!node) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* free space 的第一个entry */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node += 1;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; size++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (node) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 重置起始 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="100" width="570" height="190" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-28" value="&lt;div&gt;gcsOS_Allocate(os, gcmSIZEOF(*arrary) * size, &amp;amp;pointer);&lt;/div&gt;&lt;div&gt;array = pointer;&lt;/div&gt;&lt;div&gt;node = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="290" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-29" value="for (i = 0; size = 0; i &amp;lt; gcdMMU_PUD_ENTRY_NUM * gcsMMU_PGD_ENTRY_NUM; i ++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Logical[i]&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;== 0x2) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!node) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* 第一个node */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = &amp;amp;array[size++];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;start = i;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;entries = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;entries++;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; } else if (node) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(153, 255, 255);&quot;&gt;/* 重置起始 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="350" width="570" height="200" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-30" value="*Array = array;&lt;div&gt;*Size&amp;nbsp; = size;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-23" vertex="1">
          <mxGeometry y="550" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-33" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-16" target="QNYcLvJolFkXC-7qqJEz-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11070" y="9620" as="sourcePoint" />
            <mxPoint x="11120" y="9570" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-38" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10450" y="9520" width="660" height="1550" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-39" value="&lt;b&gt;_ConstructDynamicPmdPte(Mmu, NumEntries, *PudStart，*PudEnd)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="26" width="660" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-40" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="52" width="660" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-41" value="kernel&amp;nbsp; &amp;nbsp; &amp;nbsp; = Mmu-&amp;gt;hardware-&amp;gt;kernel;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocFlag = gcvALLOC_FLAG_CONTIGUOUS;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Mmu-&amp;gt;pool;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="60" width="660" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-43" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 2M dynamic area do not have PMD */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 创建 PMD table */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if(Area-&amp;gt;pmdSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_AllocateVideoMemory&lt;/b&gt;(kernel,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 0x1000,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvVIDMEM_TYPE_COMMAND,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; allocFlag | gcvALLOC_FLAG_4K_PAGES,&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 0, &amp;amp;Area-&amp;gt;pmdSize, &amp;amp;pool, &amp;amp;Area-&amp;gt;pmdVideoMem);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_LockCPU&lt;/b&gt;(kernel,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Area-&amp;gt;pmdVideoMem,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvFALSE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvFALSE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;Area-&amp;gt;pmdLogical);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if gcdUSE_MMU_EXCEPTION&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_FillPageTable&lt;/b&gt;(Area-&amp;gt;pmdLogical, Area-&amp;gt;pmdEntries, 1&amp;lt;&amp;lt;1);&lt;/span&gt; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 开启exception, 默认值为0x2 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_ZeroMemory&lt;/b&gt;(Area-&amp;gt;pmdLogical, Area-&amp;gt;pmdSize); &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Invalidate 所有的entries */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="120" width="660" height="320" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-44" value="&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 创建 PTE 表 */&lt;/span&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_AllocateVideoMemory&lt;/b&gt;(kernel,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 0x1000,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvVIDMEM_TYPE_COMMAND,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; allocFlag | gcvALLOC_FLAG_4K_PAGES,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;Area-&amp;gt;pteSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;pool,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;Area-&amp;gt;pteVideoMem);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_NODE_LockCPU&lt;/b&gt;(kernel,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Area-&amp;gt;pteVideoMem,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvFALSE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvFALSE,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;Area-&amp;gt;pteLogical);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#if gcdUSE_MMU_EXCEPTION&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;_FillPageTable&lt;/b&gt;(Area-&amp;gt;pteLogical, Area-&amp;gt;pteEntries, 1&amp;lt;&amp;lt;1);&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 开启exception, 默认值为0x2 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;gckOS_ZeroMemory&lt;/b&gt;(Area-&amp;gt;pteLogical, Area-&amp;gt;pteSize); &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Invalidate 所有的entries */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="440" width="660" height="340" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-45" value="offset = 0;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 使用PMD physical 填充 PUD (或者 2M页表的情况下使用 PTE physical */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;for (i = Area-&amp;gt;pudStart; i &amp;lt; Area-&amp;gt;pudStart + Area-&amp;gt;pudEntries; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Area-&amp;gt;pmdSize) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 获取pmd table physical */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetGPUPhysical&lt;/b&gt;(kernel, Area-&amp;gt;pmdVideoMem, offset, &amp;amp;address);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;gckVIDMEM_NODE_GetGPUPhysical&lt;/b&gt;(kernel, Area-&amp;gt;pteVideoMem, offset, &amp;amp;address);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pudEntry = address&amp;nbsp;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;| (0 &amp;lt;&amp;lt; 1)&lt;/span&gt;&amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 忽略exception */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;| (1 &amp;lt;&amp;lt; 0);&lt;/span&gt; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Present */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Area-&amp;gt;pmdSize)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += gcdMMU_PMD_SIZE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += gcdMMU_PTE_2M_SIZE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_WritePageEntry&lt;/b&gt;(Mmu-&amp;gt;pudLogical + i, pudEntry);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="780" width="660" height="320" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-46" value="if (Area-&amp;gt;pmdSize) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置page size 的flag */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 由于2M page size 没有PMD, 所以 2M Page Size flag 会写到PTE entry */&lt;/span&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pageSize = Area-&amp;gt;areaType == gcvAREA_TYPE_64K ? 1 : 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; offset = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 使用PTE physical 填入PMD table */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; Area-&amp;gt;pmdEntries; i++) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Reserve 0~16M, not present */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if ((Area-&amp;gt;areaType == gcvAREA_TYPE_LOW_4K) &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;&amp;amp; ( i &amp;lt; (gcdVA_RESERVED_SIZE &amp;gt;&amp;gt; gcdMMU_PMD_SHIFT)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pmdEntry = (1&amp;lt;&amp;lt;2);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 使用PTE physical 填充 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckVIDMEM_NODE_GetGPUPhysical&lt;/b&gt;(kernel, Area-&amp;gt;pteVideoMem, offset, &amp;amp;address);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pmdEntry = address&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;| (pageSize &amp;lt;&amp;lt; 2)&lt;/span&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置page大小 */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;| (0 &amp;lt;&amp;lt; 1)&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 忽略exception */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;| (1 &amp;lt;&amp;lt; 0);&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Present */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Area-&amp;gt;areaType == gcvAREA_TYPE_64K)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += gcdMMU_PTE_64K_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += gcdMMU_PTE_4K_SIZE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;_WritePageEntry&lt;/b&gt;(Area-&amp;gt;pmdLogical + i, pmdEntry);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-38" vertex="1">
          <mxGeometry y="1100" width="660" height="450" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-47" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-35" target="QNYcLvJolFkXC-7qqJEz-39" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10250" y="9010" as="sourcePoint" />
            <mxPoint x="10460" y="9009" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-48" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11300" y="9840" width="490" height="120" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-49" value="&lt;b&gt;_FillPageTable(gctUINT64_PTR PageTable, PageCount, EntryValue)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-48" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-50" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-48" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-51" value="&lt;div&gt;for (i = 0; i &amp;lt; PageCount; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; _WritePageEntry(PageTable + i, EntryValue);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-48" vertex="1">
          <mxGeometry y="60" width="490" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-57" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-44" target="QNYcLvJolFkXC-7qqJEz-49" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11100" y="10036" as="sourcePoint" />
            <mxPoint x="11270" y="10030" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-58" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-43" target="QNYcLvJolFkXC-7qqJEz-49" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10990" y="10140" as="sourcePoint" />
            <mxPoint x="11130" y="10050" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-60" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="10450" y="11170" width="490" height="690" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-61" value="&lt;b&gt;_SearchAvailableMapArea(Area, PageCount, *Index)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-62" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-63" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 搜索可用的area */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;for (map = area-&amp;gt;mapLogical, gotIt = gcvFALSE; !gotIt;) {&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="60" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-64" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; index = area-&amp;gt;heapList;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 遍历 heap list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for (; !gotIt &amp;amp;&amp;amp; (index &amp;lt; area-&amp;gt;pteEntries);) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 检查node type*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; switch(gcmENTRY_TYPE(map[index]) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case &lt;b&gt;gcvMMU_SINGLE&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果我们只需要1个page, Single node 是valid */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (PageCount == 1) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gotIt = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 切换到下一个节点 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = index;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index = map[index] &amp;gt;&amp;gt; 8;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case &lt;b&gt;gcvMMU_FREE&lt;/b&gt;:&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 测试node 是否有足够的空间 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (PageCount &amp;lt;= (map[index] &amp;gt;&amp;gt; 8)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gotIt = gcvTRUE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;/* 切换到下一个节点 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = index;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index = map[index + 1];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="100" width="490" height="390" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-65" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 测试是否 out of memory */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (index &amp;gt;= area-&amp;gt;pteEntries) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (area-&amp;gt;freeNodes) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Trash??? */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;status = &lt;b&gt;_Collect&lt;/b&gt;(area);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (gcmIS_ERROR(status)) return status;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Out of resource */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return gcvSTATUS_OUT_OF_RESOURCES;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="490" width="490" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-68" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-60" vertex="1">
          <mxGeometry y="660" width="490" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-69" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-59" target="QNYcLvJolFkXC-7qqJEz-61" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="9920" y="10901" as="sourcePoint" />
            <mxPoint x="10110" y="10650" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-70" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11050" y="11700" width="490" height="700" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-71" value="&lt;b&gt;_Collect(gcsADDRESS_AREA_PTR Area)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-70" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-72" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-70" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-73" value="&lt;div&gt;gctUINT64_PTR map = Area-&amp;gt;mapLogical;&lt;/div&gt;&lt;div&gt;previous = ~0U;&lt;/div&gt;&lt;div&gt;Area-&amp;gt;heapList&amp;nbsp; &amp;nbsp; = ~0U;&lt;/div&gt;&lt;div&gt;Area-&amp;gt;freeNodes = gcvFALSE;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-70" vertex="1">
          <mxGeometry y="60" width="490" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-76" value="&lt;div&gt;for (i = 0; i &amp;lt; Area-&amp;gt;pteEntries; ++i) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch (gcmENTRY_TYPE(map[i])) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case &lt;b&gt;gcvMMU_USED&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 遇到一个使用过的page, 把之前非使用过的添加了 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_AddFree&lt;/b&gt;(Area, previous, start, count);&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Reset node */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = start;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; count&amp;nbsp; &amp;nbsp; &amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case &lt;b&gt;gcvMMU_SINGLE&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Single free node */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (count ++ == 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置新的起始点 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; start&amp;nbsp; = i;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case &lt;b&gt;gcvMMU_FREE&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if( count == 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置芯的起始点 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; start = i;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 添加map info中的entry count */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; count += map[i] &amp;gt;&amp;gt; 8;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 跳到之后的entries */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; i += (map[i] &amp;gt;&amp;gt; 8) - 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return &lt;b&gt;gcvSTATUS_HEAP_CORRUPTED&lt;/b&gt;; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* MMU page table corrupted */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-70" vertex="1">
          <mxGeometry y="130" width="490" height="480" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-75" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果还有每天就的, 完成添加 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (count &amp;gt; 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 添加node到list中 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_AddFree&lt;/b&gt;(Area, previous, start, count);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-70" vertex="1">
          <mxGeometry y="610" width="490" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-74" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-65" target="QNYcLvJolFkXC-7qqJEz-71" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11120" y="12041" as="sourcePoint" />
            <mxPoint x="11310" y="11790" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-77" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="11620" y="12030" width="490" height="250" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-78" value="&lt;b&gt;_AddFree(gcsADDRESS_AREA_PTR Area, Index, Node, Count)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-77" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-79" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-77" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-80" value="&lt;div&gt;gctUINT64_PTR map = Area-&amp;gt;mapLogical;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Count == 1) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 初始化一个 single page node */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; map[Node] = ~((1ULL &amp;lt;&amp;lt; 8) - 1) | gcvMMU_SINGLE;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /* 初始化 node */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; map[Node + 0] = (Count &amp;lt;&amp;lt; 8) | gcvMMU_FREE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; map[Node + 1] = ~0ULL;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_Link&lt;/b&gt;(Area, Index, Node);&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-77" vertex="1">
          <mxGeometry y="60" width="490" height="190" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-83" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-76" target="QNYcLvJolFkXC-7qqJEz-78" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10950" y="11755" as="sourcePoint" />
            <mxPoint x="11060" y="11749" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-84" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="12230" y="12070" width="490" height="350" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-85" value="&lt;b&gt;_Link(gcsADDRESS_AREA_PTR Area, Index, Next)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" parent="QNYcLvJolFkXC-7qqJEz-84" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-86" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-84" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-87" value="&lt;div&gt;if (Index &amp;gt;= Area-&amp;gt;pteEntries) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; /*&amp;nbsp; */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Area-&amp;gt;heapList = Next;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 找到page table */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; map = Area-&amp;gt;mapLogical;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch(gcmENTRY_TYPE(map[Index])) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case gcvMMU_SINGLE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置单index */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; map[Index] = (Next &amp;lt;&amp;lt; 8) | gcvMMU_SINGLE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case gcvMMU_FREE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置 index */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; map[Index + 1] = Next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return &lt;b&gt;gcvSTATUS_HEAP_CORRUPTED&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="QNYcLvJolFkXC-7qqJEz-84" vertex="1">
          <mxGeometry y="60" width="490" height="290" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-88" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-80" target="QNYcLvJolFkXC-7qqJEz-85" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="11550" y="12080" as="sourcePoint" />
            <mxPoint x="11630" y="12079" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-90" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1400" y="6200" width="680" height="1130" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-91" value="&lt;b&gt;gckVIDMEM_LockVirtual(Kernel, gcuVIDMEM_NODE_PTR Node, *Address)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="26" width="680" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-92" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="52" width="680" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-96" value="if (Kernel-&amp;gt;processPageTable) index = 0;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_GetCurrentMMU&lt;/b&gt;(Kernel, Node-&amp;gt;VidMem.fromUser, 0, &amp;amp;mmu));&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_GetOffset&lt;/b&gt;(Kernel, Node, &amp;amp;offset);&lt;br&gt;&lt;b&gt;gckOS_GetPhysicalFromHandle&lt;/b&gt;(os, memoryHandle, offset, &amp;amp;physicalAddress);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="60" width="680" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-93" value="if (!Kernel-&amp;gt;hardware-&amp;gt;options.enableMMU) {&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;if (Kernel-&amp;gt;processPageTable) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gcmkLIST_FOR_EACH&lt;/b&gt;(pos, &amp;amp;mmu-&amp;gt;nodeList) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node = gcmCONTAINEROF(pos, struct _gcsVIDMEM_NODE_VIDMEM, lockLink);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.id == Node-&amp;gt;VidMem.id) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lockCount = node-&amp;gt;VidMem.lockeds[index]++;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.addresses[index] = node-&amp;gt;VidMem.addresses[index];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;} else { lockCount = Node-&amp;gt;VidMem.lockeds[index]++;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="150" width="680" height="200" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-97" value="&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (!lockCount) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gcsMMU_ENTRY_FLAG &lt;/b&gt;entryFlag = {0};&lt;br&gt;&amp;nbsp; &amp;nbsp; locked = gcvTRUE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_ConvertPhysical&lt;/b&gt;(Kernel, mmu, Node, gcvNULL, physicalAddress, &amp;amp;Node-&amp;gt;VidMem.addresses[index]);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if(&lt;b&gt;gcmIS_ERROR&lt;/b&gt;(status)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!Node-&amp;gt;VidMem.uvm) {&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageCount = Node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType ?&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.bufferBytes &amp;gt;&amp;gt; 12 : Node-&amp;gt;VidMem.pageCount;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_AllocatePageEx&lt;/b&gt;(mmu,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pageCount,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.type,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvPAGE_TYPE_4K,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.lowVA,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.secure,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;&amp;amp;Node-&amp;gt;VidMem.pageTables[index]&lt;/span&gt;,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;&amp;amp;Node-&amp;gt;VidMem.addresses[index]&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } /*!uvm*/&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="350" width="680" height="290" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-4" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.exception = gcvTRUE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.lowVA&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.lowVA;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.pageFault = Node-&amp;gt;VidMem.onFault;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.writable&amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.pageType&amp;nbsp; = gcvPAGE_TYPE_4K;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; entryFlag.node = Node;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_MapDeviceMemory&lt;/b&gt;(os, Kernel, mmu, Node, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.addresses[index],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Node-&amp;gt;VidMem.bufferBytes / gcd4K_PAGE_SIZE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;entryFlag);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_MapPageEx&lt;/b&gt;(os, Kernel, mmu, memoryHandle,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.pageCount,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.addresses[index];&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.pageTables[index];&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;entryFalg);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="640" width="680" height="320" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-5" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_Flush&lt;/b&gt;(mmu, Node-&amp;gt;VidMem.type);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* 当前 GPU MMU page size 固定为4096*/&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.addresses[Index] |= physicalAddress &amp;amp; (4096 - 1);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } /* status*/&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="960" width="680" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-94" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;processPageTable &amp;amp;&amp;amp; Node)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckMMU_AttachNode&lt;/b&gt;(mmu, Node);&lt;/div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;}&amp;nbsp; &amp;nbsp;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="1040" width="680" height="60" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-6" value="*Address = Node-&amp;gt;VidMem.addresses[index];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-90" vertex="1">
          <mxGeometry y="1100" width="680" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-95" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="5UoCWkmYeCmagEpiS34q-7" target="QNYcLvJolFkXC-7qqJEz-91" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2800" y="5045" as="sourcePoint" />
            <mxPoint x="2950" y="4609" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1240" y="5035" />
              <mxPoint x="1240" y="6239" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-98" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2280" y="6190" width="740" height="330" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-99" value="&lt;b&gt;gckVIDMEM_Lock(Kernel, gcuVIDMEM_NODE_PTR Node, *Address)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QNYcLvJolFkXC-7qqJEz-98" vertex="1">
          <mxGeometry y="26" width="740" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-100" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-98" vertex="1">
          <mxGeometry y="52" width="740" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-101" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (Node-&amp;gt;VidMem.locked++ ==0) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; address;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; offset = Node-&amp;gt;VidMem.offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; switch(Node-&amp;gt;VidMem.pool) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXCLUSIVE: address = Kernel-&amp;gt;exclusiveBaseAddress + offset; ...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXTERNAL :&amp;nbsp; address = Kernel-&amp;gt;externalBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp; address&amp;nbsp; = Kernel-&amp;gt;internalBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; address = Kernel-&amp;gt;extSRAMBaseAddresses[Kernel-&amp;gt;device-&amp;gt;extSRAMIndex] + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; address = Kernel-&amp;gt;lowContiguousBaseAddress + offset;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; default:&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Node-&amp;gt;VidMem.pool == gcvPOOL_SYSTEM; FALLTHRU;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM: address = Kernel-&amp;gt;contiguousBaseAddress[Kernel-&amp;gt;device-&amp;gt;memIndex] + offset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Node-&amp;gt;VidMem.address = address;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-98" vertex="1">
          <mxGeometry y="60" width="740" height="240" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-102" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;*Address = Node-&amp;gt;VidMem.address;&lt;/b&gt;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-98" vertex="1">
          <mxGeometry y="300" width="740" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-103" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-93" target="QNYcLvJolFkXC-7qqJEz-99" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2800" y="5099" as="sourcePoint" />
            <mxPoint x="2950" y="5099" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2130" y="6450" />
              <mxPoint x="2230" y="6229" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-105" value="gc_hal_kernel_mmu_v2.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="220" y="6650" width="740" height="1970" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-106" value="&lt;b&gt;gckMMU_AllocatePagesEx(Mmu, PageCount, Type, PageType, LowVA, Secure, *PageTable, *Address)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="26" width="740" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-107" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="52" width="740" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-112" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gcsADDRESS_AREA_PTR area = Mmu-&amp;gt;dynamicAreaList;&lt;/span&gt;&lt;div&gt;gceAREA_TYPE areaType&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = &lt;b&gt;gcmkMMU_GET_AREA_TYPE&lt;/b&gt;(PageType);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="60" width="740" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-108" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;if (LowVA &amp;amp;&amp;amp; Mmu-&amp;gt;hardware-&amp;gt;kernel-&amp;gt;reserve32bitVA) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; area = &amp;amp;Mmu-&amp;gt;dynamicLowArea4K;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; while(area) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (area-&amp;gt;areaType == areaType) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_SearchAvailableMapArea&lt;/b&gt;(area, pageCount, &amp;amp;index);&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (status == gcvSTATUS_OK) break;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; area = area-&amp;gt;next;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="100" width="740" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-113" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (!area) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; if(LowVA &amp;amp; Mmu-&amp;gt;hardware-&amp;gt;kernel-&amp;gt;reserve32bitVA) ONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_ConstructAddressArea&lt;/b&gt;(Mmu, PageCount, areaType, &amp;amp;newArea, &amp;amp;index);&lt;/span&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Mmu-&amp;gt;dynamicAreaList == gcvNULL) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Mmu-&amp;gt;dynamicAreaList = newArea;&lt;br&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; newArea-&amp;gt;next = Mmu-&amp;gt;dynamicAreaList;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Mmu-&amp;gt;dynamicAreaList = newArea;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; gotArea = newArea;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; gotArea = area;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="270" width="740" height="230" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-114" value="&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 转换到page table */&lt;/span&gt;&lt;div&gt;for (map = gotArea-&amp;gt;mapLogical, gotIt = gcvFALSE; !gotIt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; index = gotArea-&amp;gt;heapList;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 遍历 heap list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for(; !gotIt &amp;amp;&amp;amp; (index &amp;lt; gotArea-&amp;gt;pteEntries);) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* Check the node type */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; switch(&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gcmENTRY_TYPE(map[index])&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case gcvMMU_SINGLE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果我们只需要一个pageCount, 当前map 又是single, 满足要求 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (pageCount == 1) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gotIt = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 切到下一个node */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = index;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index&amp;nbsp; &amp;nbsp; &amp;nbsp; = map[index] &amp;gt;&amp;gt; 8;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case gcvMMU_FREE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 当前节点是否有足够的空间 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (pageCount &amp;lt;= map[index] &amp;gt;&amp;gt; 8) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gotIt = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 切到下一个node */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = index;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index = map[index + 1];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; default: ONERROR(gcvSTATUS_OUT_OF_RESOURCES);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="500" width="740" height="470" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-3" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;pgd = gotArea-&amp;gt;pgdStart;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;pud = gotArea-&amp;gt;pudStart % gcdMMU_PUD_ENTRY_NUM;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;if (areaType != gcvAREA_TYPE_2M)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; pmd = index / gcmkMMU_GET_ENTRY_NUM(areaType);&lt;br&gt;pte = index % gcmkMMU_GET_ENTRY_NUM(areaType);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 建立虚拟地址 */&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;address = (pgd &amp;lt;&amp;lt; gcdMMU_PGD_SHIFT) |&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(pud &amp;lt;&amp;lt; gcdMMU_PUD_SHIFT) |&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(pmd &amp;lt;&amp;lt; gcdMMU_PMD_SHIFT) |&lt;/span&gt; /*&amp;nbsp; */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(pte&amp;nbsp; &amp;lt;&amp;lt; gcmkMMU_GET_PTE_SHIFT(areaType));&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Address != gcvNULL)&lt;br&gt;&amp;nbsp; &amp;nbsp; *Address = address;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="970" width="740" height="220" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-1" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 在node的开始记录所有分配的pageCount */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (pageCount == 1)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; map[index] = ~&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(1ULL&amp;lt;&amp;lt;8) -1) | gcvMMU_USED;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;map[index] = ((pageCount&amp;lt;&amp;lt;8) -1) | gcvMMU_USED;&lt;br&gt;&lt;br&gt;if( gotArea-&amp;gt;pteLogical != gcvNULL) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;*PageTable = &amp;amp;gotArea-&amp;gt;pteLogical[index];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;*PageTable = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="1190" width="740" height="170" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-2" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 设置node为used */&lt;/span&gt;&lt;/div&gt;&lt;b&gt;_FillMap&lt;/b&gt;(&amp;amp;map[index], pageCount, gcvMMU_USED);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="1360" width="740" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-115" value="&lt;div&gt;switch(gcmENTRY_TYPE(map[index])) {&lt;/div&gt;&lt;div&gt;case gcvMMU_SINGLE:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 从free list 取出 single node */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;_Link&lt;/b&gt;(gotArea, previous, map[index] &amp;gt;&amp;gt; 8);&lt;/div&gt;&lt;div&gt;break;&lt;/div&gt;&lt;div&gt;case gcvMMU_FREE:&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 检查有多少剩余的pages */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; left = (map[index] &amp;gt;&amp;gt; 8) - pageCount;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; switch(left) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case 0:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 整个node都使用了 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_Link&lt;/b&gt;(gotArea, previous, map[index + 1]);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; case 1:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 剩下一个page, 转换node为single node, 并递增index */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; map[index] = map[index + 1] &amp;lt;&amp;lt; 8 | gcvMMU_SINGLE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 新node有足够多的pages, 尽管如此, 将调整当前节点的大小和index */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; map[index] = left&amp;lt;&amp;lt;8 | gcvMMU_FREE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; index += left;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;break;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="1410" width="740" height="400" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-109" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; /* 检查是否out of memory */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (index &amp;gt;= gotArea-&amp;gt;pteEntries) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (gotArea-&amp;gt;freeNodes) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_Collect&lt;/b&gt;(gotArea);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; previous = ~0U;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ONERROR(gcvSTATUS_OUT_OF_RESOURCE);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="QNYcLvJolFkXC-7qqJEz-105" vertex="1">
          <mxGeometry y="1810" width="740" height="160" as="geometry" />
        </mxCell>
        <mxCell id="QNYcLvJolFkXC-7qqJEz-110" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-97" target="QNYcLvJolFkXC-7qqJEz-106" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3630" y="5310" as="sourcePoint" />
            <mxPoint x="3740" y="5104" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-7" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2280" y="6640" width="650" height="1080" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-8" value="&lt;b&gt;gckOS_MapPageEx&lt;/b&gt;&lt;b&gt;(Os, Kernel, Mmu, Physical, Offset, PageCount, Address, PageTable, EntryFalg)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-9" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-10" value="PLINUX_MDL mdl;&lt;br&gt;gctUINT64&amp;nbsp; &amp;nbsp; &amp;nbsp;*table;&lt;div&gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Offset;&lt;/div&gt;&lt;div&gt;mmu&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Mmu;&lt;/div&gt;&lt;div&gt;gcuVIDMEM_NODE_PTR node = EntryFlag-&amp;gt;node;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdl&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= (PLINUX_MDL)Physical;&lt;/div&gt;&lt;div&gt;allocator = mdl-&amp;gt;allocator;&lt;br&gt;table&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= PageTable;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 获取所有物理地址并设置到page table, 此处的pageCount是GPU page count */&lt;/span&gt;&lt;br&gt;PageCount = PageCount / (PAGE_SIZE / 4096);&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = PageCount &amp;lt;&amp;lt; 3;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (node) {&lt;br&gt;&amp;nbsp; &amp;nbsp; while(node) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gctPHYS_ADDR_T phys = ~0ULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; phys = node-&amp;gt;VidMem.devicePool-&amp;gt;poolGPUPhys + node-&amp;gt;VidMem.offset;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; phys &amp;amp;= ~(4096ull -1); &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* remove LSB */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; (node-&amp;gt;VidMem.reservedBytes / 4096); i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;gckMMU_SetPage&lt;/b&gt;(mmu, phys + (i*4096), table++, entryFlag);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;node = node-&amp;gt;VidMem.nextReserved; /* 非deviceMemPool情况下, nextReserved 为Null吧*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; done = gcvTRUE;&lt;br&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; VERIFY(PageCount&amp;gt;0);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="60" width="650" height="420" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-18" value="&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 如果node 没有的情况, 非deviceMemPool */&lt;/span&gt;&lt;br&gt;while(!done &amp;amp;&amp;amp; PageCount-- &amp;gt; 0) {&lt;div&gt;&amp;nbsp; &amp;nbsp; gctPHYS_ADDR_T phys = ~0ULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;allocator-&amp;gt;ops-&amp;gt;Physical&lt;/b&gt;(allocator, mdl, offset, &amp;amp;phys);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_CPUPhysicalToGPUPhysical&lt;/b&gt;(Os, phys, &amp;amp;phys);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* remove LSB */&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; phys &amp;amp;= ~(4096ull - 1);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; (PAGE_SIZE / 4096); i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckMMU_SetPage&lt;/b&gt;(mmu, &lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;phys + (i * 4096),&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;table++,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;EntryFlag);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; offset += PAGE_SIZE;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="480" width="650" height="290" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-19" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 获取 area */&lt;/span&gt;&lt;/div&gt;if (Address &amp;lt; gcdLOW4K_RESERVE_SIZE) {&lt;div&gt;&amp;nbsp; &amp;nbsp; area = &amp;amp;mmu-&amp;gt;dynamicLowArea4K;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; area = mmu-&amp;gt;dynamicAreaList;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; while(area) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Address &amp;gt;= area-&amp;gt;baseAddress &amp;amp;&amp;amp; Address &amp;lt; area-&amp;gt;baseAddress + area-&amp;gt;vaSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; area = area-&amp;gt;next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;offset = (gctUINT8_PTR)PageTable - (gctUINT8_PTR)area-&amp;gt;pteLogical;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="770" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-20" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(Kernel, area-&amp;gt;pteVideoMem, offset, PageTable, bytes);&lt;br&gt;&lt;br&gt;&lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(Kernel, mmu-&amp;gt;pudVideoMem, 0, mmu-&amp;gt;pudLogical, mmu-&amp;gt;pudSize);&lt;br&gt;&lt;br&gt;&lt;b&gt;gckVIDMEM_NODE_CleanCache&lt;/b&gt;(Kernel, area-&amp;gt;pmdVideoMem, 0, area-&amp;gt;pmdLogical, area-&amp;gt;pmdSize);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-7" vertex="1">
          <mxGeometry y="970" width="650" height="110" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-11" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="7SPhKI4A4c1HaiVuhG3F-4" target="7SPhKI4A4c1HaiVuhG3F-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2580" y="5685" as="sourcePoint" />
            <mxPoint x="3020" y="5209" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2120" y="7000" />
              <mxPoint x="2230" y="6679" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-12" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2280" y="7850" width="650" height="290" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-13" value="&lt;b&gt;gckMMU_AttachNode&lt;/b&gt;&lt;b&gt;(Mmu, Node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="7SPhKI4A4c1HaiVuhG3F-12" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-14" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="7SPhKI4A4c1HaiVuhG3F-12" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-15" value="gcuVIDMEM_NODE_PTR node = gcvNULL;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_Allocate(Mmu-&amp;gt;os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_ZeroMemory(pointer, sizeof(gcuVIDMEM_NODE));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node = pointer&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.id = Node-&amp;gt;VidMem.id;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;index = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.lockeds[index]++;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.addresses[index]&amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.addresses[index];&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.pageTables[index] = Node-&amp;gt;VidMem.pageTables[index];&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-12" vertex="1">
          <mxGeometry y="60" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-21" value="gcsLIST_Add(&amp;amp;node-&amp;gt;VidMem.lockLink, &amp;amp;Mmu-&amp;gt;nodeList);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-12" vertex="1">
          <mxGeometry y="260" width="650" height="30" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-16" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="QNYcLvJolFkXC-7qqJEz-94" target="7SPhKI4A4c1HaiVuhG3F-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2580" y="5990" as="sourcePoint" />
            <mxPoint x="3020" y="7329" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2110" y="7270" />
              <mxPoint x="2230" y="7889" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-27" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3080" y="7220" width="650" height="290" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-28" value="&lt;b&gt;gckMMU_AttachNode&lt;/b&gt;&lt;b&gt;(Mmu, Node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="7SPhKI4A4c1HaiVuhG3F-27" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-29" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="7SPhKI4A4c1HaiVuhG3F-27" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-30" value="gcuVIDMEM_NODE_PTR node = gcvNULL;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_Allocate(Mmu-&amp;gt;os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_ZeroMemory(pointer, sizeof(gcuVIDMEM_NODE));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node = pointer&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.id = Node-&amp;gt;VidMem.id;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;index = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.lockeds[index]++;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.addresses[index]&amp;nbsp; &amp;nbsp;= Node-&amp;gt;VidMem.addresses[index];&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.pageTables[index] = Node-&amp;gt;VidMem.pageTables[index];&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-27" vertex="1">
          <mxGeometry y="60" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-31" value="gcsLIST_Add(&amp;amp;node-&amp;gt;VidMem.lockLink, &amp;amp;Mmu-&amp;gt;nodeList);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="7SPhKI4A4c1HaiVuhG3F-27" vertex="1">
          <mxGeometry y="260" width="650" height="30" as="geometry" />
        </mxCell>
        <mxCell id="7SPhKI4A4c1HaiVuhG3F-32" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="7SPhKI4A4c1HaiVuhG3F-18" target="7SPhKI4A4c1HaiVuhG3F-28" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3040" y="7350" as="sourcePoint" />
            <mxPoint x="2290" y="7899" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-1" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="14990" y="2550" width="390" height="220" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-2" value="&lt;b&gt;allocHostMemory(gpgpuDevice *device, queryMemoryInfo info)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-1">
          <mxGeometry y="26" width="390" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-1">
          <mxGeometry y="52" width="390" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-4" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;info-&amp;gt;poolType = POOL_VIRTUAL;&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (!devInfo-&amp;gt;fullVA64)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; info-&amp;gt;force32Bit = 1;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;allocHostPinnedMemory&lt;/b&gt;(device-&amp;gt;processor, node, info);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-1">
          <mxGeometry y="60" width="390" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-6" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="14990" y="2870" width="700" height="260" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-7" value="&lt;b&gt;allocHostPinnedMemory(gpgpuDevice *device, queryMemoryInfo info)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-6">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-8" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-6">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-9" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;#if !gcdENABLE_HMM&lt;br&gt;&amp;nbsp; &amp;nbsp; return allocMemory(processor, node, info);&lt;br&gt;#else&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; void* hostPtr = nullptr;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; registerHostMemoryInfo_t regisInfo = {0};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; regisInfo.size = halALIGN_NP2(info-&amp;gt;size, PAGE_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;hostPtr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= mmap(NULL, regisInfo.size, PROT_WRITE | PROT_READ, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;regisInfo.hostMemAddr = (uint64_t)hostPtr;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;return &lt;b style=&quot;&quot;&gt;registerMemory&lt;/b&gt;(processor, node, &amp;amp;regisInfo);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-6">
          <mxGeometry y="60" width="700" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-10" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-4" target="Rt-lXHL0REA0ntXYS-w8-7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="15570" y="2990" as="sourcePoint" />
            <mxPoint x="15620" y="2940" as="targetPoint" />
            <Array as="points">
              <mxPoint x="15420" y="2690" />
              <mxPoint x="15420" y="2830" />
              <mxPoint x="14940" y="2830" />
              <mxPoint x="14940" y="2910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-11" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="14990" y="3230" width="700" height="480" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-12" value="&lt;b&gt;registerMemory(processor, memoryNode_PTR* node, registerHostMemoryInfo_PTR info)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-11">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-13" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-11">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-14" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if !gcdENABLE_HMM&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; gcsHAL_INTERFACE iface = { gcvHAL_WRAP_USER_MEMORY };&lt;br&gt;#else&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;gcsHAL_INTERFACE iface = { gcvHAL_HOST_REGISTER };&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; iface.devCtxt&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;devCtx;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .ignoreTLS&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .hardwareType = processor-&amp;gt;coreTypes[0];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .coreIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;coreIndex[0];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .devIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;devIdx;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;iface.u.HostRegister.address = info-&amp;gt;hostMemAddr;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;iface.u.HostRegister.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= info-&amp;gt;size;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-11">
          <mxGeometry y="60" width="700" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-17" value="&lt;b&gt;KmdIoCtl&lt;/b&gt;(KmdHandle(processor, iface), IOCTL_GCHAL_INTERFACE, &amp;amp;iface, sizeof(iface), &amp;amp;iface, sizeof(iface));" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-11">
          <mxGeometry y="260" width="700" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-16" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;memoryNode_PTR pNode = os_calloc(sizeof(memoryNode_t));&lt;/span&gt;&lt;/div&gt;&lt;span&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;pNode-&amp;gt;processor&amp;nbsp; = processor;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;handle&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= iface.u.HostRegister.node;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= info-&amp;gt;size;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;type&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvVIDMEM_TYPE_GENERIC;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;-&amp;gt;cpuLogical = info-&amp;gt;hostMemAddr;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: light-dark(rgb(185, 224, 165), rgb(18, 18, 18));&quot;&gt;-&amp;gt;gpuLogical = info-&amp;gt;hostMemAddr;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;*node = pNode;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;background-color: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-11">
          <mxGeometry y="290" width="700" height="190" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-15" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-9" target="Rt-lXHL0REA0ntXYS-w8-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="15390" y="2700" as="sourcePoint" />
            <mxPoint x="15000" y="2919" as="targetPoint" />
            <Array as="points">
              <mxPoint x="15740" y="3030" />
              <mxPoint x="15740" y="3180" />
              <mxPoint x="14950" y="3180" />
              <mxPoint x="14950" y="3270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-18" value="gc_hal_kernel.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="15910" y="3340" width="770" height="1070" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-19" value="&lt;b&gt;_HostRegister(Kernel, ProcessID, *Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="26" width="770" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-20" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="52" width="770" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-21" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gckVIDMEM_NODE nodeObject = gcvNULL;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;address = Interface-&amp;gt;u.HostRegister.address;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gcsVARangeArgs = {0};&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gctUVA start = 0, end = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="60" width="770" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-22" value="&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;desc.flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvALLOC_FLAG_USERMEMORY;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .logical&amp;nbsp; &amp;nbsp; = address;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .physical = gcvINVALID_PHYSICAL_ADDRESS;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Interface-&amp;gt;u.HostRegister.size;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gcsVIDMEM_NODE_WrapUserMemory&lt;/b&gt;(Kernel, &amp;amp;desc, gcvVIDMEM_TYPE_GENERIC, &amp;amp;nodeObject, &amp;amp;Interface-&amp;gt;u.HostRegister.size);&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="130" width="770" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-23" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;b&gt;gckVIDMEM_HANDLE_Allocate&lt;/b&gt;(Kernel, nodeObject, &amp;amp;handle);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;Interface-&amp;gt;u.HostRegister.node = handle;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;type = gcvDB_VIDEO_MEMORY | (nodeObject-&amp;gt;type &amp;lt;&amp;lt; ..shift) | (nodeObject-&amp;gt;pool &amp;lt;&amp;lt; ...shift);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;b&gt;gcvVIDMEM_NODE_IsContiguous&lt;/b&gt;(Kernel, nodeObject, &amp;amp;isContiguous);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;if (isContiguous) type |= gcvDB_CONTIGUOUS &amp;lt;&amp;lt; ..shift;&lt;br&gt;&lt;br&gt;&lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, type, handle, gcvNULL, Interface-&amp;gt;u.HostRegister.size);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="240" width="770" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-25" value="gckKERNEL_FindDatabase(Kernel, ProcessID, gcvFALSE, &amp;amp;dataBase);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vm = dataBase-&amp;gt;vm;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVM_VARangeFind&lt;/b&gt;(Kernel, vm, address, &amp;amp;range);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;start = gcmALIGN_BASE(address, 0x1000);&lt;/div&gt;&lt;div&gt;end&amp;nbsp; = gcmALIGN(address + Interface-&amp;gt;u.HostRegister.size, 0x1000);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="420" width="770" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-27" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/*如果rbtree中没有找到range, 或者 start address 不在range中并且没有overlap 下一个valid的range, 那就创建一个新的range*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (!range || &lt;b&gt;_RangeNonOverlap&lt;/b&gt;(range, address, Interface-&amp;gt;u.HostRegister.size)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; args.lowVA = gcvFALSE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.start&amp;nbsp; &amp;nbsp; = address;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.size&amp;nbsp; &amp;nbsp; &amp;nbsp;= Interface-&amp;gt;u.HostRegister.size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.createRange = gcvFALSE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="550" width="770" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-31" value="&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;gckVM_VARangeAlloc&lt;/b&gt;(Kernel, vm, &amp;amp;args, &amp;amp;range);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; range-&amp;gt;handle = handle;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="650" width="770" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-30" value="&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;gckVM_VARangeMap&lt;/b&gt;(Kernel,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;range,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;nodeObject,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;0,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(end - start) &amp;gt;&amp;gt; 12,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gcvMAP_FLAG_MAP_GPU | gcvMAP_FLAG_READWRITE);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="700" width="770" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-28" value="else {&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="820" width="770" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-29" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="940" width="770" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-26" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-18">
          <mxGeometry y="980" width="770" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-24" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-17" target="Rt-lXHL0REA0ntXYS-w8-19">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="16230" y="2740" as="sourcePoint" />
            <mxPoint x="16280" y="2690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-32" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="17040" y="2960" width="960" height="880" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-33" value="&lt;b&gt;gcsVIDMEM_NODE_WrapUserMemory(Kernel, gcsUSER_MEMORY_DESC_PTR Desc, gceVIDMEM_TYPE Type, gckVIDMEM_NODE *NodeObject, gctUINT64 *Bytes)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="26" width="960" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-34" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="52" width="960" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-35" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gckVIDMEM_NODE nodeObject = gcvNULL;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gctBOOL found = gcvFALSE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="60" width="960" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-38" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;#if defined(CONFIG_DMA_SHARED_BUFFER)&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="110" width="960" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-39" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;if (!found) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gcuVIDMEM_NODE_PTR node = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; do {&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="210" width="960" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-37" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageCountCpu&amp;nbsp; &amp;nbsp;= 0;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageSizeCpu&amp;nbsp; &amp;nbsp; &amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; physicalAddress = 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_GetPageSize&lt;/b&gt;(os, &amp;amp;pageSizeCpu);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_Allocate&lt;/b&gt;(os, sizeof(gcuVIDMEM_NODE), &amp;amp;node);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_ZeroMemory&lt;/b&gt;(node, sizeof(gcuVIDMEM_NODE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.lowVA = (Desc-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_32BIT_VA);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;Vidmem.pool&amp;nbsp; &amp;nbsp; = gcvPOOL_VIRTUAL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gckOS_NodeIdAssign(os, node);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gckOS_GetProcessID(&amp;amp;processID);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;/* Wrap Memory */&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_WrapMemory&lt;/b&gt;(os, Kernel,&lt;/span&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Desc,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.bytes,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.physical,&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.contiguous,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;pageCountCpu);&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="280" width="960" height="330" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-41" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 获取 base physical address */&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_GetPhysicalFromHandle&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;node-&amp;gt;VidMem.physical&lt;/b&gt;&lt;/span&gt;, 0, &amp;amp;physicalAddress);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="610" width="960" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-42" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* allocate gckVIDMEM_NODE */&amp;nbsp;&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_Construct&lt;/b&gt;(Kernel, node, Type, &lt;b&gt;gcvPOOL_VIRTUAL&lt;/b&gt;, Desc-&amp;gt;flag, &amp;amp;nodeObject);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;node-&amp;gt;VidMem.fromUser = gcvTRUE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.pageCount = (pageCountCpu * pageSizeCpu -&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (physicalAddress &amp;amp; (pageSizeCpu - 1) &amp;amp; ~(4096 - 1))) &amp;gt;&amp;gt; 12;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if define(...MIRROR)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;mirror.refCount = 0;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="660" width="960" height="170" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-40" value="&amp;nbsp; &amp;nbsp; } while(gcvFALSE);&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-32">
          <mxGeometry y="830" width="960" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-36" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-22" target="Rt-lXHL0REA0ntXYS-w8-33">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="15700" y="3515" as="sourcePoint" />
            <mxPoint x="16090" y="3059" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-43" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="18310" y="2450" width="750" height="910" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-44" value="&lt;b&gt;gckOS_WrapMemory(Os, Kernel, gcsUSER_MEMORY_DESC_PTR Desc, *Bytes, *Physical, *Contiguous, *PageCountCpu)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="26" width="750" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-45" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="52" width="750" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-46" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;PLINUX_MDL&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mdl = gcvNULL;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gckALLOCATOR&amp;nbsp; &amp;nbsp; &amp;nbsp; allocator;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;gcsATTACH_DESC&amp;nbsp; desc;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="60" width="750" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-47" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;mdl = &lt;b&gt;CreateMdl&lt;/b&gt;(Os, Kernel);&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;mdl-&amp;gt;wrapFromPhysical = gcvFALSE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;mdl-&amp;gt;wrapFromLogical&amp;nbsp; &amp;nbsp;= gcvFALSE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;mdl-&amp;gt;fromUser&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvTRUE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="120" width="750" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-48" value="&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;if (Desc-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_DMABUF) {&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp; &amp;nbsp; ....&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="210" width="750" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-49" value="else if (Desc-&amp;gt;flag &amp;amp; gcvALLOC_FLAG_USERMEMORY) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;desc.userMem.memory = gcmUINT64_TO_PTR(Desc-&amp;gt;logical);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;desc.userMem.physical = Desc-&amp;gt;physical;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; desc.userMem.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Desc-&amp;gt;size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Desc-&amp;gt;size;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Desc-&amp;gt;physical == gcvINVALID_PHYSICAL_ADDRESS)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;mdl-&amp;gt;wrapFromLogical&amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;mdl-&amp;gt;wrapFromPhysical = gcvTRUE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; ONERROR(gcvSTATUS_NOT_SUPPORTED);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="270" width="750" height="210" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-50" value="list_for_each_entry(allocator, &amp;amp;Os-&amp;gt;allocatorList, link) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Desc-&amp;gt;flag &amp;amp; allocator-&amp;gt;capability) != Desc-&amp;gt;flag) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; status = gcvSTATUS_NOT_SUPPORTED;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; continue;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;status =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;allocator-&amp;gt;ops-&amp;gt;Attach&lt;/b&gt;(allocator, &amp;amp;desc, mdl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (gcmIS_SUCCESS(status)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl-&amp;gt;allocator = allocator;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="480" width="750" height="190" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-51" value="mdl-&amp;gt;dmaHandle = 0;&lt;div&gt;mdl-&amp;gt;addr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 0;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= bytes ? bytes : mdl-&amp;gt;numPages * PAGE_SIZE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = mdl-&amp;gt;bytes;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Physical&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = mdl;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*Contiguous&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= mdl-&amp;gt;contiguous;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (PageCountCpu)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;*PageCountCpu = mdl-&amp;gt;numPages;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;list_add_tail(&amp;amp;mdl-&amp;gt;link, &amp;amp;Os-&amp;gt;mdlHead);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="670" width="750" height="190" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-52" value="&amp;nbsp; &amp;nbsp; } while(gcvFALSE);&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-43">
          <mxGeometry y="860" width="750" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-53" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.524;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-37" target="Rt-lXHL0REA0ntXYS-w8-44">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="17720" y="2986" as="sourcePoint" />
            <mxPoint x="17900" y="2940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-55" value="gc_hal_kernel_allocator_user_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="19300" y="2470" width="640" height="260" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-56" value="&lt;b&gt;_UserMemoryAttach(gckALLOCATOR Allocator, gcsATTACH_DESC_PTR Desc, PLINUX_MDL Mdl)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-55">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-57" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-55">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-58" value="&lt;b&gt;gckOS_Allocator&lt;/b&gt;(os, gcmSIZEOF(struct um_desc), &amp;amp;userMemory));&lt;br&gt;&lt;b&gt;gckOS_ZeroMemory&lt;/b&gt;(userMemory, gcmSIZEOF(struct um_desc));" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-55">
          <mxGeometry y="60" width="640" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-68" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;_Import(os,&lt;/b&gt;&amp;nbsp;&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Mdl, &lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Desc-&amp;gt;userMem.memory,&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Desc-&amp;gt;userMem.size,&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;userMemory);&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-55">
          <mxGeometry y="110" width="640" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-67" value="Mdl-&amp;gt;priv&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= userMemory;&lt;div&gt;Mdl-&amp;gt;numPages = userMemory-&amp;gt;pageCount + userMemory-&amp;gt;extPage;&lt;/div&gt;&lt;div&gt;Mdl-&amp;gt;contiguous = userMemory-&amp;gt;chunk_count == 1;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-55">
          <mxGeometry y="200" width="640" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-60" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-50" target="Rt-lXHL0REA0ntXYS-w8-56">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="19180" y="2910" as="sourcePoint" />
            <mxPoint x="19350" y="2720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-61" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="19300" y="4750" width="700" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-62" value="&lt;b&gt;gckOS_GetPhysicalFromHandle&lt;/b&gt;&lt;b&gt;(Os, gctPHYS_ADDR Physical, Offset, gctPHYS_ADDR_T *PhysicalAddress)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-61">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-63" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-61">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-64" value="PLINUX_MDL mdl = Physical;&lt;div&gt;gckALLOCATOR allocator = mdl-&amp;gt;allocator;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator-&amp;gt;ops-&amp;gt;Physical(allocator, mdl, Offset, PhysicalAddress);&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-61">
          <mxGeometry y="60" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-66" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-41" target="Rt-lXHL0REA0ntXYS-w8-62">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="17410" y="4030" as="sourcePoint" />
            <mxPoint x="19310" y="3019" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-69" value="gc_hal_kernel_allocator_user_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="19300" y="2835" width="640" height="1530" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-70" value="&lt;b&gt;_Import(Os, Mdl, gctPOINTER Memory, gctPHYS_ADDR_T Physical, Size, struct um_desc *UserMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="26" width="640" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-71" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="52" width="640" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-72" value="unsigned long vm_flags = 0;&lt;div&gt;struct vm_area_struct *vma;&lt;/div&gt;&lt;div&gt;struct device *dev = Mdl-&amp;gt;device;&lt;/div&gt;&lt;div&gt;gctSIZE_T start, end, memory;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;extraPage; pageCount;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="60" width="640" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-73" value="memory = (Physical != gcvINVALID_PHYSICAL_ADDRESS) ?&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Physical : &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;untagged_addr&lt;/b&gt;(Memory)&lt;/span&gt;; &lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* untagged_addr = Memory, 如果untagged_add 没有被特殊定义 */&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;end&amp;nbsp; = (memory + Size + PAGE_SIZE - 1) &amp;gt;&amp;gt; PAGE_SHIFT;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;start = memory &amp;gt;&amp;gt; PAGE_SHIFT;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;pageCount = end - start;&lt;br&gt;&lt;br&gt;extraPage = ((memory + gcmALIGN(Size + 64, 64) + PAGE_SIZE - 1) &amp;gt;&amp;gt; PAGE_SHIFT) &amp;gt; end ? 1 : 0;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="160" width="640" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-76" value="/* Check Overflow */&lt;div&gt;if ((memory + Size) &amp;lt; memory) return gcvSTATUS_INVALID_ARGUMENT;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;memory = &lt;b style=&quot;&quot;&gt;untagged_addr&lt;/b&gt;(Memory);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="290" width="640" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-74" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;if (memory) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr = memory;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; down_read(&amp;amp;&lt;b&gt;current_mm_mmap_sem&lt;/b&gt;);&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;vma = &lt;b style=&quot;&quot;&gt;find_vma&lt;/b&gt;(current-&amp;gt;mm, memory);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; up_read(&amp;amp;&lt;b&gt;current_mm_mmap_sem&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if(!vma) gcvSTATUS_INVALID_ARGUMENT;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_ARM&lt;br&gt;&amp;nbsp; &amp;nbsp; /* coherent cache in case vivt or vipt-aliasing cache */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;__cpuc_flush_user_range&lt;/b&gt;(memory, memory + Size, vma-&amp;gt;vm_flags);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vm_flags = vma-&amp;gt;vm_flags;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr&amp;nbsp; &amp;nbsp; &amp;nbsp; = vma-&amp;gt;vm_end;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;down_read&lt;/b&gt;(&amp;amp;current_mm_mmap_sem);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; while(vaddr &amp;lt; memory + Size) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;vma = find_vma(current-mm, vaddr);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!vma) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* No such memory */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;up_read&lt;/b&gt;(&amp;amp;current_mm_mmap_sem); ONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if ((vma-&amp;gt;vm_flags &amp;amp; VM_PFNMAP) != (vm_flags &amp;amp; VM_PFNMAP)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;up_read&lt;/b&gt;(&amp;amp;current_mm_mmap_sem); ONERROR(gcvSTATUS_NOT_SUPPORTED);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; vaddr = vma-&amp;gt;vm_end;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;up_read&lt;/b&gt;(&amp;amp;current_mm_mmap_sem);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="360" width="640" height="480" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-77" value="&lt;div&gt;if (Physical != gcvINVALID_PHYSICAL_ADDRESS) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (vm_flags &amp;amp; VM_PFNMAP)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;import_pfn_map&lt;/b&gt;(Os, dev, UserMemory, memory, pageCount);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;import_page_map&lt;/span&gt;&lt;/b&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;(Os, dev, UserMemory, memory, pageCount, Size, vm_flags);&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="840" width="640" height="150" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-80" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(153, 255, 255);&quot;&gt;/* 检查4G memory 要求 */&lt;/span&gt;&lt;/div&gt;if (Os-&amp;gt;device-&amp;gt;platform-&amp;gt;flagBits &amp;amp; gcvPLATFORM_FLAG_LIMIT_4G_ADDRESS) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Physical != gcvINVALID_PHYSICAL_ADDRESS) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Physical &amp;gt; 0xFFFF_FFFFu || Physical + Size &amp;gt; 0xFFFF_FFFFu) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; } else if (vm_flags &amp;amp; VM_PFNMAP) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; pageCount; i++) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; addr = UserMemory-&amp;gt;pfns[i] &amp;lt;&amp;lt; PAGE_SHIFT;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (addr &amp;gt; 0xFFFF_FFFFu) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;free_memory&lt;/b&gt;(UserMemory-&amp;gt;pfns);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; UserMemory-&amp;gt;pfns = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;free_memory&lt;/b&gt;(UserMemory-&amp;gt;refs);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; UserMemory-&amp;gt;refs = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (i = 0; i &amp;lt; pageCount; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; addr = &lt;b&gt;page_to_phys&lt;/b&gt;(UserMemory-&amp;gt;pages[i]);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (addr &amp;gt; 0xFFFF_FFFFu) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; free_memory(UserMemory-&amp;gt;pages);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; UserMemory-&amp;gt;pages = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;ONERROR(gcvSTATUS_INVALID_ARGUMENT);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="990" width="640" height="420" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-78" value="UserMemory-&amp;gt;vm_flags&amp;nbsp; &amp;nbsp; &amp;nbsp;= vm_flags;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;user_vaddr = Memory;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = pageCount &amp;lt;&amp;lt; PAGE_SHIFT;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;offset&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = (Physical != gcvINVALID_PHYSICAL_ADDRESS) ?&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (Physical &amp;amp; ~PAGE_MASK) : (memory &amp;amp; ~PAGE_MASK);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;pageCount = pageCount;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;extraPage&amp;nbsp; = extraPage;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-69">
          <mxGeometry y="1410" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-75" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-56" target="Rt-lXHL0REA0ntXYS-w8-70">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="19070" y="3035" as="sourcePoint" />
            <mxPoint x="19310" y="2519" as="targetPoint" />
            <Array as="points">
              <mxPoint x="19990" y="2510" />
              <mxPoint x="19990" y="2780" />
              <mxPoint x="19250" y="2780" />
              <mxPoint x="19250" y="2874" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-81" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-77" target="Rt-lXHL0REA0ntXYS-w8-83">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="19070" y="3035" as="sourcePoint" />
            <mxPoint x="19190" y="2940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-82" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="20270" y="3250" width="700" height="1230" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-83" value="&lt;b&gt;import_pfn_map&lt;/b&gt;&lt;b&gt;(Os, dev, struct um_desc *um, unsigned long addr, pfn_count)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-84" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-85" value="struct vm_area_struct *vma;&lt;div&gt;unsigned long *pfns;&lt;/div&gt;&lt;div&gt;struct page **pages = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (!current-&amp;gt;mm)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return -ENOTTY;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;down_read(&amp;amp;current_mm_mmap_sem);&lt;br&gt;vma = find_vma(current-&amp;gt;mm, addr);&lt;/div&gt;&lt;div&gt;#if !gcdUSING_PFN_FOLLOW&lt;/div&gt;&lt;div&gt;up_read(&amp;amp;current_mm_mmap_sem);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="60" width="700" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-86" value="pfns = &lt;b&gt;alloc_memory&lt;/b&gt;(pfn_count * sizeof(unsigned long));&lt;div&gt;refs&amp;nbsp; = &lt;b&gt;alloc_memory&lt;/b&gt;(pfn_count * sizeof(void*));&lt;/div&gt;&lt;div&gt;pages = &lt;b&gt;alloc_memory&lt;/b&gt;(pfn_count * sizeof(void *));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="240" width="700" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-88" value="for (i = 0; i &amp;lt; pfn_count; i++) {&lt;div&gt;#if gcdUSING_PFN_FOLLOW&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;follow_pfn&lt;/b&gt;(vma, addr, &amp;amp;pfns[i]);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; spinlock_t *ptl;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pgd_t *pgd;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; p4d_t *p4d;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pud_t *pud;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pmd_t *pmd;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pte_t&amp;nbsp; &amp;nbsp;*pte;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pgd = pgd_offset(current-mm, addr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; p4d = p4d_offset(pgd, addr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; pud = pud_offset(p4d, addr);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pte&amp;nbsp; = pte_offset_map_lock(current-&amp;gt;mm, pmd, addr, &amp;amp;ptl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!pte_presend(*pte)) {pte_unmap_unlock(pte, ptl);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pfns[i] = pte_pfn(*pte);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;pte_unmap_unlock(pte, ptl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; addr += PAGE_SIZE;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;#if gcdUSING_PFN_FOLLOW&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; up_read(&amp;amp;current_mm_mmap_sem);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="300" width="700" height="400" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-87" value="for (i = 0; i &amp;lt; pfn_count; i++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;b&gt;pfn_valid&lt;/b&gt;(pfns[i])) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; struct page *page = &lt;b&gt;pfn_to_page&lt;/b&gt;(pfns[i]);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; refs[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = &lt;b&gt;get_page_unless_zero&lt;/b&gt;(page);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pages[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = page;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pageCount++;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="700" width="700" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-90" value="um-&amp;gt;chunk_count = 1;&lt;div&gt;for (i = 1; i &amp;lt; pfn_count; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pfns[i] != pfns[i - 1] + 1) ++um-&amp;gt;chunk_count;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="830" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-91" value="if (&lt;b&gt;phy_is_from_reserved&lt;/b&gt;(Os, pfns[0] &amp;lt;&amp;lt; PAGE_SHIFT));&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (pageCount == pfn_count &amp;amp;&amp;amp; !um-&amp;gt;alloc_from_res) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;sg_alloc_table_from_pages&lt;/b&gt;(&amp;amp;um-&amp;gt;sgt,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pages, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pfn_count,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;addr &amp;amp; ~PAGE_MASK,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pfn_count * PAGE_SIZE,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;GFP_KERNEL | gcdNOWARN);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; dma_map_sg(dev, um-&amp;gt;sgt.sgl, um-&amp;gt;sgt.nents, DMA_TO_DEVICE);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;if (Os-&amp;gt;iommu)&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;um-&amp;gt;dmaHandle = sg_dma_address(um-&amp;gt;sgt.sgl);&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="900" width="700" height="230" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-89" value="&lt;b&gt;free_memory&lt;/b&gt;(pages);&lt;div&gt;pages = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;um-&amp;gt;type = UM_PFN_MAP;&lt;/div&gt;&lt;div&gt;um-&amp;gt;pfns = pfns;&lt;/div&gt;&lt;div&gt;um-&amp;gt;refs = refs;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-82">
          <mxGeometry y="1130" width="700" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-92" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="20270" y="4660" width="700" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-93" value="&lt;b&gt;_UserMemoryPhysical(gckALLOCATOR Allocator, PLINUX_MDL Mdl, Offset, gctPHYS_ADDR_T *Physical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-92">
          <mxGeometry y="26" width="700" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-94" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-92">
          <mxGeometry y="52" width="700" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-97" value="struct um_desc *userMemory = Mdl-&amp;gt;priv;&lt;div&gt;unsigned long offset = Offset + userMemory-&amp;gt;offset;&lt;/div&gt;&lt;div&gt;offsetInPage&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= offset &amp;amp; ~PAGE_MASK;&lt;/div&gt;&lt;div&gt;index&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= offset/PAGE_SIZE;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-92">
          <mxGeometry y="60" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-95" value="PLINUX_MDL mdl = Physical;&lt;div&gt;gckALLOCATOR allocator = mdl-&amp;gt;allocator;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;return &lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator-&amp;gt;ops-&amp;gt;Physical(allocator, mdl, Offset, PhysicalAddress);&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" vertex="1" parent="Rt-lXHL0REA0ntXYS-w8-92">
          <mxGeometry y="130" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Rt-lXHL0REA0ntXYS-w8-96" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Rt-lXHL0REA0ntXYS-w8-64" target="Rt-lXHL0REA0ntXYS-w8-93">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="18010" y="3605" as="sourcePoint" />
            <mxPoint x="19310" y="4799" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

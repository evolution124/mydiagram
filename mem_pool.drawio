<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0" version="26.2.14">
  <diagram name="Page-1" id="1dB5lCZi5Taqo5wlKjE4">
    <mxGraphModel dx="1712" dy="1655" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-QamLBn5pkz0fhhn8fLs-13" value="" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="-240" y="-1000" width="4360" height="2670" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-1" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" width="560" height="294" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-2" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Poll, gckVIDMEM *VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-5" value="switch(Pool) {" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="60" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-4" value="case &lt;b&gt;gcvPOOL_LOCAL_INTERNAL&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;internalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="86" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-7" value="case &lt;b&gt;gcvPOOL_LOCAL_EXTERNAL&lt;/b&gt;:&amp;nbsp; vm = device-&amp;gt;externalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="112" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-10" value="case &lt;b&gt;gcvPOOL_LOCAL_EXCLUSIVE&lt;/b&gt;: vm = device-&amp;gt;exclusiveVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="138" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-9" value="case &lt;b&gt;gcvPOOL_SYSTEM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;contiguousVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;memIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="164" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-13" value="case &lt;b&gt;gcvPOOL_SYSTEM_32BIT_VA&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;lowContiguousVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="190" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-11" value="case &lt;b&gt;gcvPOOL_INTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;sRAMVidMem[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Kernel-&amp;gt;sRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="216" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-12" value="case &lt;b&gt;gcvPOOL_EXTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; vm = device-&amp;gt;extSRAMVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;extSRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="242" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-8" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="268" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-14" value="gc_hal_kernel_device.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="880" y="-660" width="560" height="788" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-15" value="&lt;b&gt;gckGALDEVICE_Construct(*Platform, *Args, *Device)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-16" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-17" value="gal_device-&amp;gt;externalSize[i] = Args-&amp;gt;externalSize[i]" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="60" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-65" value="&lt;div&gt;if (gal_device-&amp;gt;externalSize[i] &amp;gt; 0) {&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="90" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-26" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalVidMem[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="120" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-27" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalPhysical[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="190" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-47" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//physical 其实是 PLINUX_MDL&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;externalPhysical[i]-&amp;gt;physical = gal_device-&amp;gt;externalPhysical[i];&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="260" width="560" height="50" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-25" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="310" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-60" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="336" width="560" height="74" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-61" value="if (gal_device-&amp;gt;exclusiveSize[i] &amp;gt; 0) {" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="410" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-62" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusiveVidMem[i]&lt;/span&gt;);&amp;nbsp;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="436" width="560" height="74" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-2" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_RequestReservedMemory&lt;/b&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(os,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusivePhysical[i]&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = ((LINUX_MDL)gal_device-&amp;gt;exclusivePhysical[i])-&amp;gt;allocator;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;physical = gal_device-&amp;gt;exclusivePhysical[i];&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;capability |= allocator-&amp;gt;capability;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="510" width="560" height="130" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-63" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="640" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-66" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="666" width="560" height="44" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-67" value="_SetupContiguousVidMem(gal_device, i , Args);" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="710" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-68" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="736" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-59" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="762" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-28" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-7" target="RKsYsZY5aNLMbsADSlp9-65" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="980" y="180" as="sourcePoint" />
            <mxPoint x="1140" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-29" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2660" y="-780" width="530" height="726" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-30" value="&lt;b&gt;gckVIDMEM_Construct(Os, PhysicalBase, Bytes, Threshold, BankSize, *Memory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-32" value="&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_Allocate&lt;/b&gt;(Os, sizeof(struct _gckVIDMEM), &amp;amp;pointer);&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;memory = pointer&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="60" width="530" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-33" value="&lt;div&gt;memory-&amp;gt;object.type = gcvOBJ_VIDMEM;&lt;/div&gt;&lt;div&gt;...&lt;br&gt;memory-&amp;gt;physicalBase&amp;nbsp; = PhysicalBase;&lt;br&gt;memory-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&amp;nbsp; &amp;nbsp; &amp;nbsp;//Bytes&lt;br&gt;memory-&amp;gt;freeBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&lt;br&gt;memory-&amp;gt;minFreeBytes = heapBytes;&lt;br&gt;memory-&amp;gt;capability&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = ~0u;&lt;br&gt;memory-&amp;gt;threshold&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Threshold;&lt;br&gt;memory-&amp;gt;mutex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="100" width="530" height="140" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-34" value="&lt;div&gt;for (i = 0; i &amp;lt; gcmCOUNTOF(memory-&amp;gt;sentinel); ++i) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;gckOS_Allocate(Os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;node = pointer;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.parent = memory;&lt;/span&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.next = .....prev = .....nextFree = .....prevFree = &amp;amp;memory-&amp;gt;sentinel[i];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextReserved = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.offset = base;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.bytes = bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.aligment = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.pool = gcvPOOL_DEFAULT;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.locked = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.processID = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.logical = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.kvaddr = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.next = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prev = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.nextFree = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prevFree = node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;-&amp;gt;sentinel[i].VidMem.bytes = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;-&amp;gt;sentinel[i].VidMem.nextReserved = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; base += bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; heapBytes -= bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; banks++;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* Assign all the bank mappings */&lt;br&gt;memory-&amp;gt;mapping[xxxxx] = bank xxxx&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="240" width="530" height="460" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-35" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="700" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-36" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-26" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="109" as="sourcePoint" />
            <mxPoint x="750" y="-261" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1480" y="-505" />
              <mxPoint x="2050" y="-740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-37" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2660" y="60" width="530" height="452" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-38" value="&lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;&lt;b&gt;(Os, Start, Size, Name, Requested, MemoryHandle)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-39" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-40" value="gckALLOCATOR allocator;&lt;div&gt;gcsATTACH_DESC desc;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Size = (Size + ~PAGE_MASK) &amp;amp; PAGE_MASK;&lt;/div&gt;&lt;div&gt;mdl = _CreateMdl(Os, gcvNULL);&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="60" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-41" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;desc.reservedMem.start&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;desc.reservedMem.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Size;&lt;/div&gt;&lt;div&gt;desc.reservedMem.name&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Name;&lt;/div&gt;&lt;div&gt;desc.reservedMem.requested = Requested;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;desc.reservedMem.root&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="150" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-49" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = _FindAllocator(Os, gcvALLOC_FLAG_LINUX_RESERVED_MEM);&lt;br&gt;allocator-&amp;gt;ops-&amp;gt;Attach(allocator, &amp;amp;desc, mdl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;allocator&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = allocator;&lt;br&gt;mdl-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Size;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;numPages&amp;nbsp; &amp;nbsp; = Size &amp;gt;&amp;gt; PAGE_SHIFT;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;contiguous&amp;nbsp; &amp;nbsp; = gcvTRUE;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;addr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;br&gt;mdl-&amp;gt;dmaHandle&amp;nbsp; = Start;&lt;br&gt;mdl-&amp;gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="240" width="530" height="160" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-48" value="list_add_tail(&amp;amp;mdl-&amp;gt;link, &amp;amp;Os-&amp;gt;mdlHead);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="400" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-43" value="*MemoryHandle = (void *) mdl;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="426" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-44" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-27" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1310" y="-165" as="sourcePoint" />
            <mxPoint x="1690" y="-1031" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1900" y="-440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-50" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3390" y="340" width="490" height="510" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-51" value="&lt;b&gt;reserved_mem_attach(Allocator, Desc, Mdl)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-52" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-54" value="struct reserved_mem_alloc *alloc = Allocator-&amp;gt;privateData&lt;br&gt;struct reserved_mem *res;&lt;div&gt;struct resource *region;&lt;br&gt;&lt;br&gt;res = kzalloc(sizeof(res), GFP_KERNEL | gcdNOWARN);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="60" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-55" value="res-&amp;gt;start = Desc-&amp;gt;reservedMem.start;&lt;br&gt;res-&amp;gt;size&amp;nbsp; = Desc-&amp;gt;reservedMem.size;&lt;br&gt;res-&amp;gt;offset_in_page = Desc-&amp;gt;reservedMem.start &amp;amp; (PAGE_SIZE - 1);&lt;br&gt;strncpy(res-&amp;gt;name, Desc-&amp;gt;reservedMem.name, sizeof(res-&amp;gt;name) - 1);&lt;div&gt;res-&amp;gt;release = 0;&lt;br&gt;res-&amp;gt;root = Desc-&amp;gt;reservedMem.root;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="140" width="490" height="100" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-56" value="if (Desc-&amp;gt;reservedMem.root) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!Desc-&amp;gt;reservedMem.requested) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; region = request_mem_region(res-&amp;gt;start, res-&amp;gt;size, res-&amp;gt;name);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!resgion) { kfree(res); return OUT_OF_RESOURCES; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; res-&amp;gt;release = 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_add(&amp;amp;res-&amp;gt;link, &amp;amp;alloc-&amp;gt;region);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Mdl-&amp;gt;priv = res;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="240" width="490" height="190" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-57" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_CPUPhysicalToGPUPhysical(os, (res-&amp;gt;start + res-&amp;gt;size - 1), &amp;amp;gpu_end);&lt;br&gt;&lt;br&gt;if (gpu_end &amp;lt;= 0xFFFF_FFFF) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; Allocator-&amp;gt;capability |= gcvALLOC_FLAG_4GB_ADDR;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="430" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-58" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-49" target="RKsYsZY5aNLMbsADSlp9-51" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2610" y="690" as="sourcePoint" />
            <mxPoint x="2030" y="479" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-64" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-10" target="RKsYsZY5aNLMbsADSlp9-61" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="135" as="sourcePoint" />
            <mxPoint x="750" y="-165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-69" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-9" target="RKsYsZY5aNLMbsADSlp9-67" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="750" y="190" as="sourcePoint" />
            <mxPoint x="910" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-1" value="gc_hal_kernel_device.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="20" width="600" height="1446" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-2" value="&lt;span style=&quot;color: rgb(51, 51, 51);&quot;&gt;_SetupContiguousVidMem(gal_device, i , Args);&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="26" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="52" width="600" height="8" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-4" value="device-&amp;gt;contiguousBases[i] = Args-&amp;gt;contiguousBases[i&#39;];&lt;br&gt;device-&amp;gt;contiguousSizes[i]&amp;nbsp; &amp;nbsp;= Args-&amp;gt;contiguousSizes[i];&lt;br&gt;device-&amp;gt;requestedContiguousBaes[i] = 0;&lt;div&gt;device-&amp;gt;requestedContiguousSizes[i] = 0;&lt;br&gt;if (!device-&amp;gt;contiguousBases[i] = 0) return gcvSTATUS_OK;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="60" width="600" height="90" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-5" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;&lt;b&gt;if (device-&amp;gt;os-&amp;gt;iommu) {&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[i] = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousSizes[i] = 0;&lt;br&gt;&lt;b&gt;} else {&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="150" width="600" height="70" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-6" value="&amp;nbsp; &amp;nbsp; if (&lt;b&gt;dev-&amp;gt;reserved32bitVA &lt;/b&gt;&amp;amp;&amp;amp; &lt;b&gt;!device-&amp;gt;lowContiguousSize&lt;/b&gt; &amp;amp;&amp;amp; &lt;b&gt;!Args-&amp;gt;lockLargeVA&lt;/b&gt;) {&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gctPHYS_ADDR_T&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gpuBase;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gctPHYS_ADDR_T lowContiguousBase = congiguousBases;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gctSIZE_T lowContiguousSize&amp;nbsp; &amp;nbsp;=&amp;nbsp; contiguousSIzes;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CPUPhysicalToGPUPhysical&lt;/b&gt;(os, contiguousBases, &amp;amp;gpuBase);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;if (gpuBase &amp;lt; gcd4G_SIZE) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;if (gpuBase + contiguousSizes &amp;gt; gcd4G_SIZE) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_GPUPhysicalToCPUPhysical&lt;/b&gt;(os, gcd4G_SIZE, &amp;amp;contiguousBases);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (gpuBase &amp;lt; gcdVA_RESERVED_SIZE)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases -= gcdVA_RESERVED_SIZE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (gpuBase &amp;gt; gcd4G_SIZE - gcd4G_VA_FM_SIZE)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases += gpuBase - (gcd4G_SIZE - gcd4G_VA_FM_SIZE);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize = contiguousBases - lowContiguousBase;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes&amp;nbsp; &amp;nbsp; &amp;nbsp; = (lowContiguousSize &amp;gt;= gcd4G_VA_FM_SIZE) ?&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (contiguousSizes - lowContiguousSize) : 0;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(255, 242, 204);&quot;&gt;} else {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;if (contiguousSizes &amp;gt; gcd4G_VA_FM_SIZE) {&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize = gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousBases&amp;nbsp; &amp;nbsp;+= gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes&amp;nbsp; &amp;nbsp; &amp;nbsp;-= gcd4G_VA_FM_SIZE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousSizes = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="220" width="600" height="460" as="geometry" />
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-1" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!Args-&amp;gt;enableMmu) { ... }&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (lowContiguousSize) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousBase,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, Args-&amp;gt;bankSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;lowContiguousVidMem);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="680" width="600" height="130" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-7" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contiguousRequested = Args-&amp;gt;contiguousRequested;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousBase,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;lowContiguousSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&quot;gcLowContMem&quot;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousRequested,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;lowContiguousPhysical);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; allocator = (PLINUX_MDL)device-&amp;gt;lowContiguousPhysical)-&amp;gt;allocator;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;lowContiguousVidMem-&amp;gt;capability = allocator-&amp;gt;capability | gcvALLOC_FLAG_MEM_LIMIT;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;physical&amp;nbsp; &amp;nbsp; = device-&amp;gt;lowContiguousPhysical;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;lowContiguousBase&amp;nbsp; = lowContiguousBase;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lowContiguousSize&amp;nbsp; &amp;nbsp; = lowContiguousSize;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="810" width="600" height="210" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-6" value="&amp;nbsp; &amp;nbsp; }" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1020" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-2" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1050" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-7" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousBaese,&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousSizes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, Args-&amp;gt;bankSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;contiguousVidMems[i];&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1100" width="600" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-10" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; contiguousRequested = Args-&amp;gt;contiguousRequested; /* AdjustParam 会设置为True */&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousBases,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousSizes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&quot;gcContMem&quot;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;contiguousRequested,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;device-&amp;gt;contiguousPhysicals[i]);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; allocator = ((PLINUX_MDL)device-&amp;gt;contiguousPhysicals[i])-&amp;gt;allocator;&lt;br&gt;&amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[i]-&amp;gt;capability = allocator-&amp;gt;capability | gcvALLOC_FLAG_MEMLIMIT;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;physical&amp;nbsp; &amp;nbsp;= device-&amp;gt;contiguousPhysicals[i];&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;requestedContiguousBases[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousBases;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;requestedContiguousSizes[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousSizes;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;contiguousBases[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;contiguousBases;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;contiguousSizes[i]&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= contiguousSizes;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1180" width="600" height="240" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-8" value="} /* else */" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1ENbYF7BbkhPWx73IUyd-1" vertex="1">
          <mxGeometry y="1420" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="1ENbYF7BbkhPWx73IUyd-9" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-67" target="1ENbYF7BbkhPWx73IUyd-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1510" y="140" as="sourcePoint" />
            <mxPoint x="1560" y="90" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QsT_bb-GeKoUEtdT82jw-3" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-13" target="RKsYsZY5aNLMbsADSlp9-67" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="187" as="sourcePoint" />
            <mxPoint x="890" y="83" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-1" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-62" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1450" y="-495" as="sourcePoint" />
            <mxPoint x="2330" y="-1471" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1720" y="-187" />
              <mxPoint x="2050" y="-740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-3" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-2" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1460" y="-64" as="sourcePoint" />
            <mxPoint x="2320" y="-630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1920" y="-85" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-4" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="QsT_bb-GeKoUEtdT82jw-1" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2320" y="390" as="sourcePoint" />
            <mxPoint x="2670" y="-731" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2360" y="610" />
              <mxPoint x="2360" y="-290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-8" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-7" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2330" y="1010" as="sourcePoint" />
            <mxPoint x="2650" y="90" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2470" y="710" />
              <mxPoint x="2470" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-11" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="1ENbYF7BbkhPWx73IUyd-7" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2170" y="775" as="sourcePoint" />
            <mxPoint x="2670" y="-731" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2360" y="1040" />
              <mxPoint x="2360" y="-290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-12" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-10" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2170" y="945" as="sourcePoint" />
            <mxPoint x="2670" y="109" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2470" y="1200" />
              <mxPoint x="2470" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-14" value="" style="rounded=0;whiteSpace=wrap;html=1;movable=0;resizable=0;rotatable=0;deletable=0;editable=0;locked=1;connectable=0;" parent="1" vertex="1">
          <mxGeometry x="-240" y="1930" width="6340" height="2880" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-15" value="memory.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-80" y="3080" width="490" height="160" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-16" value="&lt;b&gt;allocDeviceMemory(device, info, node)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-17" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-20" value="&lt;div&gt;&lt;b&gt;allocMemory&lt;/b&gt;(device-&amp;gt;processor, node, info);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="60" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-29" value="for (CUdevice i : *(device-&amp;gt;enableP2pDevice)) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;setHalMemAccess&lt;/b&gt;(DEVICE(i)-&amp;gt;processor, *node, HAL_MAP_ATTR_READWRITE)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-15" vertex="1">
          <mxGeometry y="100" width="490" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-33" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="470" y="3120" width="670" height="610" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-34" value="&lt;b&gt;allocMemory(processor, node, info)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="26" width="670" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-35" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="52" width="670" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-36" value="&lt;div&gt;iface&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= { &lt;b&gt;gcvHAL_ALLOCATE_LINEAR_VIDEO_MEMORY&lt;/b&gt; }&lt;/div&gt;&lt;div&gt;iface.devCtxt&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;devCtx&lt;/div&gt;&lt;div&gt;iface.hardwareType = processor-&amp;gt;coreTypes[0]&lt;/div&gt;&lt;div&gt;iface.coreIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;coreIndexs[0]&lt;/div&gt;&lt;div&gt;iface.devIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;devIdx&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.u.AllocateLinearVideoMemory.alignment = info-&amp;gt;alignment ? info-&amp;gt;alignment : 256;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = info-&amp;gt;size;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = info-&amp;gt;poolType;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvSURF_INDEX;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |= info-&amp;gt;force32Bit ? gcvALLOC_FLAG_32BIT_VA: 0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;KmdIoCtl&lt;/b&gt;(processor-&amp;gt;kmdHandle, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IOCTL_GCHAL_INTERFACE, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;iface, sizeof(iface), &amp;amp;iface, sizeof(iface);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;memoryNode_PTR pNode = (memoryNode_PTR)os_calloc(sizeof(memoryNode_t));&lt;br&gt;pNode-&amp;gt;processor = processor;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;handle&amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.node;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.pool;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = iface.u.AllocateLinearVideoMemory.bytes;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="60" width="670" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-37" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.command&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= &lt;b&gt;gcvHAL_LOCK_VIDEO_MEMORY&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;iface.u.LockVideoMemory.node&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= pNode-&amp;gt;handle;&lt;/div&gt;&lt;div&gt;iface.u.LockVideoMemory.op&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvLOCK_VIDEO_MEMORY_OP_LOCK | gcvLOCK_VIDEO_MEMORY_OP_MAP;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;iface.u.LockVideoMemory.cacheable = gcvFALSE;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;KmdIoCtl&lt;/b&gt;(processor-&amp;gt;kmdHandle, &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IOCTL_GCHAL_INTERFACE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;iface, sizeof(iface), &amp;amp;iface, sizeof(iface));&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;cpuLogical = iface.u.LockVideoMemory.memory;&lt;br&gt;pNode-&amp;gt;gpuLogical = iface.u.LockVideoMemory.address;&lt;br&gt;pNode-&amp;gt;physical&amp;nbsp; &amp;nbsp; &amp;nbsp;= iface.u.LockVideoMemory.physicalAddress;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*node = pNode&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-33" vertex="1">
          <mxGeometry y="380" width="670" height="230" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-38" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-20" target="-QamLBn5pkz0fhhn8fLs-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="2340" as="sourcePoint" />
            <mxPoint x="550" y="2290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-39" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1310" y="3120" width="570" height="500" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-40" value="&lt;b&gt;_AllocateLinearMemory(Kernel, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-41" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-42" value="pool&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Interface-&amp;gt;u.AllocateLinearVideoMemory.pool&lt;br&gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes&lt;br&gt;alignment =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .alignment&lt;br&gt;type&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type &amp;amp; 0xFF&lt;br&gt;flag&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag | gcvALLOC_FLAG_FROM_USER&lt;br&gt;mappingInOne = 1&lt;br&gt;isContiguous;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Interface-&amp;gt;u.AllocateLinearVideoMemory.extSRAMIndex &amp;gt;= 0)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Kernel-&amp;gt;device-&amp;gt;extSRAMIndex = Interface-&amp;gt;u.AllocateLinearVideoMemory.extSRAMIndex&lt;br&gt;&lt;br&gt;&lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOne&quot;, &amp;amp;mappingInOne)&lt;br&gt;if (mappingInOne == 0 ) {&lt;div&gt;&amp;nbsp; &amp;nbsp; alignment = gcmALIGN(alignment, 4096);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="60" width="570" height="230" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-43" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory&lt;/b&gt;(Kernel, alignment, type, flag, 0, &amp;amp;bytes, &amp;amp;pool, &amp;amp;nodeObject)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="290" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-51" value="&lt;b&gt;gckVIDMEM_HANDLE_Allocate&lt;/b&gt;(Kernel, nodeObject, &amp;amp;handle)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="330" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-50" value="Interface-&amp;gt;u.AllocateLinearVideoMemory.node = handle&lt;br&gt;Interface-&amp;gt;u.AllocateLinearVideoMemory.pool&amp;nbsp; = pool&lt;br&gt;Interface-&amp;gt;u.AllocateLinearVideoMemory.bytes = bytes" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="370" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-52" value="dbType = gcvDB_VIDEO_MEMORY | (type&amp;lt;&amp;lt;gcdDB_VIDEO_MEMORY_TYPE_SHIFT) |&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (pool &amp;lt;&amp;lt; gcdDB_VIDEO_MEMORY_POOL_SHIFT);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, dbType, gcmINT2PTR(handle), gcvNULL, bytes);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-39" vertex="1">
          <mxGeometry y="430" width="570" height="70" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-44" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2120" y="2140" width="760" height="1160" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-45" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory(Kernel, Alignment, Type, Flag, PoolID, *Bytes, *Pool, *NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="26" width="760" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-46" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="52" width="760" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-47" value="&lt;div&gt;contiguous = Flag &amp;amp; gcvALLOC_FLAG_CONTIGUOUS&lt;br&gt;cacheable&amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_CACHEABLE&lt;br&gt;secure&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_SECURITY&lt;br&gt;&lt;br&gt;if (Kernel-&amp;gt;vGPUType == gcvVGPU_MDEV)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; cacheable = gcvFALSE;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_NON_CPU_ACCESS)&lt;br&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_FAST_POOLS) {&lt;br&gt;&amp;nbsp; &amp;nbsp; fastPools = gcvTRUE&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_FAST_POOLS;&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT)&lt;br&gt;&amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_VIRTUAL;&lt;/div&gt;&lt;div&gt;....&lt;br&gt;&lt;br&gt;if ((Flag &amp;amp; (gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA))&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;amp;&amp;amp; *Pool != gcvPOOL_EXTERNAL_SRAM) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;reserve32bitVA) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;device-&amp;gt;externalSize)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_LOCAL_EXTERNAL;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM_32BIT_VA;&lt;br&gt;&amp;nbsp; &amp;nbsp; } else&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~(gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_DMABUF_EXPORTABLE) {&lt;br&gt;&amp;nbsp; &amp;nbsp; gckOS_GetPageSize(os, &amp;amp;pageSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; bytes = gcmALIGN(bytes, pageSize);&lt;br&gt;&amp;nbsp; &amp;nbsp; Alignment = pageSize;&lt;br&gt;}&lt;br&gt;&lt;br&gt;if (Type == gcvVIDMEM_TYPE_COMMAND) {&lt;br&gt;&amp;nbsp; &amp;nbsp;...&lt;br&gt;}&lt;br&gt;&lt;br&gt;/* All kernel used buffer should be contiguous */&lt;br&gt;if (!(Flag &amp;amp; gcvALLOC_FLAG_FROM_USER)) {&lt;br&gt;&amp;nbsp; &amp;nbsp; Flag |= gcvALLOC_FLAG_CONRIGUOUS; Flag |= gcvALLOC_FLAG_32BIT_VA; contiguous = gcvTRUE;&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="60" width="760" height="690" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-55" value="&lt;div&gt;&lt;b&gt;AllocateMemory:&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;vGPUType == gcvVGPU_MDEV)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_LOCAL_EXTERNAL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (*Pool == gcvPOOL_SYSTEM_32BIT_VA &amp;amp;&amp;amp; Kernel-&amp;gt;device-&amp;gt;lockLargeVA == gcvTRUE)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *Pool = gcvPOOL_SYSTEM;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="750" width="760" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-48" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (...)&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (cacheable == gcvFALSE &amp;amp;&amp;amp; secure == gcvFALSE) {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="850" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-57" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;br&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="910" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-56" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_GetVideoMemoryPool&lt;/b&gt;(Kernel, pool, &amp;amp;videoMemory);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="990" width="760" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-58" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; specified = (pool == gcvPOOL_SYSTEM || pool == gcvPOOL_INTERNAL_SRAM ||&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pool == gcvPOOL_EXTERNAL_SRAM || pool == gcvPOOL_SYSTEM_32BIT_VA);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; hasFastPools = gcvTRUE;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_AllocateLinear&lt;/b&gt;(Kernel, videoMemory, pool, Type, Flag, Aligment, specified, &amp;amp;bytes, &amp;amp;nodeObject);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1020" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-59" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-44" vertex="1">
          <mxGeometry y="1100" width="760" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-53" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-36" target="-QamLBn5pkz0fhhn8fLs-40" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1480" y="2830" as="sourcePoint" />
            <mxPoint x="1530" y="2780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-54" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-43" target="-QamLBn5pkz0fhhn8fLs-45" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1210" y="2430" as="sourcePoint" />
            <mxPoint x="1380" y="2249" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-60" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3210" y="2090" width="710" height="250" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-61" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-62" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-63" value="galDevice = Kernel-&amp;gt;context&lt;div&gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(Pool) {&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp;galDevice-&amp;gt;internalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXTERNAL:&amp;nbsp; device-&amp;gt;externalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE: device-&amp;gt;exclusiveVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_INTERNAL_SRAM:&amp;nbsp; &amp;nbsp; &amp;nbsp;Kernel-&amp;gt;sRAMVidMem[Kernel-&amp;gt;sRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; device-&amp;gt;extSRAMVidMems[device-&amp;gt;extSRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; galDevice-&amp;gt;lowContiguousVidMem;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-60" vertex="1">
          <mxGeometry y="60" width="710" height="190" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-68" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3210" y="2420" width="710" height="530" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-69" value="&lt;b&gt;gckVIDMEM_NODE_AllocateLinear(Kernel, VideoMemory, Pool, Type, Flag, Alignment, Specified, Bytes, NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-70" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-71" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gcuVIDMEM_NODE_PTR &lt;/b&gt;node;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckVIDMEM_NODE &lt;/b&gt;nodeObject;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;switch(Pool) {&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE:&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag |= gcvALLOC_FLAG_NON_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;default:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Flag &amp;amp;= ~gcvALLOC_FLAG_NON_CPU_ACCESS;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="60" width="710" height="170" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-78" value="&lt;b&gt;gckVIDMEM_AllocateLinear&lt;/b&gt;(Kernel, VideoMemory, bytes, Alignment, Type, Flag, Specified, &amp;amp;node);&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.pool = Pool;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.type = Type;&lt;/div&gt;&lt;div&gt;bytes = node-&amp;gt;VidMem.bytes;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="230" width="710" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-72" value="&lt;b&gt;gckVIDMEM_NODE_Construct&lt;/b&gt;(Kernel, node, Type, Pool, Flag, &amp;amp;nodeObject);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="310" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-84" value="&lt;b&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; /* Just update the mirror buffer type here */&lt;br&gt;&amp;nbsp; &amp;nbsp; if (Flag &amp;amp; gcvALLOC_FLAG_WITH_MIRROR) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;mirror.type = gcvMIRROR_TYPE_SYSTEM_MEMORY_MIRROR;&lt;br&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; #if gcdSTATIC_VIDEO_MEMORY_MIRROR&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;_AllocateVideoMemoryMirror&lt;/b&gt;(Kernel, nodeObject, gcvMIRROR_TYPE_SYSTEM_MEMORY_MIRROR);&lt;br&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; #else&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nodeObject-&amp;gt;mirror.refCount = 0;&lt;br&gt;&lt;b&gt;#endif&lt;/b&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="350" width="710" height="140" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-85" value="*Bytes = bytes;&lt;div&gt;*NodeObject = nodeObject;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-68" vertex="1">
          <mxGeometry y="490" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-76" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-56" target="-QamLBn5pkz0fhhn8fLs-61" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2970" y="2990" as="sourcePoint" />
            <mxPoint x="3020" y="2940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-77" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-58" target="-QamLBn5pkz0fhhn8fLs-69" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2890" y="3155" as="sourcePoint" />
            <mxPoint x="3220" y="2139" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-79" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4350" y="2040" width="770" height="870" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-80" value="&lt;b&gt;gckVIDMEM_AllocateLinear&lt;/b&gt;&lt;b&gt;(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="26" width="770" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-81" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="52" width="770" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-82" value="Alignment = gcmALIGN(Alignment, gcd4K_PAGE_SIZE);&lt;div&gt;Bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcmALIGN(Bytes, gcd4K_PAGE_SIZE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if gcdSMALL_BLOCK_SIZE /* for small memory */&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;bank = Memory-&amp;gt;mapping[Type]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node = &lt;b&gt;_FindNode&lt;/b&gt;(Kernel, Memory, bank, Bytes, Type, &amp;amp;alignment);&lt;br&gt;&lt;br&gt;if (node == null) { walk through banks within sentinel }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* 如果有对齐需求, Split 一个对齐大小的node, 并使用 node-&amp;gt;VidMem.next */&lt;/div&gt;&lt;div&gt;if (alignment &amp;gt; 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (&lt;b&gt;_Split&lt;/b&gt;(Memory-&amp;gt;os, node, alignment)) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node = node-&amp;gt;VidMem.next;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;alignment = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;br&gt;/* Remove the node from the free list. */&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prevFree-&amp;gt;VidMem.nextFree = node-&amp;gt;VidMem.nextFree;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree-&amp;gt;VidMem.prevFree = node-&amp;gt;VidMem.prevFree;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.nextFree = gcvNULL;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.prevFree = gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="60" width="770" height="390" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-90" value="&lt;div&gt;/* Fill in node information */&lt;br&gt;node-&amp;gt;VidMem.aligment = alignment;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.parent&amp;nbsp; &amp;nbsp; = Memory;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.logical&amp;nbsp; &amp;nbsp; = gcvNULL;&lt;br&gt;gckOS_GetProcessID(&amp;amp;node-&amp;gt;VidMem.processID);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* Adjust the number of free bytes */&lt;br&gt;Memory-&amp;gt;freeBytes -= node-&amp;gt;VidMem.bytes;&lt;br&gt;&lt;br&gt;if (Memory-&amp;gt;freeBytes &amp;lt; Memory-&amp;gt;minFreeBytes)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;Memory-&amp;gt;minFreeBytes = Memory-&amp;gt;freeBytes;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;VidMem.contiguous = gcvTRUE;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.fromUser&amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_FROM_USER;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.secure&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_SECURITY;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.onFault&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.uvm&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Flag &amp;amp; gcvALLOC_FLAG_UVM;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.lowVA&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag &amp;amp; (gcvALLOC_FLAG_32BIT_VA | gcvALLOC_FLAG_PRIOR_32BIT_VA)&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.pageCount = (node-&amp;gt;VidMem.bytes + (4096 -1)) &amp;gt;&amp;gt; 12;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckOS_NodeIdAssign&lt;/b&gt;(os, node);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="450" width="770" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-91" value="&lt;div&gt;&lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOne&quot;, &amp;amp;mappingInOne);&lt;/div&gt;&lt;div&gt;if (!mappingInOne) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemoryArea&lt;/b&gt;(os, Memory-&amp;gt;physical, node-&amp;gt;VidMem.offset, node-&amp;gt;VidMem.bytes, &amp;amp;node-&amp;gt;VidMem.physical);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*Node = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-79" vertex="1">
          <mxGeometry y="770" width="770" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-83" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-78" target="-QamLBn5pkz0fhhn8fLs-80" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4560" y="3076" as="sourcePoint" />
            <mxPoint x="4890" y="2060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-92" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4350" y="2990" width="690" height="540" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-93" value="&lt;b&gt;gckVIDMEM_NODE_Construct(Kernel, VideoNode, Type, Pool, Flag, NodeObject)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="26" width="690" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-94" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="52" width="690" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-95" value="gckOS_Allocate(os, gcmSIZEOF(gckVIDMEM_NODE), &amp;amp;pointer);&lt;div&gt;gckOS_ZeroMemory(pointer, gcmSIZEOF(gckVIDMEM_NODE));&lt;br&gt;&lt;br&gt;node = pointer;&lt;/div&gt;&lt;div&gt;node-&amp;gt;metadata.magic = VIV_VIDMEM_METADATA_MAGIC;&lt;br&gt;node-&amp;gt;metadata.ts_fd&amp;nbsp; &amp;nbsp;= -1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node-&amp;gt;node&amp;nbsp; &amp;nbsp;= VideoNode;&lt;/div&gt;&lt;div&gt;node-&amp;gt;kernel = Kernel;&lt;/div&gt;&lt;div&gt;node-&amp;gt;type&amp;nbsp; &amp;nbsp; = Type;&lt;/div&gt;&lt;div&gt;node-&amp;gt;pool&amp;nbsp; &amp;nbsp; = Pool;&lt;/div&gt;&lt;div&gt;node-&amp;gt;flag&amp;nbsp; &amp;nbsp; &amp;nbsp;= Flag;&lt;/div&gt;&lt;div&gt;node-&amp;gt;fd&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = -1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(node-&amp;gt;pool) {&lt;br&gt;case &lt;b&gt;gcvPOOL_SYSTEM/VIRTUAL/USER/SYSTEM_32BIT_VA&lt;/b&gt;: &lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;hostAlloc = gcvTRUE; break;&lt;/div&gt;&lt;div&gt;case &lt;b&gt;gcvPOOL_LOCAL_INTERNAL/LOCAL_EXTERNAL/INTERNAL_SRAM/EXTERNAL_SRAM/LOCAL_EXCLUSIVE&lt;/b&gt;:&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;hostAlloc = gcvFALSE; break;&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;mirror.mirrorNode = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;mirror.type = gcvMIRROR_TYPE_NONE;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b style=&quot;&quot;&gt;_UpdatePIDInfoListNode&lt;/b&gt;(os, node, VideoNode, 0, PIDINFO_LIST_NODE_Const);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gcsLIST_Add&lt;/b&gt;(&amp;amp;node-&amp;gt;link, &amp;amp;Kernel-&amp;gt;db-&amp;gt;videoMemList);&lt;/div&gt;&lt;div&gt;&lt;b&gt;gcsRBTREE_InitNode&lt;/b&gt;(&amp;amp;node-&amp;gt;rblink);&lt;br&gt;&lt;br&gt;*NodeObject = node;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-92" vertex="1">
          <mxGeometry y="60" width="690" height="480" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-96" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-72" target="-QamLBn5pkz0fhhn8fLs-93" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3930" y="2660" as="sourcePoint" />
            <mxPoint x="4360" y="2089" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-97" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1310" y="3740" width="570" height="880" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-98" value="&lt;b&gt;_LockVideoMemory(Kernel, Core, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-99" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-100" value="handle;&lt;div&gt;nodeObject;&lt;/div&gt;&lt;div&gt;address;&lt;br&gt;logical;&lt;/div&gt;&lt;div&gt;physical;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;handle = Interface-&amp;gt;u.LockVideoMemory.node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_HANDLE_Lookup&lt;/b&gt;(Kernel, ProcessID, handle, &amp;amp;nodeObject);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="60" width="570" height="140" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-101" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; gckVIDMEM_NODE_Reference(Kernel, nodeObject);&lt;br&gt;}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="200" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-105" value="&lt;b&gt;#if gcdVA_NEW_MM&lt;br&gt;&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="260" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-102" value="..." style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="290" width="570" height="120" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-106" value="&lt;b&gt;#else&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="410" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-103" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_MAP) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_LockCPU&lt;/b&gt;(Kernel, nodeObject,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Interface-&amp;gt;u.LockVideoMemory.cacheable,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcvTRUE, &amp;amp;logical);&lt;br&gt;&amp;nbsp; &amp;nbsp; Interface-&amp;gt;u.LockVideoMemory.memory = gcmPTR_TO_UINT64(logical);&lt;br&gt;}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="440" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-108" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_Lock&lt;/b&gt;(Kernel, nodeObject, &amp;amp;address);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetCPUPhysical&lt;/b&gt;(Kernel, nodeObject, 0, &amp;amp;physical);&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_NODE_GetGid&lt;/b&gt;(Kernel, nodeObject, &amp;amp;gid);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Interface-&amp;gt;u.LockVideoMemory.address = address;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .physicalAddress = physical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .gid = gid;&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="540" width="570" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-107" value="&lt;b&gt;#end&lt;/b&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="690" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-104" value="if (Interface-&amp;gt;u.LockVideoMemory.op &amp;amp; gcvLOCK_VIDEO_MEMORY_OP_LOCK) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, gcvDB_VIDEO_MEMORY_LOCKED,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcmINT2PTR(handle), logical, 0);&lt;div&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_HANDLE_Reference&lt;/b&gt;(Kernel, ProcessID, handle);&lt;br&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="720" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-109" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdINIT_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b&gt;_InitVideoMemoryMirror&lt;/b&gt;(Kernel, nodeObject);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-97" vertex="1">
          <mxGeometry y="820" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-110" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2130" y="3740" width="570" height="890" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-111" value="&lt;b&gt;gckVIDMEM_NODE_LockCPU(Kernel, NodeObject, Cacheable, FromUser, Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-112" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-113" value="gcuVIDMEM_NODE_PTR node;&lt;div&gt;gckVIDMEM_BLOCK vidMemBlock;&lt;/div&gt;&lt;div&gt;gckVIDMEM memory;&lt;/div&gt;&lt;div&gt;gctPOINTER logical;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#if gcdENABLE_VIDEO_MEMORY_MIRROR&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; ...&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#else&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node = NodeObject-&amp;gt;node;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;memory = node-&amp;gt;VidMem.parent;&lt;br&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;vidMemBlock = node-&amp;gt;VirtualChunk.parent;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="60" width="570" height="200" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-114" value="if (memory &amp;amp;&amp;amp; memory-&amp;gt;object.type == gcvOBJ_VIDMEM) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (FromUser) {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_LockPages&lt;/b&gt;(os, &lt;b style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;node-&amp;gt;VIdMem.devicePool-&amp;gt;poolPhysical&lt;/b&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.devicePool-&amp;gt;poolSize,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gcvFALSE, &amp;amp;logical);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckKERNEL_MapVideoMemory&lt;/b&gt;(Kernel, gcvTRUE, &lt;b&gt;node-&amp;gt;VidMem.pool&lt;/b&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.physical,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;node-&amp;gt;VidMem.logical);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!node-&amp;gt;VidMem.kvaddr)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (node-&amp;gt;VidMem.pool == Kernel-&amp;gt;device-&amp;gt;devMemPoolType) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CreateKernelMapping&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;node-&amp;gt;VidMem.devicePool-&amp;gt;poolPhysical&lt;/b&gt;&lt;/span&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;ode-&amp;gt;VidMem.kvaddr&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_CreateKernelMapping&lt;/b&gt;(os, &lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b&gt;node-&amp;gt;VidMem.parent-&amp;gt;physical&lt;/b&gt;&lt;/span&gt;,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.offset,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;node-&amp;gt;VidMem.bytes,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;node-&amp;gt;VidMem.kvaddr&lt;/span&gt;);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="260" width="570" height="450" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-126" value="else if (vidMemBlock &amp;amp;&amp;amp; vidMemBlock-&amp;gt;object.type == gcvOBJ_VIDMEM_BLOCK) {&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="710" width="570" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-127" value="else {&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="-QamLBn5pkz0fhhn8fLs-110" vertex="1">
          <mxGeometry y="800" width="570" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-123" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-37" target="-QamLBn5pkz0fhhn8fLs-98" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2190" y="4340" as="sourcePoint" />
            <mxPoint x="2240" y="4290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-124" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-103" target="-QamLBn5pkz0fhhn8fLs-111" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1150" y="3625" as="sourcePoint" />
            <mxPoint x="1320" y="3789" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-128" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2940" y="3810" width="570" height="560" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-129" value="&lt;b&gt;gckKERNEL_MapVideoMemory(Kernel, InUserSpace, Pool, Physical, Offset, Bytes, Logical)&amp;nbsp;&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-130" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-131" value="physHandle;&lt;div&gt;logical;&lt;/div&gt;&lt;div&gt;mappingInOne = 1;&lt;br&gt;&lt;br&gt;if (Physical)&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_QueryOption&lt;/b&gt;(os, &quot;allMapInOnce&quot;, &amp;amp;mappingInOne);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="60" width="570" height="100" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-141" value="&lt;div&gt;if (mappingInOne) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; galDevice = Kernel-&amp;gt;context;&lt;br&gt;&amp;nbsp; &amp;nbsp; device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device;&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; switch(Pool) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_LOCAL_EXTERNAL:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; physHandle = (PLINUX_MDL)device-&amp;gt;externalPhysical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = device-&amp;gt;externalSize;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;br&gt;&amp;nbsp; &amp;nbsp; case gcvPOOL_SYSTEM:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; physHandle = (PLINUX_MDL)device-&amp;gt;contiguousPhysicals[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bytes = device-&amp;gt;contiguousSizes[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; physHandle = （PLINUX_MDL)Physical;&lt;br&gt;&amp;nbsp; &amp;nbsp; bytes = Bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; Offset = 0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="160" width="570" height="340" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-140" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&lt;b style=&quot;&quot;&gt;gckOS_LockPages&lt;/b&gt;(os, physHandle, bytes, gcvFALSE, &amp;amp;logical);&lt;/span&gt;&lt;br&gt;&lt;br&gt;*Logical = (gctUINT8_PTR)logical + Offset;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-128" vertex="1">
          <mxGeometry y="500" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-138" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.002;exitY=0.363;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-114" target="-QamLBn5pkz0fhhn8fLs-129" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2830" y="4290" as="sourcePoint" />
            <mxPoint x="2880" y="4240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-142" value="gc_hal_kernel_os.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3720" y="3700" width="570" height="340" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-143" value="&lt;b&gt;gckOS_LockPages(Os, Physical, Bytes, Cacheable, Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-144" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-145" value="PLINUX_MDL mdl;&lt;div&gt;PLINUX_MDL_MAP mdlMap;&lt;/div&gt;&lt;div&gt;gckALLOCATOR allocator;&lt;br&gt;&lt;br&gt;mdl = (PLINUX_MDL)Physical;&lt;/div&gt;&lt;div&gt;allocator = mdl-&amp;gt;allocator;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdlMap = &lt;b&gt;FindMdlMap&lt;/b&gt;(mdl, _GetProcessID());&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (mdlMap == gcvNULL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; mdlMap = &lt;b&gt;_CreateMdlMap&lt;/b&gt;(mdl, _GetProcessID());&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (mdlMap-&amp;gt;vmaAddr == gcvNULL)&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;allocator-&amp;gt;ops-&amp;gt;MapUser&lt;/b&gt;(allocator, mdl, mdlMap, Cacheable);&lt;br&gt;&lt;br&gt;mdlMap-&amp;gt;count++;&lt;/div&gt;&lt;div&gt;*Logical = mdlMap-&amp;gt;vmaAddr;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-142" vertex="1">
          <mxGeometry y="60" width="570" height="280" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-148" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.005;exitY=0.189;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-114" target="-QamLBn5pkz0fhhn8fLs-143" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2711" y="4173" as="sourcePoint" />
            <mxPoint x="2900" y="4139" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2960" y="3739" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-149" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-140" target="-QamLBn5pkz0fhhn8fLs-143" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2713" y="4095" as="sourcePoint" />
            <mxPoint x="3700" y="3790" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3580" y="4340" />
              <mxPoint x="3650" y="3780" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-150" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4450" y="3860" width="650" height="320" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-151" value="&lt;b&gt;reserved_mem_map_user(Allocator, Mdl, MdlMap, Cacheable)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-152" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-153" value="struct reserved_mem *res = (struct reserved_mem *)Mdl-&amp;gt;priv;&lt;div&gt;gctPOINTER userLogical = gcvNULL;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;userLogical = vm_mmap(NULL, 0L, res-&amp;gt;size, PROT_READ| PROT_WRITE, MAP_SHARED|MAP_NORESERVE, 0);&lt;br&gt;&lt;br&gt;&lt;b style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;down_write(&amp;amp;current_mm_mmap_sem);&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;do {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; struct vm_area_struct *vma = &lt;b&gt;find_vma&lt;/b&gt;(current-&amp;gt;mm, (unsigned long)userLogical);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b&gt;reserved_mem_mmap&lt;/b&gt;(Allocator, Mdl, gcvFALSE, 0, 0, Mdl-&amp;gt;numPages, vma);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;vmaAddr = userLogical + res-&amp;gt;offset_in_page;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;cacheable = gcvFALSE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; MdlMap-&amp;gt;vma = vma;&lt;/div&gt;&lt;div&gt;} while(gcvFALSE);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;&lt;b style=&quot;&quot;&gt;up_write&lt;/b&gt;(&amp;amp;current_mm_mmap_sem);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-150" vertex="1">
          <mxGeometry y="60" width="650" height="260" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-154" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-145" target="-QamLBn5pkz0fhhn8fLs-151" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="3470" y="4660" as="sourcePoint" />
            <mxPoint x="3610" y="3979" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-155" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5220" y="3860" width="650" height="260" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-156" value="&lt;b&gt;reserved_mem_map(Allocator, Mdl, Cacheable, Offset, skipPages, numPages, struct vm_area_struct *vma)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-157" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-158" value="&lt;div&gt;struct reserved_mem *res = Mdl-&amp;gt;priv;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pfn = (res-&amp;gt;start &amp;gt;&amp;gt; PAGE_SHIFT) + skipPages;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;vm_flags_set(vma, gcdVMFLAGS); //(VM_IO| VM_DONTCOPY | VM_DONTEZXPAND | VM_DONTDUMP);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if gcdENABLE_BUFFERABLE_VIDEO_MEMORY&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vma-&amp;gt;vm_page_prot = &lt;b&gt;pgprot_writecombine&lt;/b&gt;(vma-&amp;gt;vm_page_prot);&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vma-&amp;gt;vm_page_prot = &lt;b&gt;pgprot_noncached&lt;/b&gt;(vma-&amp;gt;vm_page_prot);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;remap_pfn_range&lt;/b&gt;(vma, vma-&amp;gt;vm_start + Offset, pfn, numPages &amp;lt;&amp;lt; PAGE_SHIFT, vma-&amp;gt;vm_page_prot);&lt;br&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="-QamLBn5pkz0fhhn8fLs-155" vertex="1">
          <mxGeometry y="60" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="-QamLBn5pkz0fhhn8fLs-159" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-153" target="-QamLBn5pkz0fhhn8fLs-156" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4180" y="4140" as="sourcePoint" />
            <mxPoint x="4410" y="4139" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-1" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4460" y="4380" width="570" height="240" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-2" value="&lt;b&gt;gckOS_CreateKernelMapping(Os, Physical, Pool, Offset, Bytes, *Logical)&amp;nbsp;&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="26" width="570" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="52" width="570" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-4" value="&lt;div&gt;PLINUX_MDL mdl = Physical;&lt;/div&gt;&lt;div&gt;gckALLOCATOR allocator = mdl-&amp;gt;allocator;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="60" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-5" value="&lt;div&gt;if (mdl-&amp;gt;addr) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; *Logical = mdl-&amp;gt;addr + Offset;&lt;/div&gt;&lt;div&gt;} else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;allocator-&amp;gt;ops-&amp;gt;MapKernel&lt;/b&gt;(allocator, mdl, Offset, Bytes, Logical);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Offset == 0 &amp;amp;&amp;amp; Bytes == mdl-&amp;gt;bytes) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* The whole mdl has mapped */&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mdl-&amp;gt;addr = *Logical;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-1" vertex="1">
          <mxGeometry y="100" width="570" height="140" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-7" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.998;exitY=0.777;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-114" target="qcseRaRLYhIY6nGx_bxc-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2711" y="4173" as="sourcePoint" />
            <mxPoint x="2950" y="3859" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2800" y="4419" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-8" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5220" y="4330" width="650" height="230" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-9" value="&lt;b&gt;reserved_mem_map_kernel(Allocator, Mdl, Offset, Bytes, *Logical)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="26" width="650" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-10" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="52" width="650" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-11" value="struct reserved_mem *res = (struct reserved_mem *)Mdl-&amp;gt;priv;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;void* vaddr;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#if &lt;b&gt;gcdENABLE_BUFFERABLE_VIDEO_MEMORY&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr =&amp;nbsp;&lt;b&gt;ioremap_wc&lt;/b&gt;(res-&amp;gt;start + Offset, Bytes);&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; vaddr = &lt;b&gt;ioremap&lt;/b&gt;(res-&amp;gt;start + Offset, Bytes);&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*Logical = vaddr;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-8" vertex="1">
          <mxGeometry y="60" width="650" height="170" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-12" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="qcseRaRLYhIY6nGx_bxc-5" target="qcseRaRLYhIY6nGx_bxc-9" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="4300" y="3910" as="sourcePoint" />
            <mxPoint x="4460" y="3909" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-13" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5330" y="2140" width="710" height="250" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-14" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-15" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-16" value="galDevice = Kernel-&amp;gt;context&lt;div&gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(Pool) {&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp;galDevice-&amp;gt;internalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXTERNAL:&amp;nbsp; device-&amp;gt;externalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE: device-&amp;gt;exclusiveVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_INTERNAL_SRAM:&amp;nbsp; &amp;nbsp; &amp;nbsp;Kernel-&amp;gt;sRAMVidMem[Kernel-&amp;gt;sRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; device-&amp;gt;extSRAMVidMems[device-&amp;gt;extSRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; galDevice-&amp;gt;lowContiguousVidMem;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-13" vertex="1">
          <mxGeometry y="60" width="710" height="190" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-17" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="5330" y="2470" width="710" height="250" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-18" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Pool, VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="26" width="710" height="26" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-19" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="52" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-20" value="galDevice = Kernel-&amp;gt;context&lt;div&gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; = Kernel-&amp;gt;device&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(Pool) {&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_INTERNAL:&amp;nbsp; &amp;nbsp;galDevice-&amp;gt;internalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXTERNAL:&amp;nbsp; device-&amp;gt;externalVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; device-&amp;gt;contiguousVidMems[device-&amp;gt;memIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_LOCAL_EXCLUSIVE: device-&amp;gt;exclusiveVidMem;&lt;/div&gt;&lt;div&gt;case gcvPOOL_INTERNAL_SRAM:&amp;nbsp; &amp;nbsp; &amp;nbsp;Kernel-&amp;gt;sRAMVidMem[Kernel-&amp;gt;sRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_EXTERNAL_SRAM:&amp;nbsp; &amp;nbsp; device-&amp;gt;extSRAMVidMems[device-&amp;gt;extSRAMIndex];&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM_32BIT_VA:&amp;nbsp; galDevice-&amp;gt;lowContiguousVidMem;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="qcseRaRLYhIY6nGx_bxc-17" vertex="1">
          <mxGeometry y="60" width="710" height="190" as="geometry" />
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-21" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.001;exitY=0.282;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-82" target="qcseRaRLYhIY6nGx_bxc-14" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="5160" y="2460" as="sourcePoint" />
            <mxPoint x="4360" y="3039" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qcseRaRLYhIY6nGx_bxc-22" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.004;exitY=0.779;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="-QamLBn5pkz0fhhn8fLs-82" target="qcseRaRLYhIY6nGx_bxc-18" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="5131" y="2220" as="sourcePoint" />
            <mxPoint x="5340" y="2189" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

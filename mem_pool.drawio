<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 Edg/134.0.0.0" version="26.0.5">
  <diagram name="Page-1" id="1dB5lCZi5Taqo5wlKjE4">
    <mxGraphModel dx="1056" dy="1659" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="RKsYsZY5aNLMbsADSlp9-1" value="gc_hal_kernel_linux.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="40" width="560" height="294" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-2" value="&lt;b&gt;gckKERNEL_GetVideoMemoryPool(Kernel, Poll, gckVIDMEM *VideoMemory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-5" value="switch(Pool) {" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="60" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-4" value="case &lt;b&gt;gcvPOOL_LOCAL_INTERNAL&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;internalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="86" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-7" value="case &lt;b&gt;gcvPOOL_LOCAL_EXTERNAL&lt;/b&gt;:&amp;nbsp; vm = device-&amp;gt;externalVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="112" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-10" value="case &lt;b&gt;gcvPOOL_LOCAL_EXCLUSIVE&lt;/b&gt;: vm = device-&amp;gt;exclusiveVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="138" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-9" value="case &lt;b&gt;gcvPOOL_SYSTEM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;contiguousVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;memIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="164" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-11" value="case &lt;b&gt;gcvPOOL_INTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; &amp;nbsp;vm = device-&amp;gt;sRAMVidMem[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;Kernel-&amp;gt;sRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="190" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-12" value="case &lt;b&gt;gcvPOOL_EXTERNAL_SRAM&lt;/b&gt;:&amp;nbsp; &amp;nbsp; vm = device-&amp;gt;extSRAMVidMems[&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;device-&amp;gt;extSRAMIndex&lt;/span&gt;];" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="216" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-13" value="case &lt;b&gt;gcvPOOL_SYSTEM_32BIT_VA&lt;/b&gt;:&amp;nbsp; &amp;nbsp;vm = galDevice-&amp;gt;lowContiguousVidMem;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="242" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-8" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-1" vertex="1">
          <mxGeometry y="268" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-14" value="gc_hal_kernel_device.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="880" y="-660" width="560" height="978" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-15" value="&lt;b&gt;gckGALDEVICE_Construct(*Platform, *Args, *Device)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="26" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-16" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="52" width="560" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-17" value="gal_device-&amp;gt;externalSize[i] = Args-&amp;gt;externalSize[i]" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="60" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-65" value="&lt;div&gt;if (gal_device-&amp;gt;externalSize[i] &amp;gt; 0) {&lt;/div&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="90" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-26" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalVidMem[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="120" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-27" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;externalBase[i], gal_device-&amp;gt;externalSize[i],&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;externalPhysical[i]&lt;/span&gt;);&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="190" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-47" value="&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;//physical 其实是 PLINUX_MDL&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;externalPhysical[i]-&amp;gt;physical = gal_device-&amp;gt;externalPhysical[i];&lt;/span&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="260" width="560" height="50" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-25" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="310" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-60" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="336" width="560" height="74" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-61" value="if (gal_device-&amp;gt;exclusiveSize[i] &amp;gt; 0) {" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;fontColor=#333333;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="410" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-62" value="&amp;nbsp; &amp;nbsp; &lt;b&gt;gckVIDMEM_Construct&lt;/b&gt;(os,&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;64, 0,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusiveVidMem[i]&lt;/span&gt;);&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;(os,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gal_device-&amp;gt;exclusiveBase[i], gal_device-&amp;gt;exclusiveSize[i],&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; name, gcvTRUE,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;&amp;amp;gal_device-&amp;gt;exclusivePhysical[i]&lt;/span&gt;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = ((LINUX_MDL)gal_device-&amp;gt;exclusivePhysical[i])-&amp;gt;allocator;&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;physical = gal_device-&amp;gt;exclusivePhysical[i];&lt;/span&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;gal_device-&amp;gt;exclusiveVidMem[i]-&amp;gt;capability |= allocator-&amp;gt;capability;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="436" width="560" height="214" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-63" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="650" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-66" value="" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="676" width="560" height="224" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-67" value="{" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="900" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-68" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="926" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-59" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-14" vertex="1">
          <mxGeometry y="952" width="560" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-28" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-7" target="RKsYsZY5aNLMbsADSlp9-65" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="980" y="180" as="sourcePoint" />
            <mxPoint x="1140" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-29" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1680" y="-1080" width="530" height="726" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-30" value="&lt;b&gt;gckVIDMEM_Construct(Os, PhysicalBase, Bytes, Threshold, BankSize, *Memory)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-32" value="gckOS_Allocate(Os, sizeof(struct _gckVIDMEM), &amp;amp;pointer);&lt;br&gt;memory = pointer" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="60" width="530" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-33" value="&lt;div&gt;memory-&amp;gt;object.type = gcvOBJ_VIDMEM;&lt;/div&gt;&lt;div&gt;...&lt;br&gt;memory-&amp;gt;physicalBase&amp;nbsp; = PhysicalBase;&lt;br&gt;memory-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&amp;nbsp; &amp;nbsp; &amp;nbsp;//Bytes&lt;br&gt;memory-&amp;gt;freeBytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = heapBytes;&lt;br&gt;memory-&amp;gt;minFreeBytes = heapBytes;&lt;br&gt;memory-&amp;gt;capability&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = ~0u;&lt;br&gt;memory-&amp;gt;threshold&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Threshold;&lt;br&gt;memory-&amp;gt;mutex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="100" width="530" height="140" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-34" value="&lt;div&gt;for (i = 0; i &amp;lt; gcmCOUNTOF(memory-&amp;gt;sentinel); ++i) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckOS_Allocate(Os, sizeof(gcuVIDMEM_NODE), &amp;amp;pointer);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node = pointer;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;node-&amp;gt;VidMem.parent = memory;&lt;/span&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.next = .....prev = .....nextFree = .....prevFree = &amp;amp;memory-&amp;gt;sentinel[i];&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.nextReserved = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.offset = base;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.bytes = bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.aligment = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.pool = gcvPOOL_DEFAULT;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.locked = 0;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.processID = 0;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.logical = gcvNULL;&lt;br&gt;&amp;nbsp; &amp;nbsp; node-&amp;gt;VidMem.kvaddr = gcvNULL;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.next = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prev = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.nextFree = node;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; memory-&amp;gt;sentinel[i].VidMem.prevFree = node;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;-&amp;gt;sentinel[i].VidMem.bytes = 0;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;memory&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;-&amp;gt;sentinel[i].VidMem.nextReserved = gcvNULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; base += bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; heapBytes -= bytes;&lt;br&gt;&amp;nbsp; &amp;nbsp; banks++;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/* Assign all the bank mappings */&lt;br&gt;memory-&amp;gt;mapping[xxxxx] = bank xxxx&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="240" width="530" height="460" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-35" value="}" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-29" vertex="1">
          <mxGeometry y="700" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-36" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-26" target="RKsYsZY5aNLMbsADSlp9-30" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="109" as="sourcePoint" />
            <mxPoint x="750" y="-261" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-37" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1680" y="-240" width="530" height="452" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-38" value="&lt;b&gt;gckOS_RequestReservedMemory&lt;/b&gt;&lt;b&gt;(Os, Start, Size, Name, Requested, MemoryHandle)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="26" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-39" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="52" width="530" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-40" value="gckALLOCATOR allocator;&lt;div&gt;gcsATTACH_DESC desc;&lt;/div&gt;&lt;div&gt;&lt;br&gt;Size = (Size + ~PAGE_MASK) &amp;amp; PAGE_MASK;&lt;/div&gt;&lt;div&gt;mdl = _CreateMdl(Os, gcvNULL);&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="60" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-41" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;desc.reservedMem.start&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Start;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;desc.reservedMem.size&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Size;&lt;/div&gt;&lt;div&gt;desc.reservedMem.name&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = Name;&lt;/div&gt;&lt;div&gt;desc.reservedMem.requested = Requested;&lt;br&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;desc.reservedMem.root&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="150" width="530" height="90" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-49" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;allocator = _FindAllocator(Os, gcvALLOC_FLAG_LINUX_RESERVED_MEM);&lt;br&gt;allocator-&amp;gt;ops-&amp;gt;Attach(allocator, &amp;amp;desc, mdl);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;allocator&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = allocator;&lt;br&gt;mdl-&amp;gt;bytes&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= Size;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;numPages&amp;nbsp; &amp;nbsp; = Size &amp;gt;&amp;gt; PAGE_SHIFT;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;contiguous&amp;nbsp; &amp;nbsp;= gcvTRUE;&lt;/div&gt;&lt;div&gt;mdl-&amp;gt;addr&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = gcvNULL;&lt;br&gt;mdl-&amp;gt;dmaHandle&amp;nbsp; = Start;&lt;br&gt;mdl-&amp;gt;device&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= gcvNULL;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="240" width="530" height="160" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-48" value="list_add_tail(&amp;amp;mdl-&amp;gt;link, &amp;amp;Os-&amp;gt;mdlHead);" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="400" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-43" value="*MemoryHandle = (void *) mdl;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-37" vertex="1">
          <mxGeometry y="426" width="530" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-44" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-27" target="RKsYsZY5aNLMbsADSlp9-38" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1310" y="-165" as="sourcePoint" />
            <mxPoint x="1690" y="-1031" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-50" value="gc_hal_kernel_allocator_reserved_mem.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="30" width="490" height="510" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-51" value="&lt;b&gt;reserved_mem_attach(Allocator, Desc, Mdl)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-52" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-54" value="struct reserved_mem_alloc *alloc = Allocator-&amp;gt;privateData&lt;br&gt;struct reserved_mem *res;&lt;div&gt;struct resource *region;&lt;br&gt;&lt;br&gt;res = kzalloc(sizeof(res), GFP_KERNEL | gcdNOWARN);&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="60" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-55" value="res-&amp;gt;start = Desc-&amp;gt;reservedMem.start;&lt;br&gt;res-&amp;gt;size&amp;nbsp; = Desc-&amp;gt;reservedMem.size;&lt;br&gt;res-&amp;gt;offset_in_page = Desc-&amp;gt;reservedMem.start &amp;amp; (PAGE_SIZE - 1);&lt;br&gt;strncpy(res-&amp;gt;name, Desc-&amp;gt;reservedMem.name, sizeof(res-&amp;gt;name) - 1);&lt;div&gt;res-&amp;gt;release = 0;&lt;br&gt;res-&amp;gt;root = Desc-&amp;gt;reservedMem.root;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="140" width="490" height="100" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-56" value="if (Desc-&amp;gt;reservedMem.root) {&lt;div&gt;&amp;nbsp; &amp;nbsp; if (!Desc-&amp;gt;reservedMem.requested) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; region = request_mem_region(res-&amp;gt;start, res-&amp;gt;size, res-&amp;gt;name);&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!resgion) { kfree(res); return OUT_OF_RESOURCES; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; res-&amp;gt;release = 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; list_add(&amp;amp;res-&amp;gt;link, &amp;amp;alloc-&amp;gt;region);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Mdl-&amp;gt;priv = res;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="240" width="490" height="190" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-57" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;gckOS_CPUPhysicalToGPUPhysical(os, (res-&amp;gt;start + res-&amp;gt;size - 1), &amp;amp;gpu_end);&lt;br&gt;&lt;br&gt;if (gpu_end &amp;lt;= 0xFFFF_FFFF) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp; &amp;nbsp; Allocator-&amp;gt;capability |= gcvALLOC_FLAG_4GB_ADDR;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="RKsYsZY5aNLMbsADSlp9-50" vertex="1">
          <mxGeometry y="430" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-58" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-49" target="RKsYsZY5aNLMbsADSlp9-51" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2270" y="-50" as="sourcePoint" />
            <mxPoint x="1690" y="-261" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-64" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-10" target="RKsYsZY5aNLMbsADSlp9-61" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="610" y="135" as="sourcePoint" />
            <mxPoint x="750" y="-165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RKsYsZY5aNLMbsADSlp9-69" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="RKsYsZY5aNLMbsADSlp9-9" target="RKsYsZY5aNLMbsADSlp9-67" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="750" y="190" as="sourcePoint" />
            <mxPoint x="910" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0" version="25.0.3">
  <diagram name="Page-1" id="klpA_2AShYlU7AM5QuSL">
    <mxGraphModel dx="1334" dy="2991" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-1" value="drv_api.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="140" y="290" width="550" height="256" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-2" value="&lt;span style=&quot;font-weight: 700; text-align: center;&quot;&gt;drvMemAlloc_v2(CUdeviceptr *dptr, size_t bytesize)&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="26" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="52" width="550" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-9" value="CURRENT_CTX(ctx)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="60" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-4" value="&lt;b&gt;drvCtxSynchronize()&lt;/b&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="86" width="550" height="24" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-12" value="&lt;div&gt;allocMemoryInfo_t info&lt;/div&gt;&lt;div&gt;info.size = bytesize&lt;/div&gt;&lt;b&gt;node = allocDeviceMemory&lt;/b&gt;(gpgpuPLS.drvDevices[ctx-&amp;gt;device], info)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="110" width="550" height="50" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-11" value="Node = os_calloc(...)&lt;div&gt;Node-&amp;gt;hostAlloc = false, -&amp;gt;ctx = ctx, node = node&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;utilMapAdd&lt;/b&gt;(ctx-&amp;gt;devPtrMap, Node, node-&amp;gt;gpuLogical, node-&amp;gt;size)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="160" width="550" height="70" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-10" value="*dptr = Node-&amp;gt;node-&amp;gt;gpuLogical" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-1">
          <mxGeometry y="230" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-13" value="drv_api.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="830" y="130" width="510" height="170" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-14" value="&lt;span style=&quot;font-weight: 700; text-align: center;&quot;&gt;drvCtxSynchronize()&lt;/span&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry y="26" width="510" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-15" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry y="52" width="510" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-16" value="CURRENT_CTX(ctx)&lt;div&gt;&amp;nbsp; &amp;nbsp; ---&amp;gt; &lt;b&gt;getCurrentContext&lt;/b&gt;()&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry y="60" width="510" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-17" value="&lt;div&gt;&lt;b&gt;ctxSynchronzie(ctx)&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry y="100" width="510" height="24" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-18" value="&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;b&gt;trimMemPool&lt;/b&gt;(gpgpuPLS.drvDevices[ctx-&amp;gt;device]-&amp;gt;memPool,&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; gpgpuPLS.drvDevices[ctx-&amp;gt;device]-&amp;gt;memPool-&amp;gt;attr.attrReleaseThreashold)&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry y="124" width="510" height="46" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-21" value="stream.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1470" y="76" width="410" height="254" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-22" value="&lt;span style=&quot;font-weight: 700; text-align: center;&quot;&gt;ctxSynchronize(CUcontext ctx)&lt;/span&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-21">
          <mxGeometry y="26" width="410" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-23" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-21">
          <mxGeometry y="52" width="410" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-24" value="it = os_list_iterator(ctx-&amp;gt;streams)&lt;div&gt;while(it) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; CUstream s = it-&amp;gt;data&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;blockHalQueue&lt;/b&gt;(s-&amp;gt;halQueue)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;waitHalQueueIdle&lt;/b&gt;(s-&amp;gt;halQueue)&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;it = os_list_iterator(ctx-&amp;gt;streams)&lt;/div&gt;&lt;div&gt;&lt;div&gt;while(it) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; CUstream s = it-&amp;gt;data&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;unblockHalQueue&lt;/b&gt;(s-&amp;gt;halQueue)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-21">
          <mxGeometry y="60" width="410" height="170" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-25" value="&lt;div&gt;&lt;b&gt;ctxSynchronzie(ctx)&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-21">
          <mxGeometry y="230" width="410" height="24" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-27" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-4" target="NuDpKzAwzLJSV5Tyi5Um-13">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="890" y="360" as="sourcePoint" />
            <mxPoint x="970" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-28" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-17" target="NuDpKzAwzLJSV5Tyi5Um-21">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="700" y="268" as="sourcePoint" />
            <mxPoint x="860" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-29" value="memory.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="830" y="420" width="510" height="150" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-30" value="&lt;b&gt;allocDeviceMemory(gpgpuDevice_t *device, allocMemoryInfo_t* info)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-29">
          <mxGeometry y="26" width="510" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-31" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-29">
          <mxGeometry y="52" width="510" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-32" value="info-&amp;gt;poolType = &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;POOL_DEFAULT&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (!devInfo-&amp;gt;fullVA64) { info-&amp;gt;force32Bit = 1}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;allocMemory&lt;/b&gt;(device-&amp;gt;processor, &amp;amp;node, info)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-29">
          <mxGeometry y="60" width="510" height="90" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-33" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-12" target="NuDpKzAwzLJSV5Tyi5Um-29">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="700" y="398" as="sourcePoint" />
            <mxPoint x="840" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-34" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1470" y="480" width="550" height="574" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-35" value="&lt;b&gt;allocMemory(processor, node, info)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="26" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-36" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="52" width="550" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-37" value="iface = { &lt;b&gt;gcvHAL_ALLOCATE_LINEAR_VIDEO_MEMORY &lt;/b&gt;}&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.hardwareType = processor-&amp;gt;coreTypes[0]&lt;/div&gt;&lt;div&gt;iface.coreIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;coreIndexs[0]&lt;/div&gt;&lt;div&gt;iface.devIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;kmdNodeIndex&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.u.AllocateLinearVideoMemory.alignment = 256&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .bytes = info-&amp;gt;size&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool = info-&amp;gt;poolType&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .type = &lt;b style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;gcvSURF_INDEX&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag |= ??? 32BIT_VA&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .flag |= ??? gcvALLOC_FLAG_UVM&lt;/div&gt;&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;KmdIoCtl(...)&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="60" width="550" height="200" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-46" value="memoryNode_PTR pNode = os_calloc(...)&lt;div&gt;pNode-&amp;gt;handle = iface.u.AllocateLinearVideoMemory.node&lt;/div&gt;&lt;div&gt;pNode-&amp;gt;pool&amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .pool&lt;br&gt;pNode-&amp;gt;size&amp;nbsp; &amp;nbsp; &amp;nbsp;=&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.bytes&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.command = {&lt;b&gt;gcvHAL_LOCK_VIDEO_MEMORY&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;iface.u.LockVideoMemory.node = pNode-&amp;gt;handle&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.op = (gceLOCK_VIDEO_MEMORY_OP) &lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;(gcvLOCK_VIDEO_MEMORY_OP_LOCK&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; | gcvLOCK_VIDEO_MEMORY_OP_MAP)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.cacheable = false&lt;/div&gt;&lt;div&gt;KmdIoCtl(...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="260" width="550" height="210" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-45" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="470" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-44" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="496" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-43" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="522" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-42" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry y="548" width="550" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-47" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2100" y="670" width="340" height="160" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-48" value="&lt;b&gt;gckDEVICE_Dispatch(gckDEVICE Device, Interface)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-47">
          <mxGeometry y="26" width="340" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-49" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-47">
          <mxGeometry y="52" width="340" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-50" value="&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;coreIndex = Interface-&amp;gt;coreIndex&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;kernel = Device-&amp;gt;kernels[coreIndex]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_DIspatch&lt;/b&gt;(kernel, Device, Interface)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-47">
          <mxGeometry y="60" width="340" height="100" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-51" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2560" y="-430" width="630" height="580" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-52" value="&lt;b&gt;_AllocateLinearMemory(Kernel, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="26" width="630" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-53" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="52" width="630" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-54" value="if (Interface-&amp;gt;u.AllocateLinearVideoMemory.&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;sRAMIndex &lt;/b&gt;&amp;gt; =0)&lt;div&gt;&amp;nbsp; &amp;nbsp; Kernel-&amp;gt;sRAMIndex = Interface-&amp;gt;u.AllocateLinearVideoMemory.sRAMIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Interface-&amp;gt;u.AllocateLinearVideoMemory.&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;extS&lt;b style=&quot;&quot;&gt;RAMIndex&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&amp;gt; =0)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Kernel-&amp;gt;device-&amp;gt;extSRAMIndex = Interface-&amp;gt;u.AllocateLinearVideoMemory.extSRAMIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;if (Interface-&amp;gt;u.AllocateLinearVideoMemory.&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;vidMemIndex&amp;nbsp;&lt;/span&gt;&amp;gt; =0)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Kernel-&amp;gt;device-&amp;gt;memIndex =&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Interface-&amp;gt;u.AllocateLinearVideoMemory.vidMemIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;gckOS_QueryOption(os, &quot;allMapInOne&quot;, &amp;amp;mappingInOne)&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //1&lt;/b&gt;&lt;/div&gt;&lt;div&gt;if (mappingInOne == 0) { alignment = ALIGN(alignment, 4096)&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="60" width="630" height="170" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-63" value="&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gckKERNEL_AllocateVideoMemory&lt;/b&gt;(Kernel,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;alignment,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 256&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;type,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // gcv_VIDMEM_TYPE_INDEX_BUFFER&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;flag,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;0100_0000_1000_0000_0000&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;byte,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 40000&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;pool,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// gcv_POOL_DEFAULT&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;amp;nodeObject)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="230" width="630" height="110" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-62" value="&lt;b&gt;gckVIDMEM_HANDLE_Allocate&lt;/b&gt;(Kernel, nodeObject, &amp;amp;handle)" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="340" width="630" height="50" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-61" value="Interface-&amp;gt;u.AllocateLinearVideoMemory.node = handle&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.pool&amp;nbsp; = pool&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;.bytes = bytes&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;dbType = gcvDB_VIDEO_MEMORY | (type &amp;lt;&amp;lt; gcdDB_VIDEO_MEMORY_TYPE_SHIFT) |&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (pool &amp;lt;&amp;lt; gcdDB_VIDEO_MEMORY_POOL_SHIFT)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckVIDMEM_NODE_IsContiguous&lt;/b&gt;(..., nodeObject, &amp;amp;&lt;b&gt;isContiguous&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;if (isContiguous) dbType |= gcvDB_CONTIGUOUS &amp;lt;&amp;lt; gcdDB_VIDEO_MEMORY_DBTYPE_SHIFT)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//添加到进程相关的数据库中&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;b&gt;gckKERNEL_AddProcessDB&lt;/b&gt;(Kernel, ProcessID, dbType, handle, NULL, bytes)&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry y="390" width="630" height="190" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-56" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-37" target="NuDpKzAwzLJSV5Tyi5Um-47">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="1890" y="660" as="sourcePoint" />
            <mxPoint x="2020" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-55" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-32" target="NuDpKzAwzLJSV5Tyi5Um-34">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="1350" y="252" as="sourcePoint" />
            <mxPoint x="1480" y="86" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-64" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-50" target="NuDpKzAwzLJSV5Tyi5Um-51">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="1890" y="753" as="sourcePoint" />
            <mxPoint x="2020" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-65" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="3280" y="-1350" width="810" height="1640" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-66" value="&lt;b&gt;gckKERNEL_AllocateVideoMemory(Kernel, Alignment, Type, Flag, Bytes, Pool, NodeObject)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="26" width="810" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-67" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="52" width="810" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-68" value="&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;//设置FLAG&amp;nbsp;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;//USE_LINUX_PCIE&lt;/b&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;Flag &amp;amp;= ~gcvALLOC_FLAG_CACHEABLE&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;dyncmicAllocLocal = false&lt;/div&gt;&lt;div&gt;contiguous = 0, cacheable = Flag &amp;amp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;gcvALLOC_FLAG_CACHEABLE&lt;/span&gt;, secure = 0&lt;br&gt;&lt;br&gt;if (&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;!Kernel-&amp;gt;hardware-&amp;gt;options.enableMMU&lt;/span&gt;) { contiguous = true}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//下面一些flag 可以关注一下&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; gcvALLOC_FLAG_ALLOC_ON_FAULT) Pool = &lt;b&gt;gcvPOOL_VIRTUAL&lt;/b&gt;&lt;/div&gt;&lt;div&gt;elseif (FLAG &amp;amp; gcvALLOC_FLAG_NON_CPU_ACCESS) Pool = &lt;b&gt;gcvPOOL_LOCAL_EXCLUSIVE&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Flag&amp;amp;(gcvALLOC_FLAG_32BIT_VA|gcvALLOC_FLAG_PRIOR_32BIT_VA)) &amp;amp;&amp;amp;&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; Pool != gcvPOOLEXTERNAL_SRAM) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;reserve32bitVA) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Kernel-&amp;gt;device-&amp;gt;externalSize)&amp;nbsp; &amp;nbsp; &amp;nbsp;Pool = gcvPOOL_LOCAL_EXTERNAL&amp;nbsp; &amp;nbsp; &amp;nbsp; //0&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;Pool = &lt;b&gt;gcvPOOL_SYSTEM_32BIT_VA&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else Flag &amp;amp;= ~(&lt;span style=&quot;background-color: initial;&quot;&gt;gcvALLOC_FLAG_32BIT_VA|gcvALLOC_FLAG_PRIOR_32BIT_VA)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//应为是DMA Export, 之后会被 Import 到DRM， DRM要求按照pageSize对齐&lt;/span&gt;&lt;/div&gt;&lt;div&gt;if (Flag &amp;amp; &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gcvALLOC_FLAG_DMABUF_EXPORTABLE&lt;/b&gt;) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckOS_GetPageSize(os, &amp;amp;pageSize)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; bytes= ALIGN(bytes, pageSize)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Alignment = pageSize&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Type == gcvVIDMEM_TYPE_COMMAND) { ...}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;if (Flag &amp;amp; &lt;b&gt;gcvALLOC_FLAG_UVM&lt;/b&gt;) {...}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="60" width="810" height="510" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-81" value="&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;//设置init pool&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;AllocateMemory:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;if (&lt;b&gt;Kernel-&amp;gt;vGPUType&lt;/b&gt; == gcvVGPU_MDEV) {...}&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Pool == &lt;b&gt;gcvPOOL_SYSTEM_32BIT_VA &lt;/b&gt;&amp;amp;&amp;amp; Kernel-&amp;gt;device-&amp;gt;lockLargeVA == true)&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;Pool = gcvPOOL_SYSTEM&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;switch(pool = *Pool) {&lt;/div&gt;&lt;div&gt;case gcvPOOL_DEFAULT, gcvPOOL_LOCAL:&amp;nbsp;&lt;/div&gt;&lt;div&gt;case gcvPOOL_SYSTEM:&lt;/div&gt;&lt;div&gt;default: loopCount = 1&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if (Kernel-&amp;gt;reserve32bitVA &amp;amp;&amp;amp; (Flag &amp;amp; (gcvALLOC_FLAG_PRIOR_32BIT_VA | gcvALLOC_FLAG_32BIT_VA))&lt;br&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;&amp;nbsp; &amp;nbsp; loopCount = gcvPOOL_NUMBER_OF_POOLS&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//13&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="570" width="810" height="280" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-82" value="&lt;div&gt;&lt;b&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;//分配内存&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;while(loopCount-- &amp;gt; 0) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pool==gcvPOOL_VIRTUAL || FLAG &amp;amp; gcvALLOC_FLAG_DYNCMIC_ALLOC_LOCAL) {&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (cacheable == false &amp;amp;&amp;amp; secure == false) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//从pool中获取gckVIDMEM&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; status =&amp;nbsp;&lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gckKERNEL_GetVideoMemoryPool&lt;/b&gt;(Kernel, pool, &amp;amp;&lt;b&gt;videoMemory&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (status) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(230, 230, 230);&quot;&gt;//检查allocator的 capability, 大小&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Flag &amp;amp; videoMemory-&amp;gt;capability) != Flag) status = &lt;b&gt;gcvSTAUTUS_NOT_SUPPORTED&lt;/b&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else if (bytes &amp;gt; gcdLINEAR_SIZE_LIMIT) { status = &lt;b&gt;gcvSTATUS_OUT_OF_MEMORY &lt;/b&gt;}&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; hasFastPools = true&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; status =&amp;nbsp;&lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gckVIDMEM_NODE_AllocateLinear&lt;/b&gt;(Kernel, &lt;b&gt;videoMemory&lt;/b&gt;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; pool,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Type,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //gcvVIDMEM_TYPE_INDEX_BUFFER&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Flag,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Alignment,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; specified,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;//true: pool == gcvPOOL_SYSTEM/INERNAL_SRAM/EXTERNAL_SRAM/SYSTEM_32BIT_VA&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;bytes, &amp;amp;nodeObject)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;b&gt;if (status) { break; } else { ...}&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } // status&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //如果分配不成功, 切换POOL&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (pool == gcvPOOL_LOCAL) {--&amp;gt; gcvPOOL_LOCAL_INTERNAL&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (pool == gcvPOOL_LOCAL_INTERNAL)&amp;nbsp; {&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (pool == gcvPOOL_LOCAL_EXTERNAL) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;pool = gcvPOOL_LOCAL_EXCLUSIVE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;if (TYPE == gcvVIDMEM_TYPE_FENCE) pool = gcvPOOL_SYSTEM&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (pool = gcvPOOL_LOCAL_EXCLUSIVE) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;... 切换 FLAG 或者 pool = gcvPOOL_INTERNAL_SRAM/gcvPOOL_SYSTEM&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (pool == gcvPOOL_INTERNAL_SRAM) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;sRAMIndex ++; 如果srAMIndex用完, 切换到 gcvPOOL_SYSTEM&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (pool == gcvPOOL_SYSTEM {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;如果要使用fast pool gcvSTATUS_OUT_OF_MEMMORY&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else if (Kernel-&amp;gt;reserve32bitVA) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else { &lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;gcvSTATUS_OUT_OF_MEMORY &lt;/b&gt;}&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;} //while&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="850" width="810" height="680" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-80" value="if (nodeObject == NULL {&amp;nbsp;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (contiguous) { gckOS_Broadcase(... gcvBROADCAST_OUT_OF_MEMORY }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; gckOS_Delay(NULL, 1)&lt;br&gt;&amp;nbsp; &amp;nbsp; goto &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;AllocateMemory&lt;/b&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry y="1530" width="810" height="110" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-69" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-63" target="NuDpKzAwzLJSV5Tyi5Um-65">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2360" y="600" as="sourcePoint" />
            <mxPoint x="2500" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-70" value="gc_hal_kernel_video_memory.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="3280" y="370" width="670" height="330" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-71" value="&lt;b&gt;gckVIDMEM_HANDLE_Allocate(Kernel, Node, *Handle)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-70">
          <mxGeometry y="26" width="670" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-72" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-70">
          <mxGeometry y="52" width="670" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-73" value="gckOS_Allocate(os, sizeof(gcsVIDMEM_HANDLE), &amp;amp;pointer)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_ZeroMemory(pointer, ...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOK_AtomConstruct(os, &amp;amp;handleObject-&amp;gt;reference)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_AtomSet(os, handleObject-&amp;gt;reference, 1)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckOS_GetProcessID&lt;/b&gt;(&amp;amp;processID)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;gckOS_FindHandleDatabase(Kernel, processID, &amp;amp;handleDatabase, &amp;amp;mutex)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;gckKERNEL_AllocateIntegerId&lt;/b&gt;(handleDatabase, handleObject, &amp;amp;handle)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;handleObject-&amp;gt;node =Node&lt;/div&gt;&lt;div&gt;handleObject-&amp;gt;handle = handle&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//此处返回的handle 只是 database 的 item ID&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;*Handle = handle&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-70">
          <mxGeometry y="60" width="670" height="270" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-74" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-62" target="NuDpKzAwzLJSV5Tyi5Um-70">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="3130" y="723" as="sourcePoint" />
            <mxPoint x="3250" y="385" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-76" value="Classname" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="4200" y="-910" width="590" height="86" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-77" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-76">
          <mxGeometry y="26" width="590" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-78" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-76">
          <mxGeometry y="52" width="590" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-79" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-76">
          <mxGeometry y="60" width="590" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-84" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-82" target="NuDpKzAwzLJSV5Tyi5Um-76">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="3130" y="855" as="sourcePoint" />
            <mxPoint x="3290" y="1420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-86" value="gc_hal_kernel.c" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2550" y="910" width="620" height="86" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-87" value="&lt;b&gt;_LockVideoMemory(Kernel, Core, ProcessID, Interface)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-86">
          <mxGeometry y="26" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-88" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-86">
          <mxGeometry y="52" width="620" height="8" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-89" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="NuDpKzAwzLJSV5Tyi5Um-86">
          <mxGeometry y="60" width="620" height="26" as="geometry" />
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-90" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-46" target="NuDpKzAwzLJSV5Tyi5Um-47">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2030" y="855" as="sourcePoint" />
            <mxPoint x="2090" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NuDpKzAwzLJSV5Tyi5Um-92" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="NuDpKzAwzLJSV5Tyi5Um-50" target="NuDpKzAwzLJSV5Tyi5Um-86">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="2030" y="855" as="sourcePoint" />
            <mxPoint x="2110" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

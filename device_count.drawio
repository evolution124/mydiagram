<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0" version="25.0.3">
  <diagram name="Page-1" id="c9IRMGv52xxvMqEI-bAp">
    <mxGraphModel dx="2239" dy="1952" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-1" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="70" width="440" height="212" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-2" value="&lt;b&gt;initHal()&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="26" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="52" width="440" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-4" value="&lt;div&gt;&lt;b&gt;initKMD()&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="60" width="440" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-17" value="for (int i=0; i&amp;lt;kmdNodeCount; i++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 229, 153);&quot;&gt;OpenKMD&lt;/b&gt;(&amp;amp;handle, i)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;&lt;b&gt;sKmdHandle[sHalKmodNodeCount] = handle&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;&lt;b&gt;sHalKmodNodeCount&lt;/b&gt;&lt;/font&gt;++&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="80" width="440" height="80" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-19" value="queryAllChipInfo()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="160" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-16" value="initCompiler()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry y="186" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-5" value="cudaGetDevice" style="html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1420" y="60" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-6" value="cudaSetDevice" style="html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1420" y="162" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-7" value="cudaGetDeviceCount" style="html=1;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1420" y="-50" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-8" value="kmd_linux.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="-100" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-9" value="&lt;b&gt;initKMD()&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-8">
          <mxGeometry y="26" width="360" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-10" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-8">
          <mxGeometry y="52" width="360" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-11" value="for (int i = 0; i &amp;lt; 100; i++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; GetNodeName(filename, i) // 填充 /dev/galcore%s&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; int node = open(filename, O_RDWR)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (-1 == node) { &lt;font color=&quot;#ff3333&quot;&gt;&lt;b&gt;sKmdNodeCount &lt;/b&gt;&lt;/font&gt;= i)&amp;nbsp; &amp;nbsp; &amp;nbsp;//记录device 数量&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-8">
          <mxGeometry y="60" width="360" height="100" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-18" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-4" target="pcVGzkrLHwzF4EQMK3bM-8">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="760" y="270" as="sourcePoint" />
            <mxPoint x="840" y="270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-20" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="110" width="360" height="190" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-21" value="&lt;b&gt;queryAllChipInfo&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-20">
          <mxGeometry y="26" width="360" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-22" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-20">
          <mxGeometry y="52" width="360" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-23" value="iface = { &lt;b&gt;gcvHAL_CHIP_INFO&lt;/b&gt; }&lt;div&gt;iface.command = &lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;gcvHAL_CHIP_INFO&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;for (int i =0; i&amp;lt;sHalKmodNodeCount; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; KmdIoCtl(...)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;sChipInfoExtra[i].handle = handle&lt;/font&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;sChipInfoExtra[i].kmdIndex = i&lt;/font&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-20">
          <mxGeometry y="60" width="360" height="130" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-24" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-19" target="pcVGzkrLHwzF4EQMK3bM-20">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="710" y="150" as="sourcePoint" />
            <mxPoint x="830" y="-90" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-25" value="device.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-410" y="420" width="400" height="220" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-26" value="&lt;b&gt;initDriver(void)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="26" width="400" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-27" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="52" width="400" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-28" value="&lt;b&gt;initHal()&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="60" width="400" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-39" value="&lt;b&gt;configMultipleProcessor()&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="80" width="400" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-38" value="count = &lt;b&gt;getProcessorCount()&lt;/b&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;--&amp;gt; sHalProcessorCount&lt;/b&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="106" width="400" height="44" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-37" value="for (int i=0; i&amp;lt;count; i++) {&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;createProcessor(i, &amp;amp;processor)&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;gpgpuPLS.deviceCount++&lt;/b&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-25">
          <mxGeometry y="150" width="400" height="70" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-40" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-28" target="pcVGzkrLHwzF4EQMK3bM-1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="710" y="253" as="sourcePoint" />
            <mxPoint x="830" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-42" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="350" width="575" height="440" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-43" value="&lt;b&gt;configMultipleProcessor()&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-42">
          <mxGeometry y="26" width="575" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-44" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-42">
          <mxGeometry y="52" width="575" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-45" value="sHalProcessorCount = 0;&lt;div&gt;&lt;b style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//Core是否统一使用&lt;/b&gt;&lt;/div&gt;&lt;div&gt;isCombineMode = 0 == getEnvInt32(&quot;&lt;b&gt;VIV_MGPU_AFFINITY&lt;/b&gt;&quot;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//通过 &lt;b&gt;VIV_OCL_USE_MULTI_DEVICE &lt;/b&gt;指定 每个device的core count&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//格式为 1&amp;nbsp; 1:1&amp;nbsp; 1:2 1:4&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;//设置 &lt;b&gt;coreCountPerDevice&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;for (int i=0; i&amp;lt; &lt;b&gt;sHalKmodNodeCount&lt;/b&gt;; i++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //配置sHalProcessors的core分配, 注意sHalProcessors的数量也是有效sHalKmodNodeCount的数量&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (isCombineMode) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; count = info-&amp;gt;count //core 的数量(MP 数量)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;sHalProcessors[sHalProcessorCount].devIdx = i&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; sHalProcessors[sHalProcessorCount].coreCount= count&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;sHalProcessorCount++&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; //分拆&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int count = info-&amp;gt;count / coreCountPerDevice&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (j=0; j&amp;lt;coreCountPerDevice; j++) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //更新sHalProcessors[]&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 204);&quot;&gt;sHalProcessors[sHalProcessorCount].devIdx = i&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;b style=&quot;background-color: initial;&quot;&gt;sHalProcessorCount++&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-42">
          <mxGeometry y="60" width="575" height="380" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-46" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-39" target="pcVGzkrLHwzF4EQMK3bM-42">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="130" y="430" as="sourcePoint" />
            <mxPoint x="270" y="80" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-48" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="870" width="490" height="322" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-49" value="&lt;b&gt;createProcessor(int idx, processor_PTR *processor)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="26" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-50" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="52" width="490" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-51" value="pProcessor = os_calloc()&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pProcessor-&amp;gt;kmdHandle = sChipInfoExtra[sHalProcessors[idx].devIdx].handle&lt;/div&gt;&lt;div&gt;pProcessor-&amp;gt;kmdNodeIndex = sChipInfoExtra[sHalProcessors[idx].devIdx].kmdIndex&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="60" width="490" height="80" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-58" value="&lt;b&gt;attachToKMD(pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="140" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-57" value="&lt;b&gt;queryChipInfo(pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="166" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-59" value="&lt;b&gt;fillLegacyInfo(pProcessor-&amp;gt;legacyInfo)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="192" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-60" value="&lt;b&gt;fillProcessorInfo(pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="218" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-61" value="&lt;b&gt;fillProcessorInfo2(pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="244" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-62" value="&lt;b&gt;createCommandBufferPool(pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="270" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-63" value="&lt;b&gt;createCompiler(&amp;amp;compiler, pProcessor)&lt;/b&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry y="296" width="490" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-52" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-37" target="pcVGzkrLHwzF4EQMK3bM-48">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint y="523" as="sourcePoint" />
            <mxPoint x="270" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-64" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="1540" width="460" height="200" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-65" value="&lt;b&gt;fillProcessorInfo(processor)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry y="26" width="460" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-66" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry y="52" width="460" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-81" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry y="60" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-67" value="devInfo-&amp;gt;pciDomainId = legacyInfo-&amp;gt;identity.pciDomain&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;pciBusId&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;identity.pciBus&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt;pciDeviceId&amp;nbsp; &amp;nbsp;=&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;identity.pciSlot&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;-&amp;gt;pciFunctionId =&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; -&amp;gt;identity.pciFunction&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry y="90" width="460" height="80" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-80" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry y="170" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-68" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="1400" width="460" height="90" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-69" value="&lt;b&gt;fillLegacyInfo(struct _legacyInfo* legacyInfo)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-68">
          <mxGeometry y="26" width="460" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-70" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-68">
          <mxGeometry y="52" width="460" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-71" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-68">
          <mxGeometry y="60" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-72" value="hal.cpp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="1100" width="460" height="230" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-73" value="&lt;b&gt;queryChipInfo(processor_PTR processor)&lt;/b&gt;" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-72">
          <mxGeometry y="26" width="460" height="26" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-74" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-72">
          <mxGeometry y="52" width="460" height="8" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-75" value="gcsHAL_INTERFACE iface = {&lt;span style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;&lt;b&gt;gcvHAL_QUERY_CHIP_IDENTITY&lt;/b&gt;&lt;/span&gt;}&lt;div&gt;iface.coreIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;coreIndexs[0]&lt;/div&gt;&lt;div&gt;iface.devIndex&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = processor-&amp;gt;kmdNodeIndex&lt;/div&gt;&lt;div&gt;iface.hardwareType&amp;nbsp; = processor-&amp;gt;coreTypes[0]&lt;/div&gt;&lt;div&gt;handle&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= processor-&amp;gt;coreTypes[0]&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;KmdIoCtl(handle, ...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iface.command&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= &lt;b style=&quot;background-color: rgb(255, 153, 153);&quot;&gt;gcvHAL_QUERY_CHIP_OPTION&lt;/b&gt;&lt;/div&gt;&lt;div&gt;KmdIoCtl(handle, ...)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="pcVGzkrLHwzF4EQMK3bM-72">
          <mxGeometry y="60" width="460" height="170" as="geometry" />
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-76" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-59" target="pcVGzkrLHwzF4EQMK3bM-68">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint y="615" as="sourcePoint" />
            <mxPoint x="270" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-77" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-57" target="pcVGzkrLHwzF4EQMK3bM-72">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="760" y="1111" as="sourcePoint" />
            <mxPoint x="970" y="1410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pcVGzkrLHwzF4EQMK3bM-78" value="dispatch" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="pcVGzkrLHwzF4EQMK3bM-60" target="pcVGzkrLHwzF4EQMK3bM-64">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="760" y="1111" as="sourcePoint" />
            <mxPoint x="970" y="1410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0" version="29.3.4">
  <diagram name="Page-1" id="tWdcnQ-v4-HHU0wFJ4T7">
    <mxGraphModel dx="1633" dy="630" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="e39_uDAzcKakxyVN15kj-2" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" value="gckVIDMEM" vertex="1">
          <mxGeometry height="566" width="430" x="130" y="300" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-3" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="sentinel[0] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = 0&lt;div&gt;intlvView = NONE&lt;/div&gt;" vertex="1">
          <mxGeometry height="54" width="430" y="26" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-7" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[1] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = 2DIE bytes&lt;div&gt;intlvView = 2DIE&amp;nbsp;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="430" y="80" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-8" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="sentinel[2] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = DIE0 bytes&lt;div&gt;intlvView = DIE0&amp;nbsp;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="430" y="140" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-20" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="Used" vertex="1">
          <mxGeometry height="30" width="430" y="200" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-9" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="Used" vertex="1">
          <mxGeometry height="30" width="430" y="230" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-32" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="Free" vertex="1">
          <mxGeometry height="30" width="430" y="260" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-9" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[3] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = DIE1 bytes&lt;div&gt;intlvView = DIE1&amp;nbsp;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="430" y="290" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-10" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[4] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = MP0 bytes&lt;div&gt;intlvView = MP0&lt;/div&gt;" vertex="1">
          <mxGeometry height="54" width="430" y="350" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-11" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[5] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes =&amp;nbsp;MP1 bytes&lt;div&gt;intlvView = MP1&lt;/div&gt;" vertex="1">
          <mxGeometry height="54" width="430" y="404" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-12" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[6] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes = MP2 bytes&lt;div&gt;intlvView&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;= MP2&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="54" width="430" y="458" as="geometry" />
        </mxCell>
        <mxCell id="e39_uDAzcKakxyVN15kj-13" parent="e39_uDAzcKakxyVN15kj-2" style="text;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#333333;" value="sentinel[7] (gcuVIDMEM_NODE)&lt;br&gt;viewbytes =&amp;nbsp;MP3 bytes&lt;br&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;intlvView&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;= MP3&lt;/span&gt;" vertex="1">
          <mxGeometry height="54" width="430" y="512" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-1" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" value="gckVIDMEM_AllocateLinear" vertex="1">
          <mxGeometry height="150" width="580" x="1140" y="340" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-2" parent="TlSww3binjyCkEs9aOXB-1" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/*&amp;nbsp; 根据大小和 interleave 配置, 在ROOT节点中查找合适的 node */&lt;/span&gt;&lt;/div&gt;node = &lt;span&gt;_FindNode_OTV&lt;/span&gt;(Memalloc_OTV, Kernel, Memory, Bytes, &amp;amp;alignment);" vertex="1">
          <mxGeometry height="44" width="580" y="26" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-3" parent="TlSww3binjyCkEs9aOXB-1" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 再找到的node 节点中分出所需大小的node */&lt;br&gt;&lt;/span&gt;_Split(Memory-&amp;gt;os, node, alignment)" vertex="1">
          <mxGeometry height="40" width="580" y="70" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-37" parent="TlSww3binjyCkEs9aOXB-1" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;b style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 根据配置填写分配信息, 比如根据pagesize计算pagecount */&lt;/b&gt;&lt;/div&gt;&lt;b&gt;_UpdateNodeForceParam(Kernel, Memalloc_OTV, node);&lt;/b&gt;" vertex="1">
          <mxGeometry height="40" width="580" y="110" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-34" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-2" style="endArrow=classic;html=1;rounded=0;entryX=1.001;entryY=0.031;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryPerimeter=0;" target="TlSww3binjyCkEs9aOXB-32" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="820" y="440" as="sourcePoint" />
            <mxPoint x="870" y="390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-35" connectable="0" parent="TlSww3binjyCkEs9aOXB-34" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" value="Interleave DIE1" vertex="1">
          <mxGeometry relative="1" x="-0.3429" y="-2" as="geometry">
            <mxPoint x="-54" y="46" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-39" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-3" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="TlSww3binjyCkEs9aOXB-41" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="1340" y="510" as="sourcePoint" />
            <mxPoint x="775" y="611.5600000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-40" connectable="0" parent="TlSww3binjyCkEs9aOXB-39" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" value="Split a new node" vertex="1">
          <mxGeometry relative="1" x="-0.3429" y="-2" as="geometry">
            <mxPoint x="-54" y="46" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-41" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#d5e8d4;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=#82b366;" value="&lt;span style=&quot;text-align: left;&quot;&gt;gcuVIDMEM_NODE&lt;/span&gt;" vertex="1">
          <mxGeometry height="156" width="350" x="630" y="650" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-51" parent="TlSww3binjyCkEs9aOXB-41" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="Offset" vertex="1">
          <mxGeometry height="26" width="350" y="26" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-52" parent="TlSww3binjyCkEs9aOXB-41" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="___" vertex="1">
          <mxGeometry height="26" width="350" y="52" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-42" parent="TlSww3binjyCkEs9aOXB-41" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="MMU Page SIZE (Force 2M/4K 或者默认4K)" vertex="1">
          <mxGeometry height="26" width="350" y="78" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-60" parent="TlSww3binjyCkEs9aOXB-41" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="PageCount (根据page size 计算出的pagecount)" vertex="1">
          <mxGeometry height="26" width="350" y="104" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-43" parent="TlSww3binjyCkEs9aOXB-41" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="Force Physical Start Address (保留force 的 physical 信息)" vertex="1">
          <mxGeometry height="26" width="350" y="130" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-45" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-37" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1.005;entryY=1.111;entryDx=0;entryDy=0;entryPerimeter=0;" target="TlSww3binjyCkEs9aOXB-52" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="1560" y="530" as="sourcePoint" />
            <mxPoint x="1200" y="767" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-46" connectable="0" parent="TlSww3binjyCkEs9aOXB-45" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" value="update force param" vertex="1">
          <mxGeometry relative="1" x="-0.3429" y="-2" as="geometry">
            <mxPoint x="-54" y="46" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-47" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" value="gckVIDMEM_LockVirtual" vertex="1">
          <mxGeometry height="128" width="710" x="1140" y="640" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-48" parent="TlSww3binjyCkEs9aOXB-47" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="offset = _GetNodeOffset_OTV(Kernel-&amp;gt;device, Node);" vertex="1">
          <mxGeometry height="24" width="710" y="26" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-49" parent="TlSww3binjyCkEs9aOXB-47" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="_PageTypeSetup_OTV(Node-&amp;gt;VidMem.flags_OTV, Node-&amp;gt;VidMem.gpuPageSize_OTV, &amp;amp;pageType);" vertex="1">
          <mxGeometry height="26" width="710" y="50" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-50" parent="TlSww3binjyCkEs9aOXB-47" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="&lt;b&gt;_UpdateNodeForceParam(Kernel, Memalloc_OTV, node);&lt;/b&gt;" vertex="1">
          <mxGeometry height="26" width="710" y="76" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-57" parent="TlSww3binjyCkEs9aOXB-47" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" value="&lt;b&gt;gckOS_MapPagesEx&lt;/b&gt;" vertex="1">
          <mxGeometry height="26" width="710" y="102" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-53" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" value="gckOS_MapPagesEx" vertex="1">
          <mxGeometry height="450" width="710" x="1140" y="930" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-54" parent="TlSww3binjyCkEs9aOXB-53" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;while (!done &amp;amp;&amp;amp; PageCount-- &amp;gt; 0) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;//根据force 参数, 跟新Physical地址&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;_MMUEntryPhysicalSetup_OTV((gcsMMU_ENTRY_FLAG *)EntryFlag, offset_OTV, &amp;amp;phys);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;//填写页表项 PTE&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;if (((gcsMMU_ENTRY_FLAG *)EntryFlag)-&amp;gt;pageType == gcvPAGE_TYPE_2M) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkONERROR(gckMMU_SetPage(mmu,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;phys + (i * 0x200000),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;table++,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;EntryFlag));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;gcmkONERROR(gckMMU_SetPage(mmu,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(255, 242, 204);&quot;&gt;phys + (i * 4096),&lt;/span&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; table++,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; EntryFlag));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt; //根据force 参数, 计算新的offset&lt;/span&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (((gcsMMU_ENTRY_FLAG *)EntryFlag)-&amp;gt;pageType == gcvPAGE_TYPE_2M) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += 0x200000;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset_OTV += 0x200000;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset += PAGE_SIZE;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offset_OTV += PAGE_SIZE;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" vertex="1">
          <mxGeometry height="424" width="710" y="26" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-58" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-57" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="TlSww3binjyCkEs9aOXB-53" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <Array as="points">
              <mxPoint x="1900" y="760" />
              <mxPoint x="1900" y="850" />
              <mxPoint x="1515" y="870" />
            </Array>
            <mxPoint x="1309" y="730" as="sourcePoint" />
            <mxPoint x="1070" y="1022" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-61" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" value="_SetupContiguousVidMem" vertex="1">
          <mxGeometry height="180" width="710" x="1140" y="60" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-62" parent="TlSww3binjyCkEs9aOXB-61" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/* 获取interleave 信息 */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;gcsPLATFORM *platform = device-&amp;gt;platform;&lt;/div&gt;&lt;div&gt;gcsINTLV_MEM_PTR intLvMem;&lt;/div&gt;&lt;div&gt;if (platform-&amp;gt;ops-&amp;gt;getInterleaveParam) {&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; platform-&amp;gt;ops-&amp;gt;getInterleaveParam(platform, i, &amp;amp;intLvMem);&lt;br&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="104" width="710" y="26" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-63" parent="TlSww3binjyCkEs9aOXB-61" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontStyle=1" value="&lt;div&gt;&lt;span style=&quot;background-color: rgb(185, 224, 165);&quot;&gt;/*通过interleave 信息创建 ROOT vidmem */&lt;/span&gt;&lt;br&gt;gckVIDMEM_Construct_INTLV_OT_VERIFY(device-&amp;gt;os,&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;64, intLvMem, &amp;amp;device-&amp;gt;contiguousVidMems[i]);&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="50" width="710" y="130" as="geometry" />
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-65" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-63" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" target="e39_uDAzcKakxyVN15kj-2" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="620" y="-100" as="sourcePoint" />
            <mxPoint x="620" y="318" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-66" connectable="0" parent="TlSww3binjyCkEs9aOXB-65" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;" value="Create ROOT VIDMEM" vertex="1">
          <mxGeometry relative="1" x="-0.3429" y="-2" as="geometry">
            <mxPoint x="-95" y="46" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-67" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-43" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.133;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;dashPattern=8 8;" target="TlSww3binjyCkEs9aOXB-54" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="793" />
              <mxPoint x="1060" y="1010" />
            </Array>
            <mxPoint x="920" y="900" as="sourcePoint" />
            <mxPoint x="970" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-70" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-32" style="endArrow=classic;html=1;rounded=0;exitX=0.995;exitY=0.633;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;" target="TlSww3binjyCkEs9aOXB-51" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="550" y="590" as="sourcePoint" />
            <mxPoint x="690" y="605" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-71" connectable="0" parent="TlSww3binjyCkEs9aOXB-70" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="sentinel中的offset" vertex="1">
          <mxGeometry relative="1" x="0.0042" y="-1" as="geometry">
            <mxPoint x="17" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TlSww3binjyCkEs9aOXB-73" edge="1" parent="1" source="TlSww3binjyCkEs9aOXB-60" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.004;entryY=0.072;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;dashPattern=8 8;" target="TlSww3binjyCkEs9aOXB-54" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <Array as="points">
              <mxPoint x="1020" y="767" />
              <mxPoint x="1110" y="987" />
            </Array>
            <mxPoint x="1120" y="850" as="sourcePoint" />
            <mxPoint x="1281" y="1058" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
